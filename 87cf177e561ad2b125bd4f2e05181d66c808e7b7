{
  "comments": [
    {
      "key": {
        "uuid": "79bd40c9_d302d43b",
        "filename": "host/arch/x86/lib/crossystem_arch.c",
        "patchSetId": 2
      },
      "lineNbr": 586,
      "author": {
        "id": 1002124
      },
      "writtenOn": "2015-06-05T16:51:30Z",
      "side": 1,
      "message": "No parens around the return 0.\n\nYou should be checking this condition within the loop. There\u0027s no guarantee your  data is sane coming in here.  But what I don\u0027t understand is you have your terminating uid fields as the first ones in the array.  Please put those at the end of the arrays so you can check the terminating entry (uid \u003d\u003d 0) within the loop.",
      "revId": "87cf177e561ad2b125bd4f2e05181d66c808e7b7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "599a3c79_d202c43b",
        "filename": "host/arch/x86/lib/crossystem_arch.c",
        "patchSetId": 2
      },
      "lineNbr": 586,
      "author": {
        "id": 1110034
      },
      "writtenOn": "2015-06-05T17:40:41Z",
      "side": 1,
      "message": "The function is static, so the \"data\" is coming from within this file from either of the {Braswell,Baytrail}FindGpioChipOffset functions. The *gpio_num and *offset values are not constrained (except they are unsigned so not negative).\n\nThe logic is to find the the largest entry which is less than or equal to the provided key, but to have an error if the key is too big.\n\nSo you could reverse the values in the table, add a final entry with a ((unsigned int) -1) entry and do something like this (cf https://www.youtube.com/watch?v\u003dBvmRI6K8TS8 ) and hope no one spots the boundary condition error. \n\n\nunsigned int best_uid\u003ddata-\u003euid;\nif (*gpio_num \u003e\u003d max_good_value) return 0;\n\ndo { \n   if (*gpio_num \u003c data-\u003ebase)\n         break;\n   best_uid \u003d data-\u003euid;\n   data++;\n}\n\nwhile(0 !\u003d (ent \u003d ....\n    ....\n    if (best_uid \u003d\u003d uid_value) {\n       match++;\n       break;\n    } \n\nYou could make the data table have the upper limit of the range which simplifies the logic (and avoids the problem of answering the previous question) but makes the values less obvious.",
      "parentUuid": "79bd40c9_d302d43b",
      "revId": "87cf177e561ad2b125bd4f2e05181d66c808e7b7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "39b828d4_0d7ee126",
        "filename": "host/arch/x86/lib/crossystem_arch.c",
        "patchSetId": 2
      },
      "lineNbr": 586,
      "author": {
        "id": 1002124
      },
      "writtenOn": "2015-06-05T19:24:17Z",
      "side": 1,
      "message": "In this case i was referring to *gpio_num which does not come from this module. It\u0027s parsed from ACPI. But I see you are encoding ranges with only starting offsets. Seems not that straight forward but it does work.",
      "parentUuid": "599a3c79_d202c43b",
      "revId": "87cf177e561ad2b125bd4f2e05181d66c808e7b7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79bd40c9_b391d85c",
        "filename": "host/arch/x86/lib/crossystem_arch.c",
        "patchSetId": 2
      },
      "lineNbr": 586,
      "author": {
        "id": 1110034
      },
      "writtenOn": "2015-06-05T20:39:28Z",
      "side": 1,
      "message": "Ah, I was confused by your use of the word \"data\", which is a parameter name for this function.\n\nReplacing a chain of if else if statements by a table lookup give you the ability to reuse the old BayTrailFindGpioChipOffset code for Braswell.\n\nAs the values are unsigned and the final entry in the table is 0 you will always match, regardless of the value parsed from ACPI.\n\nI am not sure I can think of any code which involves a loop which is simpler than a linear scan of a table. For tables involving 4 or 5 elements it doesn\u0027t seem sensible to bring out heavier guns like binary search, or unrolling it into cache unfriendly decision tree.\n\nAdding in an extra test to avoid a calls to the filesystem to scan a directory, do some string manipulation, open another file, read it, , seems like a good payoff for 2 words of data and 2 instructions.",
      "parentUuid": "39b828d4_0d7ee126",
      "revId": "87cf177e561ad2b125bd4f2e05181d66c808e7b7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}