{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "bdfc3d72_2ea16455",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2022-09-21T14:37:45Z",
      "side": 1,
      "message": "I\u0027d prefer a strong \u0027no\u0027 here. Detaching model from firmware image names will be a huge change - especially to all provisioning process. Have you got agreement from the factory team, SIEs and TAMs (also ODMs)? Do the partners know how to get the right images? What about the test/lab/CTS thing? They used to rely on \u0027model\u0027 to make sure the test coverage.\n\nAlso, even if you are determined to do that, we should not change the updater. Instead you should change the mapping of crosid (+jrosenth) - no need to touch the futility side.",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dcec6166_b0e21cc2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2022-09-21T14:48:23Z",
      "side": 1,
      "message": "Reading the description I now understood you are solving the case for servo. But again, I still don\u0027t prefer having such info exposed and implemented in multiple locations. Adding --image-name and --sku_id is really too much. Sounds like we\u0027re implementing the mapping rules in multiple places - crosid and futility, and that should really be avoided.\n\nMy thoughts:\n\n1. Can they just override --model for the firmware they want to use?\n\n2. If not, who will use this function - a developer or lab? Can we ask them to always get the right blob on their own?\n\n3. Or, can we in future define a rule - in a single FW updater archive, each firmware name will have only one version of fw image? Then we can readback current firmware and decide which image to update into.",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd2e6a68_ff1b7dbe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1330845
      },
      "writtenOn": "2022-09-21T16:49:39Z",
      "side": 1,
      "message": "\u003e I\u0027d prefer a strong \u0027no\u0027 here. Detaching model from firmware image names will be a huge change - especially to all provisioning process. Have you got agreement from the factory team, SIEs and TAMs (also ODMs)? Do the partners know how to get the right images? What about the test/lab/CTS thing? They used to rely on \u0027model\u0027 to make sure the test coverage.\n\nHung-Te, can you help communicate this to the relevant teams?\n\n\u003e Also, even if you are determined to do that, we should not change the updater. Instead you should change the mapping of crosid (+jrosenth) - no need to touch the futility side.\n\nBy this, do you mean we just update `FIRMWARE_MANIFEST_KEY`? That SGTM.",
      "parentUuid": "bdfc3d72_2ea16455",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5423b8f_d003c42c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2022-09-22T00:36:43Z",
      "side": 1,
      "message": "\u003e \u003e Detaching model from firmware image names will be a huge change\n\u003e Hung-Te, can you help communicate this to the relevant teams?\n\nIs there a doc explaining the design, background for why we\u0027re doing this and CLs related?\n\n\u003e \u003e Also, even if you are determined to do that, we should not change the updater. Instead you should change the mapping of crosid (+jrosenth) - no need to touch the futility side.\n\u003e \n\u003e By this, do you mean we just update `FIRMWARE_MANIFEST_KEY`? That SGTM.\n\nYes. Although I really don\u0027t like the manifest key being different from model, but that\u0027s way better than adding sku/image_name mappings everywhere.",
      "parentUuid": "fd2e6a68_ff1b7dbe",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2a99f4d_9733d30b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1116026
      },
      "writtenOn": "2022-09-23T04:01:55Z",
      "side": 1,
      "message": "The larger design was covered in http://go/fw-customisation. The `FIRMWARE_MANIFEST_KEY` changes are already done and firmware updates from the OS work fine.\n\nRe: CTS/test coverage: one of the goals of this is to align with go/cros-cts-model-policy, avoiding test duplication not mandated, but required due to the practical impact of one firmware payload per model.",
      "parentUuid": "f5423b8f_d003c42c",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "289c364a_5abd4f10",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1116026
      },
      "writtenOn": "2022-09-23T04:01:55Z",
      "side": 1,
      "message": "\u003e Reading the description I now understood you are solving the case for servo. But again, I still don\u0027t prefer having such info exposed and implemented in multiple locations. Adding --image-name and --sku_id is really too much. Sounds like we\u0027re implementing the mapping rules in multiple places - crosid and futility, and that should really be avoided.\n\nThe problem is that crosid maps from smbios name and SKU ID to FIRMWARE_MANIFEST_KEY, but smbios name isn\u0027t readily available if the AP isn\u0027t booted to OS. Beyond that, the crosid data isn\u0027t included in firmware_from_source either.\n\n\u003e My thoughts:\n\u003e \n\u003e 1. Can they just override --model for the firmware they want to use?\n\nFor the lab, they could, but this would need to be recorded ahead of time in a new field and plumbed around. The lab is converging on using http://go/cft-fw-provision-v2#heading\u003dh.puavdttwd1sq with the implementation delegating to futility to choose an appropriate firmware, both for provisioning from the OS and over servo, so there is a need for this to be contained within futility update.\n\n\u003e 2. If not, who will use this function - a developer or lab? Can we ask them to always get the right blob on their own?\n\nSomething is needed for the lab, but ideally developers could use it too when recovering a DUT over servo. Currently, choosing the right firmware is essentially guesswork when multiple models use the same firmware target. We\u0027d likely want to apply anything to the firmware updater bundle as well so both pinned and unpinned FW versions could be used.\n\n\u003e 3. Or, can we in future define a rule - in a single FW updater archive, each firmware name will have only one version of fw image? Then we can readback current firmware and decide which image to update into.\n\nThe intent is for the differences between firmware configs within a model to be fairly limited - in our case just some bundled blobs, so all would report the same smbios name. This would also run into issues with a firmware updater archive where multiple versions of the same firmware build are included.",
      "parentUuid": "dcec6166_b0e21cc2",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4aab24e4_9074993d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1330845
      },
      "writtenOn": "2022-09-23T13:25:13Z",
      "side": 1,
      "message": "\u003e The problem is that crosid maps from smbios name and SKU ID to FIRMWARE_MANIFEST_KEY, but smbios name isn\u0027t readily available if the AP isn\u0027t booted to OS. Beyond that, the crosid data isn\u0027t included in firmware_from_source either.\n\nSo actually the SMBIOS name match is deprecated in favor of FRID matching, and we\u0027re working to migrate all the configs over to that.  FRID *is* available from joust a servo, so that would likely meet your needs?",
      "parentUuid": "289c364a_5abd4f10",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "556cf256_fc1b829c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1116026
      },
      "writtenOn": "2022-09-26T12:07:42Z",
      "side": 1,
      "message": "That is helpful. I think we can use FRID + SKU ID with a crosid lookup for developer use cases.\n\nGiven a longer-term solution for developers, I\u0027m more comfortable with the solution for lab provisioning relying on the lab infra saving FIRMWARE_MANIFEST_KEY during deployment and using that for FW provisioning over servo. As long as the infra team are ok with that, we\u0027ll be ok to drop these CLs.\n\nThanks both for all the feedback.",
      "parentUuid": "4aab24e4_9074993d",
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4813225e_b048396b",
        "filename": "futility/cmd_update.c",
        "patchSetId": 2
      },
      "lineNbr": 141,
      "author": {
        "id": 1330845
      },
      "writtenOn": "2022-09-21T16:49:39Z",
      "side": 1,
      "message": "Underscores in the flags violates the CrOS CLI guidelines: https://chromium.googlesource.com/chromiumos/chromite/+/HEAD/docs/cli-guidelines.md#long-option-separators\n\nHowever, I notice that other flags in this file are also in violation of those guidelines, so they should be fixed in a follow-on CL.",
      "range": {
        "startLine": 141,
        "startChar": 12,
        "endLine": 141,
        "endChar": 13
      },
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c42d5158_faa8a251",
        "filename": "futility/cmd_update.c",
        "patchSetId": 2
      },
      "lineNbr": 141,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2022-09-22T00:36:43Z",
      "side": 1,
      "message": "The futility commands (not just cmd_update) have been using underscore as the coding style for a long time and many scripts are already calling them in that way, so please don\u0027t randomly change them - otherwise AU \u0026 signing may fail.",
      "parentUuid": "4813225e_b048396b",
      "range": {
        "startLine": 141,
        "startChar": 12,
        "endLine": 141,
        "endChar": 13
      },
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ed419cc_23b1dfc3",
        "filename": "futility/cmd_update.c",
        "patchSetId": 2
      },
      "lineNbr": 141,
      "author": {
        "id": 1330845
      },
      "writtenOn": "2022-09-22T15:36:41Z",
      "side": 1,
      "message": "Right, we need to keep the existing underscore flags as deprecated aliases until we delete all references to them...",
      "parentUuid": "c42d5158_faa8a251",
      "range": {
        "startLine": 141,
        "startChar": 12,
        "endLine": 141,
        "endChar": 13
      },
      "revId": "d7ee76ba755e699ca7d41daeed476690ce5a1277",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}