{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0bbd0f3b_171249bf",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "What does ADK stand for?",
      "range": {
        "startLine": 35,
        "startChar": 8,
        "endLine": 35,
        "endChar": 11
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6f958a2_bf05f6ea",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "Please use `GPT_ENT_NAME_ANDROID_*` constants.",
      "range": {
        "startLine": 486,
        "startChar": 40,
        "endLine": 486,
        "endChar": 74
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2cad8da4_e4d44920",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "boot_partitions",
      "range": {
        "startLine": 486,
        "startChar": 20,
        "endLine": 486,
        "endChar": 34
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e0ce9554_1a01e504",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2024-07-02T12:08:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2cad8da4_e4d44920",
      "range": {
        "startLine": 486,
        "startChar": 20,
        "endLine": 486,
        "endChar": 34
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "75ca5429_ef4f004f",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2024-07-02T12:08:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f6f958a2_bf05f6ea",
      "range": {
        "startLine": 486,
        "startChar": 40,
        "endLine": 486,
        "endChar": 74
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d96e982e_42dcc3b1",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 494,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "Don\u0027t convert `GPT_*` to vb2_error_t. Please use `VB2_ERROR_*` such as `VB2_ERROR_LK_NO_KERNEL_FOUND`.",
      "range": {
        "startLine": 494,
        "startChar": 9,
        "endLine": 494,
        "endChar": 12
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5d5c48c7_cef0bcf7",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 494,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2024-07-02T12:08:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d96e982e_42dcc3b1",
      "range": {
        "startLine": 494,
        "startChar": 9,
        "endLine": 494,
        "endChar": 12
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0d74ad9_01c3ddc1",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 504,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "need_valid_keyblock",
      "range": {
        "startLine": 504,
        "startChar": 5,
        "endLine": 504,
        "endChar": 44
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9c2b7cdf_25a38b55",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 504,
      "author": {
        "id": 3512440
      },
      "writtenOn": "2024-07-01T15:40:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a0d74ad9_01c3ddc1",
      "range": {
        "startLine": 504,
        "startChar": 5,
        "endLine": 504,
        "endChar": 44
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c6ac673_9cd53adf",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 504,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T15:42:09Z",
      "side": 1,
      "message": "Not done.",
      "parentUuid": "9c2b7cdf_25a38b55",
      "range": {
        "startLine": 504,
        "startChar": 5,
        "endLine": 504,
        "endChar": 44
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac3530cc_09856082",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 507,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "```\navb_flags \u003d AVB_SLOT_VERIFY_FLAGS_NONE;\nif (...)\n\tavb_flags |\u003d AVB_SLOT_VERIFY_FLAGS_ALLOW_VERIFICATION_ERROR;\n```",
      "range": {
        "startLine": 504,
        "startChar": 1,
        "endLine": 507,
        "endChar": 41
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b152a92c_bda99377",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 507,
      "author": {
        "id": 3512440
      },
      "writtenOn": "2024-07-01T15:40:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ac3530cc_09856082",
      "range": {
        "startLine": 504,
        "startChar": 1,
        "endLine": 507,
        "endChar": 41
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8b8663e9_a18df73a",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 507,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T15:42:09Z",
      "side": 1,
      "message": "Not done.",
      "parentUuid": "b152a92c_bda99377",
      "range": {
        "startLine": 504,
        "startChar": 1,
        "endLine": 507,
        "endChar": 41
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3c094739_b17ab7c2",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 507,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2024-07-02T12:08:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8b8663e9_a18df73a",
      "range": {
        "startLine": 504,
        "startChar": 1,
        "endLine": 507,
        "endChar": 41
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7310c382_484f2b51",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 513,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "AVB_HASHTREE_ERROR_MODE_RESTART_AND_INVALIDATE",
      "range": {
        "startLine": 513,
        "startChar": 3,
        "endLine": 513,
        "endChar": 4
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1fc9cb68_683b6fc4",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 519,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "need_valid_keyblock\n\n`VB2_CONTEXT_DEVELOPER_MODE` actually means \"dev switch is on\", not \"in dev mode\". In recovery mode, dev switch can be either on or off, but we can\u0027t ignore verification errors.",
      "range": {
        "startLine": 519,
        "startChar": 5,
        "endLine": 519,
        "endChar": 44
      },
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "891e170a_b78bb3d7",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 525,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "Can we first store `AVB_SLOT_VERIFY_RESULT_OK` back to `result`, and then convert `result` to `ret` outside the if-else block?",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "471887c6_304298a1",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 531,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2024-07-01T14:55:19Z",
      "side": 1,
      "message": "`VB2_SUCCESS`. `ret` needs to be one of the constants defined for `vb2_error_t`. The same argument applies to other assignments for `ret` below.",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba345efa_a0955d31",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-06-29T00:51:47Z",
      "side": 1,
      "message": "We should just change the bootloader expectations rather than waste time memmove()ing the whole kernel around here. If AVB treats the command line separately from the kernel image, maybe just pass it back out to depthcharge like that (e.g. just put another pointer of offset for that in vb2_kernel_params).",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3ad4584_5b258d32",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1565377
      },
      "writtenOn": "2024-07-26T13:47:02Z",
      "side": 1,
      "message": "Maybe we could just increment `params-\u003ekernel_buffer` and adjust `params-\u003ekernel_buffer_size`?\nNot sure if the kernel needs to be stored at a specific address.\nWith this approach we\u0027d only need to memcpy ADK_BOOT_HDR_GKI_SIZE, or 4096 bytes, which IMO is not a big problem.",
      "parentUuid": "ba345efa_a0955d31",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b855e6a0_bf3a1c1b",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-07-30T00:21:09Z",
      "side": 1,
      "message": "We could do that but we still need the GKI header somewhere in depthcharge, so we\u0027d still need to move that around, right?\n\nIf this is supposed to be the basis of our products for years to come, we should change the code wherever needed so that it makes sense from the ground up for this boot flow, and not just put in the smallest possible hacks that makes it work with our existing ChromeOS code. The code that receives this on the depthcharge side is not sacred, we are allowed to change it. It was written in a way that makes sense for vboot images but if we now need to support other images we should make it aware of the difference, rather than underhandedly massaging its inputs.",
      "parentUuid": "e3ad4584_5b258d32",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd9a2cf4_2ffb6d95",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1565377
      },
      "writtenOn": "2024-07-30T08:37:10Z",
      "side": 1,
      "message": "Hmm, ok, fair point.\n\nI looked into depthcharge logic and noticed two things:\n1. I don\u0027t see any references to GKI_BOOT_HEADER there. So maybe we don\u0027t need to pass it in the first place.\n2. The pointer to where the kernel is can be adjusted - https://chromium-review.googlesource.com/c/chromiumos/platform/depthcharge/+/5650801/1/src/vboot/boot_policy.c#319.\n\nAt this point I\u0027d get rid of all this moving/copying here and modify deptcharge instead.\nI don\u0027t think we\u0027ll need to pass any additional info, or modify the API though.",
      "parentUuid": "b855e6a0_bf3a1c1b",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5315d7d7_bf116fd7",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2024-07-30T08:59:26Z",
      "side": 1,
      "message": "I already removed copying GKI header and moving kernel in next patchset. Header is not required anymore and I just modified offset move kernel in boot() function for x86. I just need to check if ARM booting requires similar changes.",
      "parentUuid": "bd9a2cf4_2ffb6d95",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0afb6f8_e49775ae",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-07-30T21:23:30Z",
      "side": 1,
      "message": "\u003e I don\u0027t see any references to GKI_BOOT_HEADER there. So maybe we don\u0027t need to pass it in the first place.\n\nIsn\u0027t that what `init_hdr` in `gki_setup_ramdisk()` is?",
      "parentUuid": "5315d7d7_bf116fd7",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ce9b3b0_ad0ec432",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1565377
      },
      "writtenOn": "2024-07-31T08:02:58Z",
      "side": 1,
      "message": "IIUC `init_hdr` is the header of a ramdisk that is placed after the kernel.",
      "parentUuid": "e0afb6f8_e49775ae",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "309542f1_2e1a08b1",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-08-06T01:32:24Z",
      "side": 1,
      "message": "Hmm... okay, I\u0027m a bit confused. Looking at the code more closely, you\u0027re right that that init_hdr is loaded from the ramdisk partition (init_boot, not boot). But it\u0027s still using the boot_img_hdr_v4 struct. And the main GKI header (loaded from boot) is also using the boot_img_hdr_v4 struct in gki_validate_boot_header(). Is Android reusing that same header format for two different pieces? I\u0027m a bit confused because some of those fields (e.g. kernel_size, cmdline) wouldn\u0027t really make sense for the header of a ramdisk?",
      "parentUuid": "3ce9b3b0_ad0ec432",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5aceca03_97177007",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1565377
      },
      "writtenOn": "2024-08-19T08:49:01Z",
      "side": 1,
      "message": "Yeah, good question. No idea why it\u0027s done like this.",
      "parentUuid": "309542f1_2e1a08b1",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "666a6b28_30b80d2e",
        "filename": "firmware/2lib/2load_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 570,
      "author": {
        "id": 1515687
      },
      "writtenOn": "2024-08-19T09:25:10Z",
      "side": 1,
      "message": "\u003e Is Android reusing that same header format for two different pieces?\n\nYes - see [this slide](https://docs.google.com/presentation/d/1jHYoKIn9Qj5NCrvtz2vFRe3mg-rEnWA3r8IV_CZiLEI/edit?resourcekey\u003d0-U_C6GFY8yYq6STLfhFXhmw#slide\u003did.g2158409f8fc_0_2) from go/al-eng-bootcamp.",
      "parentUuid": "5aceca03_97177007",
      "revId": "282437f8785fd0cd39e1fdcbeb6b3ae2ac1489f1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}