{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a06aed95_b9133611",
        "filename": "firmware/lib/cgptlib/include/cgptlib_internal.h",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-10-01T20:48:59Z",
      "side": 1,
      "message": "Do we really need to do all this string stuff at runtime? Can\u0027t we just define the constants we\u0027re looking for in UTF16LE in the first place, and also handle the A/B suffix statically, e.g.:\n```\n#define GPT_UCS2_NAME_VBMETA(slot_b) (slot_b ? \\\n  \"\\x00v\\x00b\\x00m...\\x00a\\x00_\\x00b\" : \\\n  \"\\x00v\\x00b\\x00m...\\x00a\\x00_\\x00a\"\n```\nI feel like having a whole UTF16 converter in firmware (especially one handling all the non-ASCII stuff we don\u0027t really need) a bit overkill.",
      "revId": "d81b1387b644ec4993d330bdcf73fa0e31edc37b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a1520476_c7f6b9e7",
        "filename": "firmware/lib/cgptlib/include/cgptlib_internal.h",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2024-10-18T13:19:35Z",
      "side": 1,
      "message": "It could work, but it limits us to only \u0027vbmeta_a/b\u0027 partitions. I think that it is better to have generic functions in cgptlib which allow us to find partition with any given name.",
      "parentUuid": "a06aed95_b9133611",
      "revId": "d81b1387b644ec4993d330bdcf73fa0e31edc37b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5978f391_31d7c021",
        "filename": "firmware/lib/cgptlib/include/cgptlib_internal.h",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-10-18T21:45:02Z",
      "side": 1,
      "message": "If it allows us to keep live UTF16 encoding/decoding functions out of firmware, I think it\u0027s absolutely worth it. The firmware always knows which partitions it is looking for anyway.",
      "parentUuid": "a1520476_c7f6b9e7",
      "revId": "d81b1387b644ec4993d330bdcf73fa0e31edc37b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60114b92_43b07efb",
        "filename": "firmware/lib/cgptlib/include/cgptlib_internal.h",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-11-08T00:10:03Z",
      "side": 1,
      "message": "Thought about this some more, I think it\u0027s fine to pass the strings as ASCII in the higher-level functions as long as we don\u0027t have such a complicated conversion step in the end. My main concerns here are the big UTF8ToUCS2() function with all the UTF8 special cases (which we don\u0027t need because we know the partition names we care about only use ASCII characters), and the dynamic allocations from string stitching. A super simple ASCII-only conversion like utfle16_to_ascii() in libpayload would be fine.\n\nReally, you don\u0027t exactly need a conversion function for anything you do here, you just need a function that compares a GPT entry to an ASCII partition name. So why not just provide that? We also usually need a suffix and that tends to be the only stitching we need, so I would suggest something like this:\n```\nbool GptEntryHasName(GptEntry *entry, const char *name, const char *opt_suffix)\n{\n\tfor (int i \u003d 0; i \u003c ARRAY_SIZE(entry-\u003ename); i++) {\n\t\tuint16_t wc \u003d entry-\u003ename[i];\n\t\tchar c \u003d \u0027\\0\u0027\n\t\t\n\t\tif (*name !\u003d \u0027\\0\u0027)\n\t\t\tc \u003d *name++;\n\t\telse if (opt_suffix \u0026\u0026 *opt_suffix !\u003d \u0027\\0\u0027)\n\t\t\tc \u003d *opt_suffix++;\n\t\t  \n\t\tif (wc \u003e 0x7f || (char)wc !\u003d c)\n\t\t\treturn false;\n\t\t  \n\t\tif (c \u003d\u003d \u0027\\0\u0027)\n\t\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n```",
      "parentUuid": "5978f391_31d7c021",
      "revId": "d81b1387b644ec4993d330bdcf73fa0e31edc37b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bb761b31_5a8e950b",
        "filename": "firmware/lib/cgptlib/include/cgptlib_internal.h",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2024-11-18T15:12:40Z",
      "side": 1,
      "message": "This comment will be adressed in CL:6030610",
      "parentUuid": "60114b92_43b07efb",
      "revId": "d81b1387b644ec4993d330bdcf73fa0e31edc37b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}