{
  "comments": [
    {
      "key": {
        "uuid": "a0c049c0_613e5e6d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "How about vb2api_check_ec() and vb2api_sync_ec()?",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 51
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "62cbe2fe_33319ddc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 20,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "I\u0027m assuming this is still WIP?  (Or feel free to wait for the overall design to be nailed down before updating auxfw stuff.)",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 71
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d21693ff_4f9f1f70",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 351,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "We might consider just inlining this function.  It\u0027s only called once, and a similar check is done at the end of ec_sync_phase1(), without a helper function.",
      "range": {
        "startLine": 351,
        "startChar": 0,
        "endLine": 351,
        "endChar": 57
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a721e052_fc1bee71",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 370,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "Is it possible to move this into ec_sync_allowed?",
      "range": {
        "startLine": 363,
        "startChar": 0,
        "endLine": 370,
        "endChar": 2
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a838b022_89338e92",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 383,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "Could we move this into vboot2 space while we\u0027re at it?  (Not sure if this will need some up/down-streaming with coreboot.)",
      "range": {
        "startLine": 383,
        "startChar": 9,
        "endLine": 383,
        "endChar": 41
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e199908f_b99c2831",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 408,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-03-04T08:01:00Z",
      "side": 1,
      "message": "There\u0027re alternatives other than returning a distinct error code:\n\n1. Change the signature to vb2api_check_ec_sync(struct vb2_context *ctx, int *slow)\n2. Set FLAG_EC_SYNC_SLOW in ctx-\u003eflags\n3. Always display ec sync screen in depthcharge, but I guess this is not an option",
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05143274_87357173",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 408,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "\u003e 1. Change the signature to vb2api_check_ec_sync(struct vb2_context *ctx, int *slow)\n\u003e 2. Set FLAG_EC_SYNC_SLOW in ctx-\u003eflags\n\nFor #1 and #2, I would envision the function being called twice -- the first to check whether the sync is slow or not, and (if slow) the second to actually perform the sync.  This also seems like a reasonable model.  Maybe we can see what Julius thinks.\n\n  rv \u003d vb2api_ec_sync(ctx);\n  if (rv \u003d\u003d VB2_ERROR_EC_SYNC_SLOW) {\n    display_wait_screen();\n    ctx-\u003eflags \u0026\u003d VB2_CONTEXT_ALLOW_SLOW_SYNC;\n    rv \u003d vb2api_ec_sync();\n  }\n  if (rv) {\n    VB2_DEBUG(\"Error syncing EC: %#x\\n\", rv);\n    return rv;\n  }",
      "parentUuid": "e199908f_b99c2831",
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2ad04b3b_e0f8be7c",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 408,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-03-04T22:52:02Z",
      "side": 1,
      "message": "If we are going to do this, I think I prefer the variant Joel suggests here (one function + context flag).",
      "parentUuid": "05143274_87357173",
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b122f7cf_31d6afaa",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 458,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "Maybe we can avoid the need for an extra variable here:\n\n  if (rv \u003d\u003d VB2_ERROR_EC_SYNC_REQUIRED_SLOW) {\n    if (vb2api_need_reboot_for_display(ctx))\n      return VBERROR_REBOOT_REQUIRED;\n    display_wait_screen();\n  }",
      "range": {
        "startLine": 458,
        "startChar": 0,
        "endLine": 458,
        "endChar": 58
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b79aaea_6f859180",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 461,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "Can we also move this into vboot2 error space?",
      "range": {
        "startLine": 461,
        "startChar": 9,
        "endLine": 461,
        "endChar": 32
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f251d0bf_9ac9805f",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 1
      },
      "lineNbr": 1017,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-03-04T08:01:00Z",
      "side": 1,
      "message": "I was also considering calling vb2api_check_ec_sync() inside this function if it hasn\u0027t been called, so that coreboot would only need one function call as before. In this case, we\u0027ll need a status flag similar to VB2_SD_STATUS_EC_SYNC_COMPLETE to record whether vb2api_check_ec_sync() is called or not.",
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0b9270fe_b7899f42",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 1
      },
      "lineNbr": 1017,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "Hmm, this is a very valid point.  It really depends on what we want the semantics of our two functions to be.\n\nLeaving it as is has the advantage that the caller may *force* an EC sync, even in the case that none is required.  But it might also be nice to guarantee that this would never happen from a vboot library standpoint.\n\nI kind of like allowing the caller to force an EC sync, in which case vb2api_perform_ec_sync() shouldn\u0027t bother calling vb2api_check_ec_sync().",
      "parentUuid": "f251d0bf_9ac9805f",
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ee6d4c18_4f4b5f2a",
        "filename": "firmware/2lib/include/2return_codes.h",
        "patchSetId": 1
      },
      "lineNbr": 780,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-04T08:44:14Z",
      "side": 1,
      "message": "I\u0027m wondering if we should generalize this between EC sync and AUXFW sync.",
      "range": {
        "startLine": 780,
        "startChar": 4,
        "endLine": 780,
        "endChar": 18
      },
      "revId": "1400b665670d2d27112cf4d608c0f449dd8ca23f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}