{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "7d274b0f_1851a7a1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003000
      },
      "writtenOn": "2020-10-14T21:10:49Z",
      "side": 1,
      "message": "LGTM. Let\u0027s wait to see if Hung-Te has any comments. Else, I can +2 tomorrow.",
      "revId": "bb308dee70efc4270287e8ef40ca1f8b17fc34fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6cbd2089_48b3a3e4",
        "filename": "futility/updater.c",
        "patchSetId": 4
      },
      "lineNbr": 520,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2020-10-15T00:59:35Z",
      "side": 1,
      "message": "The quirks functions were implemented as:\n\n- try_apply_quirk: do the quirk if config value is not zero. Returns 0 on success.\n\n- get_config_quirk: return the raw config value, that 0 usually means don\u0027t apply and non-zero means we should apply.\n\nSo if the quirks is simple we should do all implementations in updater_quirks.c, otherwise only reading get_config_quirk and decide what to do.\n\nAnd considering your case here, I think it\u0027d make more sense to leave only\n\n try_apply_quirk(QUIRK_PRESERVE_ME, cfg);\n\nhere, and in updater_quirks do\n\n static int quirk_preserve_me(struct updater_config *cfg)\n {\n    const char *me_name \u003d FMAP_SI_ME;\n    VB2_DEBUG(\"ME needs to be preserved - preserving %s.\\n\", me_name);\n    if (cfg-\u003efactory_update) {\n       WARN(\"Skipped preserving ME due to factory mode.\\n\");\n       return 0;\n    } else if (!cfg-\u003earchive) {\n       /* Post-boot script can\u0027t update ME properly after reboot */\n       WARN(\"Skipped preserving ME due to no archive.\\n\");\n       return 0;\n    }\n    return preserve_firmware_section(\n\t\u0026cfg-\u003ecurrent, \u0026cfg-\u003eimage_current, me_name);\n\n}",
      "range": {
        "startLine": 520,
        "startChar": 5,
        "endLine": 520,
        "endChar": 20
      },
      "revId": "bb308dee70efc4270287e8ef40ca1f8b17fc34fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95832b96_a0d1c301",
        "filename": "futility/updater.c",
        "patchSetId": 4
      },
      "lineNbr": 520,
      "author": {
        "id": 1302633
      },
      "writtenOn": "2020-10-15T03:57:04Z",
      "side": 1,
      "message": "In cases where PRESERVE_ME quirk is not enabled, we still want to try UNLOCK_ME_FOR_UPDATE quirk. For factory and archive based updates, we also want to try UNLOCK_ME_FOR_UPDATE quirk.\n\nReturn 0 during factory and archive aligns with quirk is not enabled scenario, so that the next quirk can be tried.\n\nBut when the ME region is preserved, preserve_firmware_section returns 0. Hence we need a different value(something \u003e 0) so that the next quirk is not tried.",
      "parentUuid": "6cbd2089_48b3a3e4",
      "range": {
        "startLine": 520,
        "startChar": 5,
        "endLine": 520,
        "endChar": 20
      },
      "revId": "bb308dee70efc4270287e8ef40ca1f8b17fc34fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f6bc40fe_74889d64",
        "filename": "futility/updater.c",
        "patchSetId": 4
      },
      "lineNbr": 520,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2020-10-15T04:58:23Z",
      "side": 1,
      "message": "Oh I see your point. I wonder if we should move entire preserve_management_engine to be a quirk....\n\nBut yes, then your current implementation looks reasonable.",
      "parentUuid": "95832b96_a0d1c301",
      "range": {
        "startLine": 520,
        "startChar": 5,
        "endLine": 520,
        "endChar": 20
      },
      "revId": "bb308dee70efc4270287e8ef40ca1f8b17fc34fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a96bdb5b_4cfb37c5",
        "filename": "futility/updater_quirks.c",
        "patchSetId": 4
      },
      "lineNbr": 405,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2020-10-15T04:58:23Z",
      "side": 1,
      "message": "Can you change the comment to messages, e.g.\n\n if (cfg-\u003efactory_update) {\n   WARN(...);\n   return 0;\n }\n if (cfg-\u003earchive) {\n   WARN(...);\n   return 0;\n }\n\nSo developers would know what happened (for debugging why ME was or was not updated) in runtime.",
      "range": {
        "startLine": 398,
        "startChar": 0,
        "endLine": 405,
        "endChar": 11
      },
      "revId": "bb308dee70efc4270287e8ef40ca1f8b17fc34fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}