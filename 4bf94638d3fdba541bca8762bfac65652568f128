{
  "comments": [
    {
      "key": {
        "uuid": "37a18068_18ecbdb1",
        "filename": "firmware/2lib/include/2recovery_reasons.h",
        "patchSetId": 71
      },
      "lineNbr": 250,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "nit: Thematically would fit better in the \"rewritable firmware\" block, e.g. 0x62",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d66db2cb_9567158f",
        "filename": "firmware/2lib/include/2recovery_reasons.h",
        "patchSetId": 71
      },
      "lineNbr": 250,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "It doesn\u0027t look that organized... for example RO_TPM_REC_HASH_L_ERROR is at 0x5f.\nBut I suppose I can move it to 0x62 since that\u0027s where people seem to be putting new stuff?",
      "parentUuid": "37a18068_18ecbdb1",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c8a1eeee_d9aa119e",
        "filename": "firmware/2lib/include/2recovery_reasons.h",
        "patchSetId": 71
      },
      "lineNbr": 250,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T01:09:45Z",
      "side": 1,
      "message": "Yes, unfortunately not everyone paid attention when adding stuff over the years. But we should still try when we can. (Of course this particular one may eventually move from RW to RO at some point, but can\u0027t really anticipate that yet. At least it clearly doesn\u0027t belong in the usermode block.)",
      "parentUuid": "d66db2cb_9567158f",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07ed47d6_d018abb1",
        "filename": "firmware/2lib/include/2recovery_reasons.h",
        "patchSetId": 71
      },
      "lineNbr": 250,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-23T11:13:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c8a1eeee_d9aa119e",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e2659ff_43c9ea2b",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 332,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Right now you check for recovery mode in secdata_kernel_lock() and just return success there... I feel that check would make more sense in this function (just skip calling it when in recovery mode). That\u0027s another good reason to not call this function vb2ex_... for now, because the stuff you\u0027re doing in here is stuff we actually don\u0027t want to move into depthcharge. Only the stuff in secdata_kernel_lock() should be moved there (and the check for recovery mode should also stay inside vboot).",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "641957fc_df9c2bbd",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 332,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "I\u0027m a bit torn on this issue.  We will perform the sequence of commit \u0026 lock in either (A) in vboot_reference or (B) depthcharge.\n\nIn both cases, we want to call the same vb2api_fail functions depending on what error shows up.  In that sense, it would be preferable to avoid duplicating the \"check error cases and call vb2api_fail\" code.\n\nOn the other hand, what you\u0027re suggesting is for these vb2ex functions to not call vb2api_fail at all.  In that case, we\u0027d have to duplicate the error checking in both (A) and (B).  In this case, we would also HAVE TO create vb2_error_t codes for the specific problems, as you suggested in another comment (I believe in one of the unit tests?).\n\nWhat do you think?  Is it worth adding the extra duplication in order to try to keep vb2api_fail calls out of helper functions?",
      "parentUuid": "4e2659ff_43c9ea2b",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bcaeb59d_b4bd1033",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 332,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T01:09:45Z",
      "side": 1,
      "message": "Well, okay, eventually this function (and secdata_kernel_lock()) will go away entirely. When we move locking into depthcharge I think we should implement it as a cleanup_func, so the whole problem of not locking twice completely eliminates itself. But I\u0027m not sure how soon we\u0027ll get there.\n\nFor now, this code just looks a bit weird as written to me because you check for recovery mode when we know that secdata_kernel_lock() can only ever return success for that case anyway. And the whole \"don\u0027t lock in recovery mode\" seems like a higher level policy decision to me that fits better in the higher level function (regardless of the fact that both will eventually need to move to depthcharge).\n\nAlso, the name vb2ex_secdata_kernel_lock() just seems totally wrong here (this isn\u0027t an external callback right now, and I don\u0027t think we\u0027ll ever want that callback in the future either).",
      "parentUuid": "641957fc_df9c2bbd",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cfd3dff2_eb55ce09",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 332,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-23T11:13:03Z",
      "side": 1,
      "message": "Re. implementing as a cleanup_func -- how would this work for the VbExLegacy case?\n\nRe. checking secdata_kernel_lock return value -- let\u0027s move the RECOVERY_MODE check out of secdata_kernel_lock as you suggested.\n\nRe. this function name: I\u0027ve already renamed it to vb2_secdata_kernel_lock -- see the latest patchset.",
      "parentUuid": "bcaeb59d_b4bd1033",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e0083211_174ea424",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 332,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T22:54:54Z",
      "side": 1,
      "message": "cleanup_funcs are run on legacy handoff... see depthcharge/src/boot/payload.c:payload_run()",
      "parentUuid": "cfd3dff2_eb55ce09",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "661d9f6d_8997cbee",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 353,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "nit: maybe add a small comment explaining that this intentionally falls through instead of returning immediately, and why?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f4cd4e4_77b9fa1f",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 353,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Actually, I\u0027m not entirely sure why.  Is it important to try to write as much data as possible when failure is encountered?  Or is it simply to provide for the recovery case?",
      "parentUuid": "661d9f6d_8997cbee",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59502696_2a8c02a3",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 353,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T01:09:45Z",
      "side": 1,
      "message": "It is important that if there\u0027s some persistent problem with writing secdata and we run vb2api_fail() to set a recovery reason for that in nvdata, we\u0027ll still eventually get to the part where we commit that nvdata. So yeah, I think it\u0027s important. (I guess if we exit cleanly after this depthcharge should sync back nvdata anyway... but still, I think it\u0027s better not to skip it here.)",
      "parentUuid": "2f4cd4e4_77b9fa1f",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d4bbab8_54b17086",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 353,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-23T11:13:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "59502696_2a8c02a3",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04ee5e2d_bb337eac",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 357,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "delete?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "302fa84f_2df0254f",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 357,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Depends on the outcome of our discussion on line 332.",
      "parentUuid": "04ee5e2d_bb337eac",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a4d60355_f2cdfbf7",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 433,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Could also just move the call above the goto label instead.",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "24c10722_b13fa1a6",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 71
      },
      "lineNbr": 433,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a4d60355_f2cdfbf7",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2d0407ce_5cd8b937",
        "filename": "firmware/lib/vboot_ui_common.c",
        "patchSetId": 71
      },
      "lineNbr": 50,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "I would combine it with the lock check above, i.e. if either commit() or lock() fails we should beep and back out.",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9f921f8_6f41259e",
        "filename": "firmware/lib/vboot_ui_common.c",
        "patchSetId": 71
      },
      "lineNbr": 50,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "I used separate clauses with different error messages.",
      "parentUuid": "2d0407ce_5cd8b937",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27a8004e_76e00d6e",
        "filename": "firmware/lib/vboot_ui_common.c",
        "patchSetId": 71
      },
      "lineNbr": 51,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Actually, this is probably a good time to move that commit_data *above* the lock() call, now that it may also write to secdata (even though it shouldn\u0027t in any of our current paths).",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6aa8592_091061ca",
        "filename": "firmware/lib/vboot_ui_common.c",
        "patchSetId": 71
      },
      "lineNbr": 51,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "I still want to keep the altfw stuff untouched in this commit.  Stacked CL:1776286 after this one to deal with it.",
      "parentUuid": "27a8004e_76e00d6e",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cca78459_c5534527",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 66,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Uhhh... memsetting these things to 0 isn\u0027t super useful if you later want to memcmp() that everything was read correctly. Can we fill each of them with a unique byte instead?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c058b409_e7c281b5",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 66,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cca78459_c5534527",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "647758e3_50476584",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 373,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Test that CHANGED flag was cleared?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "83f9512e_9cd4a503",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 373,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Done, and added for other firmware/kernel write cases (except for \"no new changes\").",
      "parentUuid": "647758e3_50476584",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "005a1224_8084b967",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 471,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Wait, what\u0027s happening here? Where does this fail_reason come from? This should not get set in this path (recovery reason for TPM lock failures is set at a higher layer)... do these tests pass?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "510a3288_ee3055ec",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 471,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Right -- took it out!",
      "parentUuid": "005a1224_8084b967",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0d2c89ec_e3b04d27",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 481,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Oddly specific test? If anything, I\u0027d check EQ( , 0) (more instances below)",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07267d86_2c765335",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 481,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "I think if we take out all the vb2api_fail calls from secdata_tpm.c, it\u0027s kind of overkill to check for EQ(,0).  So removed this one too.",
      "parentUuid": "0d2c89ec_e3b04d27",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d1df536_e246e1f6",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 495,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Didn\u0027t you put it in a test-accessible global for exactly this reason? Why aren\u0027t you using it? (ResetMocks() should reset it, and then here you could just call secdata_kernel_lock() twice.)",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2958338_a6782526",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 495,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Sometimes I\u0027m too brilliant...\nAdded it to ResetMocks.",
      "parentUuid": "9d1df536_e246e1f6",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e892a0d1_e59eb011",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 508,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "You\u0027re deleting a bunch of old FWMP tests that you only just wrote a couple of patches ago here. Why?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c5f03178_496c2abc",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 508,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "I checked some patchset diffs, and I can\u0027t find the ones you\u0027re talking about... and this is already quite a while ago, so I can\u0027t really remember if I removed some.  Do you know which patchset they were from?  (It\u0027s entirely possible it was for writing FWMP, which we took out.)",
      "parentUuid": "e892a0d1_e59eb011",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f057f11c_899e95d2",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 508,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T01:09:45Z",
      "side": 1,
      "message": "Just diff this patch set against Base and scroll down, there\u0027s a bunch of red on the left side at the end of this function (or what used to be RollbackFwmpTest()). They don\u0027t look obsolete to me (e.g. struct size too small, bad CRC, version differences).",
      "parentUuid": "c5f03178_496c2abc",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3606a802_8e6b4168",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 508,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-23T11:13:03Z",
      "side": 1,
      "message": "Ah, I see.\n\nWe do check this stuff through the vb2api_secdata_*_check calls (which we are mocking out here, and testing separately elsewhere).  And yeah, let\u0027s definitely add a check for one of them, say CRC failure.\n\nBut I\u0027m not sure it makes to check for all possible return values, since at least in the case of secdata_firmware and secdata_kernel, the _check call failing just results in returning TPM_E_CORRUPTED_STATE indescriminately?\n\nIn the case of secdata_fwmp, we can add two cases:\n* CRC failure on first call\n* need more data on first call, CRC failure on second call\n\nDoes that sound sufficient?",
      "parentUuid": "f057f11c_899e95d2",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9fdde646_14466f4c",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 508,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T22:54:54Z",
      "side": 1,
      "message": "I guess all the more detailed stuff is handled by vb2_secdata_fwmp_tests.c, so it should be fine.",
      "parentUuid": "3606a802_8e6b4168",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a81f087_de237b6d",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 545,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Might be good to check that the flag stays EQ( , 0) in some of the other cases.",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "42fdf636_5ab4d0c0",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 545,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Added to all of them for good measure!",
      "parentUuid": "1a81f087_de237b6d",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c993c4cb_2cebb5d4",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 36,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "nit: rename all these things with rkr/rfr in their name to stuff that makes sense for the new names?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a64aacfd_ea1e759f",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 36,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c993c4cb_2cebb5d4",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e89442da_19473cec",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 84,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "This belongs in secdata_tpm_tests, not here. Here you\u0027re overriding secdata_kernel_lock() completely anyway, so this doesn\u0027t affect anything.",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0d8c4d51_8fc2e2de",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 84,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e89442da_19473cec",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e1e87fa2_6f952b47",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 235,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "Do we not have a TPM-read-specific error in vboot2 anymore? Why not make one?",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d378cfa1_5f200a6e",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 235,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "See the other comment thread about where to invoke vb2api_fail.  If we keep it out of the vb2ex functions, then we *will* need to create some error values here.  And they will need to have a 1-to-1 mapping to these recovery values.  Well, we probably don\u0027t need to differentiate RO/RW since we\u0027re already in the RW world here.  (Except for recovery, but we always seem to use RW anyways.)",
      "parentUuid": "e1e87fa2_6f952b47",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2951b4c2_19f806ca",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 235,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T01:09:45Z",
      "side": 1,
      "message": "Hmm... okay, if you\u0027re saying that we\u0027ll move all the TPM stuff out of vboot anyway so we won\u0027t need TPM access errors, I guess we can keep using UNKNOWN for now. (Although, on the other hand, errors are really cheap even if we only use them for a couple of months.)\n\nI\u0027m not really sure I follow you on the whole vb2api_fail() stuff. Of course, when secdata reading happens in depthcharge, depthcharge would call vb2api_fail() and reboot if that fails. It can\u0027t really \"pass in\" an error into kernel_phase1(), after all. (Same for writing it back after we exit out of vboot. Although when vb2ex_commit_data() fails, that\u0027s a different thing and there I think it should just return an error and vboot can decide what to do with that.)",
      "parentUuid": "d378cfa1_5f200a6e",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa814c7a_8b04b9ac",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 235,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-23T11:13:03Z",
      "side": 1,
      "message": "The vb2ex_commit_data call is the one that I\u0027m talking about.  If vboot needs to handle the vb2api_fail calls, then we need the set of return values to pass through vb2ex_commit_data.",
      "parentUuid": "2951b4c2_19f806ca",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07b3c984_f1a1a65e",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 235,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-23T22:54:54Z",
      "side": 1,
      "message": "I see. Yes, for vb2ex_commit_data(), if it does 3 distinct things that could all individually fail, I think it should have 3 different return codes to return. I think we should do that regardless of where the recovery reason is set.\n\nFor the vb2api_fail(), if you believe it makes things a lot simpler to do it inside the callback, I think that\u0027s okay too. If it\u0027s no big deal either way, doing it in vboot seems cleaner.",
      "parentUuid": "aa814c7a_8b04b9ac",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "833563fb_74f6519f",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 271,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-11T02:46:53Z",
      "side": 1,
      "message": "...same for these...",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d714afb2_bf23aabe",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 71
      },
      "lineNbr": 271,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-10-22T14:47:04Z",
      "side": 1,
      "message": "See above.",
      "parentUuid": "833563fb_74f6519f",
      "revId": "4bf94638d3fdba541bca8762bfac65652568f128",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}