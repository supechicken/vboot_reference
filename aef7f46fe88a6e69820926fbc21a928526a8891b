{
  "comments": [
    {
      "key": {
        "uuid": "f566c85f_181d6661",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 192,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-20T08:08:15Z",
      "side": 1,
      "message": "Rename this function.",
      "range": {
        "startLine": 192,
        "startChar": 12,
        "endLine": 192,
        "endChar": 30
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "451dd7fd_ca06fa48",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 192,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-22T05:05:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f566c85f_181d6661",
      "range": {
        "startLine": 192,
        "startChar": 12,
        "endLine": 192,
        "endChar": 30
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1fc2e5fa_ca7e216c",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 199,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T03:10:47Z",
      "side": 1,
      "message": "I guess we don\u0027t need to call screen-\u003einit() again. The result of the init function should be exactly the same as the previous call to it, right?",
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d325658_de9cdc7c",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 199,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-22T05:05:16Z",
      "side": 1,
      "message": "Actually, I\u0027m not so sure.  In the recovery code that you asked me to move to a separate CL, it would be useful for init() to run regardless, as a check of \"should this screen be shown\".  Otherwise, we have to do that weird hack that I did of setting it for both .init and .action, and it will show for a split second before disappearing.  But on the other hand, we want to keep the nice property of selected_item being preserved.\n\nMaybe this would be a good time to re-formulate init() functions like you previously mentioned -- rejecting the screen change when an error value is returned.  We could also add an argument called something like `is_reinit` so the function knows to just check permissions, or also to initialize selected_item and disabled_item_mask.",
      "parentUuid": "1fc2e5fa_ca7e216c",
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4b262315_d6e8a814",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 199,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T08:04:26Z",
      "side": 1,
      "message": "\u003e is_reinit\n\nWe can categorize what the existing init functions do into:\n\n(a) Check if it\u0027s allow to enter the screen. If not, call vb2_ui_change_root().\n(b) Initialize selected_item.\n(c) Reset \"static\" variables in ui_context (such as ui-\u003ephysical_presence_button_pressed).\n\nUpon entering a new screen that is not in the stack, we want to run all of the above. When going \"back\" to a screen that is already in the stack, however, we only want to do (a) and (c). Adding an argument \u0027is_reinit\u0027 to the init() functions sounds fine to me.\n\n\n\u003e rejecting the screen change when an error value is returned\n\nThis has always been my preference. Then we could avoid calling vb2_ui_change_screen() from the init functions. In vb2_ui_screen_back(), it would become something like\n\n while (ui-\u003estate \u0026\u0026 ui-\u003estate-\u003eprev) {\n     tmp \u003d ui-\u003estate-\u003eprev;\n     free(ui-\u003estate);\n     ui-\u003estate \u003d tmp;\n     if (ui-\u003estate-\u003escreen-\u003einit(ui, is_reinit\u003d1) \u003d\u003d UI_CONTINUE)\n         break;\n }\n\nand in vb2_ui_change_screen() when !state_exists,\n\n cur_state-\u003eprev \u003d ui-\u003estate;\n cur_state-\u003escreen \u003d new_screen_info;\n ui-\u003estate \u003d cur_state;\n if (ui-\u003estate-\u003escreen-\u003einit(ui, is_reinit\u003d0) \u003d\u003d UI_ERROR) {\n     // Reject entering new screen\n     return vb2_ui_screen_back(ui);\n }\n\nAnyway, feel free to do it in a separate CL.",
      "parentUuid": "3d325658_de9cdc7c",
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5fcc9d6e_c1b255ea",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 199,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-22T08:43:44Z",
      "side": 1,
      "message": "\u003e When going \"back\" to a screen that is already in the stack, however, we only want to do (a) and (c)\nNot necessarily -- DEVELOPER_MODE\u0027s ui-\u003estart_time should only be initialized once.\n\nAs for rejecting a state -- we could also pass in the state as an argument to init(), rather than placing it on top of the screen stack temporarily (for failure case).\n\n\u003e Anyway, feel free to do it in a separate CL.\nSGTM",
      "parentUuid": "4b262315_d6e8a814",
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3dfb715c_8bbb9d96",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 226,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T03:10:47Z",
      "side": 1,
      "message": "Move this block into the \u0027else\u0027 block below?",
      "range": {
        "startLine": 222,
        "startChar": 1,
        "endLine": 226,
        "endChar": 2
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8ad29904_9af3fc0f",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 226,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-22T05:05:16Z",
      "side": 1,
      "message": "I actually prefer doing this check up front -- if the requested screen doesn\u0027t exist, then nothing should proceed.",
      "parentUuid": "3dfb715c_8bbb9d96",
      "range": {
        "startLine": 222,
        "startChar": 1,
        "endLine": 226,
        "endChar": 2
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8de225e6_a8622ea9",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 226,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T08:04:26Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "8ad29904_9af3fc0f",
      "range": {
        "startLine": 222,
        "startChar": 1,
        "endLine": 226,
        "endChar": 2
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "81219a5c_94ae0d49",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 243,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T03:10:47Z",
      "side": 1,
      "message": "Is it simpler to call vb2_ui_change_root()?",
      "range": {
        "startLine": 241,
        "startChar": 3,
        "endLine": 243,
        "endChar": 19
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85873889_8679e174",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 243,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-22T05:05:16Z",
      "side": 1,
      "message": "Yes, it would accomplish the same thing here.  However it seems a bit dangerous to introduce a dependency on this function, especially when it doesn\u0027t provide any feedback as to whether it actually popped a screen off the stack or not.  What do you think?",
      "parentUuid": "81219a5c_94ae0d49",
      "range": {
        "startLine": 241,
        "startChar": 3,
        "endLine": 243,
        "endChar": 19
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7a3750ff_ed003fef",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 6
      },
      "lineNbr": 243,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T08:04:26Z",
      "side": 1,
      "message": "I\u0027m okay if we\u0027re keep this as is.",
      "parentUuid": "85873889_8679e174",
      "range": {
        "startLine": 241,
        "startChar": 3,
        "endLine": 243,
        "endChar": 19
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "131f9178_46a64da7",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 6
      },
      "lineNbr": 222,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T03:10:47Z",
      "side": 1,
      "message": "Could we add this in a separate CL?\n\nAlso, we may want to add a BACK button to this screen.",
      "range": {
        "startLine": 222,
        "startChar": 12,
        "endLine": 222,
        "endChar": 35
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ca317455_d73b0809",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 6
      },
      "lineNbr": 222,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-22T05:05:16Z",
      "side": 1,
      "message": "Yeah, sure.  We can do this in a separate CL.  Note that without this modification, unplugging an invalid USB disk will result in putting you back on the root INSERT screen regardless of where you were in the flow.",
      "parentUuid": "131f9178_46a64da7",
      "range": {
        "startLine": 222,
        "startChar": 12,
        "endLine": 222,
        "endChar": 35
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86897f3b_53880f3d",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 6
      },
      "lineNbr": 222,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T08:04:26Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "ca317455_d73b0809",
      "range": {
        "startLine": 222,
        "startChar": 12,
        "endLine": 222,
        "endChar": 35
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ccafd2da_4cc9f4a5",
        "filename": "firmware/2lib/include/2ui.h",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-06-22T03:10:47Z",
      "side": 1,
      "message": "const?",
      "range": {
        "startLine": 59,
        "startChar": 1,
        "endLine": 59,
        "endChar": 7
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c899d4ed_3c5580f5",
        "filename": "firmware/2lib/include/2ui.h",
        "patchSetId": 6
      },
      "lineNbr": 59,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-06-22T05:05:16Z",
      "side": 1,
      "message": "I don\u0027t think that works here... since we will want to be able to modify the contents of both this pointer and its data.  The pointer also needs to be copied into vb2_ui_context.state, which isn\u0027t const.",
      "parentUuid": "ccafd2da_4cc9f4a5",
      "range": {
        "startLine": 59,
        "startChar": 1,
        "endLine": 59,
        "endChar": 7
      },
      "revId": "aef7f46fe88a6e69820926fbc21a928526a8891b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}