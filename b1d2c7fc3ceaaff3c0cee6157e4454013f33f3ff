{
  "comments": [
    {
      "key": {
        "uuid": "e4aecd2c_fccf4407",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 8
      },
      "lineNbr": 480,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-14T22:58:37Z",
      "side": 1,
      "message": "I don\u0027t think this will work... you can\u0027t sizeof() a forward-declared structure. If you want to hide the full layout of struct VbSharedDataHeader from the caller (which sounds good), you\u0027ll need to define a constant for the size.",
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf3e9400_09b57b85",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 8
      },
      "lineNbr": 480,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-19T06:31:49Z",
      "side": 1,
      "message": "Well... in our case the caller (depthcharge) needs to inspect the contents of VbSharedDataHeader, and will thus explicitly include \u003cvboot_struct.h\u003e to do so.  Or should I write that this header should be included to get access to the struct, as part of the function documentation?\n\nI could also add a VB2_VBSD_SIZE constant to 2constants.h, but it seems like a moot point if the caller needs to include the definition in order to read the struct anyways.",
      "parentUuid": "e4aecd2c_fccf4407",
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9235ddf5_00cfee15",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 8
      },
      "lineNbr": 480,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-20T01:40:21Z",
      "side": 1,
      "message": "But it shouldn\u0027t need to inspect the structure? Can\u0027t we fix that? Instead of VBSD_BOOT_DEV_SWITCH_ON it can use the context flag, instead of VBSD_BOOT_FIRMWARE_WP_ENABLED it can just use the flag_fetch() result directly, etc.",
      "parentUuid": "bf3e9400_09b57b85",
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0ba498e4_915b4895",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 8
      },
      "lineNbr": 480,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-20T10:03:44Z",
      "side": 1,
      "message": "Well... yeah, that didn\u0027t really occur to me.  In that case, let\u0027s change the argument here to be an opaque uint8_t pointer.",
      "parentUuid": "9235ddf5_00cfee15",
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "359a5bab_73fcbd32",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 8
      },
      "lineNbr": 239,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-14T22:58:37Z",
      "side": 1,
      "message": "uintptr_t",
      "range": {
        "startLine": 239,
        "startChar": 1,
        "endLine": 239,
        "endChar": 9
      },
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e949ed65_65bb80ba",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 8
      },
      "lineNbr": 239,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-19T06:31:49Z",
      "side": 1,
      "message": "Is this not guaranteed to be of size uint32_t on all platforms?",
      "parentUuid": "359a5bab_73fcbd32",
      "range": {
        "startLine": 239,
        "startChar": 1,
        "endLine": 239,
        "endChar": 9
      },
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d24c5d4_3296f75f",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 8
      },
      "lineNbr": 239,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-20T01:40:21Z",
      "side": 1,
      "message": "For x86 maybe they still run all firmware in 32-bit mode, but our Arm64 devices boot straight into 64-bit. (So no, pointer sizes are most definitely platform-dependent.)\n\nIn fact we have some old Arm devices where early stages run in 32-bit mode and later stages run in 64-bit mode, so... uhh... those have probably been broken for a while, actually. High time we fix this and never do something like that again (putting a pointer type into a serialized data structure).",
      "parentUuid": "e949ed65_65bb80ba",
      "range": {
        "startLine": 239,
        "startChar": 1,
        "endLine": 239,
        "endChar": 9
      },
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a544f81f_fdd003e4",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 8
      },
      "lineNbr": 239,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-20T10:03:44Z",
      "side": 1,
      "message": "Ah, got it.  Kind of awkward to have different vb2_context sizes across different platforms.  Can we fix this as part of the v2.0 uprev?",
      "parentUuid": "9d24c5d4_3296f75f",
      "range": {
        "startLine": 239,
        "startChar": 1,
        "endLine": 239,
        "endChar": 9
      },
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1101dccb_ce2cc533",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 8
      },
      "lineNbr": 239,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-20T23:04:11Z",
      "side": 1,
      "message": "I\u0027m not quite sure what you\u0027re talking about... yes, using a variable-width data type in any of these structures is very bad and we should never do that. I believe the one you\u0027re removing here is the only instance we had? I don\u0027t see anything in vb2_context that would make its size variable.",
      "parentUuid": "a544f81f_fdd003e4",
      "range": {
        "startLine": 239,
        "startChar": 1,
        "endLine": 239,
        "endChar": 9
      },
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ef4e52f5_c3eff66d",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 8
      },
      "lineNbr": 239,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-20T23:09:04Z",
      "side": 1,
      "message": "edit: oh, you mean because it\u0027s still a uintptr_t now. Yes, that\u0027s bad, and yes, we should get rid of that at the next major version bump opportunity.",
      "parentUuid": "1101dccb_ce2cc533",
      "range": {
        "startLine": 239,
        "startChar": 1,
        "endLine": 239,
        "endChar": 9
      },
      "revId": "b1d2c7fc3ceaaff3c0cee6157e4454013f33f3ff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}