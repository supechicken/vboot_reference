{
  "comments": [
    {
      "key": {
        "uuid": "45e8ab38_0cdd3d03",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 277,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-03-26T23:43:27Z",
      "side": 1,
      "message": "Not really happy about this because it means that we\u0027ll get an endless reboot loop if this condition doesn\u0027t clear for some reason. We need to be able to drop into recovery mode in that case instead.\n\nMaybe we should add another sd-\u003eflag so we can track whether Hmir got updated on this boot?",
      "revId": "ac477034d850f047902d2291fd0042b196b146b6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "236a29fa_4018c326",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 283,
      "author": {
        "id": 1283719
      },
      "writtenOn": "2020-03-26T18:09:09Z",
      "side": 1,
      "message": "Per EC-EFS2 design, AP should request CR50 to reset EC to clear NO-BOOT mode. \nCould you confirm if this would do that?\n\nI did a quick code search how this return value ended, and found these two.\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/master:src/third_party/coreboot/src/security/vboot/ec_sync.c;drc\u003d1c0523fb018848fe18ff59721a28e2c98529f852;l\u003d71\n\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/master:src/platform/depthcharge/src/vboot/stages.c;drc\u003de6b1b35f1cbd9d34587ba4113211d2c52f230250;l\u003d252\n\nThese two uses either google_chromeec_reboot() or reboot_to_ro(), which looks like to request EC to reset directly.",
      "range": {
        "startLine": 283,
        "startChar": 0,
        "endLine": 283,
        "endChar": 42
      },
      "revId": "ac477034d850f047902d2291fd0042b196b146b6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b61efd05_6740f68d",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 283,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-03-26T23:43:27Z",
      "side": 1,
      "message": "Is there a reason this would need to go through H1?",
      "parentUuid": "236a29fa_4018c326",
      "range": {
        "startLine": 283,
        "startChar": 0,
        "endLine": 283,
        "endChar": 42
      },
      "revId": "ac477034d850f047902d2291fd0042b196b146b6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7cd6d99e_d7c26eec",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 283,
      "author": {
        "id": 1283719
      },
      "writtenOn": "2020-03-27T00:20:59Z",
      "side": 1,
      "message": "Cr50 can\u0027t detect EC reset reliably. As I\u0027ve learned, the behaviors are different among platforms. So we designed to request CR50 to reset EC, so that CR50 can recognize EC reset and also clears NO_BOOT boot mode, and this is what the design doc(go/ec-efs2) says at least.\n\nLooks like this implementation is different. This is what I understand. From here, AP will request EC to reset -\u003e EC-RO will request CR50 to verify ECRW hash -\u003e CR50 sees that the given ECRW hash matches to H_mir (Hash in TPM kernel secdata). BTW, Boot mode is NO_BOOT, not NORMAL, so CR50 decides to reset EC (per the EC-EFS2 design) and to clear NO_BOOT mode.\nhttps://source.corp.google.com/chromeos_public/src/platform/cr50/common/ec_efs.c;rcl\u003d708277bd1ebb5d9a4dccc875708c3d5018eebd8f;l\u003d248\n\nAt the end, the results are same, so I am ok with this implementation, but the design document and implementation should be synced.",
      "parentUuid": "b61efd05_6740f68d",
      "range": {
        "startLine": 283,
        "startChar": 0,
        "endLine": 283,
        "endChar": 42
      },
      "revId": "ac477034d850f047902d2291fd0042b196b146b6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8401f5b2_5b31bebe",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 1
      },
      "lineNbr": 283,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-03-28T00:41:53Z",
      "side": 1,
      "message": "So you\u0027re saying we end up at the same result but it takes longer (because the EC needs to be reset twice)? In that case, if that delay is significant, it might make sense to change depthcharge to just ask Cr50 for the reset directly.",
      "parentUuid": "7cd6d99e_d7c26eec",
      "range": {
        "startLine": 283,
        "startChar": 0,
        "endLine": 283,
        "endChar": 42
      },
      "revId": "ac477034d850f047902d2291fd0042b196b146b6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}