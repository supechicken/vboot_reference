{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9ab8538e_f809f864",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 13
      },
      "lineNbr": 0,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T01:47:10Z",
      "side": 1,
      "message": "updated to reflect the latest GVD structure, ptal",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af1a0b00_2e6b57b5",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 92,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "I think you\u0027ll need another parameter to set gsc_board_id?",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c17730fb_0645fe1c",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 92,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "this will have to be further refined: what board ID do we use when signing, how is the board ID delivered to the signer, what is the benefit of having board_id in the sturcture, etc.\n\nmay I suggest we discuss this further and add it once it has been discussed - it would be a small incremental change.",
      "parentUuid": "af1a0b00_2e6b57b5",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d3a939b5_0f01fb02",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 92,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T23:42:57Z",
      "side": 1,
      "message": "The benefit is to prevent attackers from potentially installing firmware for a different Chromebook and exploiting some vulnerability that way. This may seem unlikely but sometimes different variants of the same model have very similar firmware, so installing one on the other board may still boot but maybe just misconfigure a few GPIOs or something, which may have a security impact. For further defense-in-depth we want to make sure those kinds of scenarios are impossible to begin with.\n\nHow the signer figures it out will need to be determined as part of your overall signing design for this. Maybe the board ID could be stored in the keyset file together with the keys themselves... but I\u0027m not sure if keysets and firmware builds actually map 1-to-1 these days (or at least many-to-1 in the case of LOEM keysets, but not 1-to-many).\n\nWe could also get it straight from the source -- because the board ID is supposed to exactly match the AP firmware build target, maybe the best way would be to analyze the AP firmware and figure out the board ID from there. coreboot stores its whole config in CBFS so one way would be to get the `config` file out of the image with cbfstool, find the CONFIG_MAINBOARD_PART_NUMBER line, and then look that up in some table that matches coreboot build targets to GSC board IDs. Or we could also just add a new coreboot Kconfig that\u0027s called CONFIG_CR50_BOARD_ID and hardcode this info directly in coreboot.\n\nWhichever way we do it I think it will end up being something that the signer has to look up out of band somehow and then pass in here on the command line, so we\u0027ll still need that command line parameter either way.",
      "parentUuid": "c17730fb_0645fe1c",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1c2f9967_455c4392",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 92,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-13T00:29:45Z",
      "side": 1,
      "message": "I like the idea of retrieving it from the AP firmware image, and not setting the GVD field if board id is not in found in the image.\n\nAlso, maybe GVD structure should be modified to include the board_id_mask field the same way GSC does it.\n\nBasically, I would like this feature to be available in development environment, and when people work on their AP firmware Board ID might be not known yet, or the same AP firmware image could be run on different devices. \n\nAs I said, let\u0027s leave adding this command line argument as a future enhancement in case we can\u0027t avoid it, it would be a small incremental change.\n\nFor now I could add the board_id_mask field.",
      "parentUuid": "d3a939b5_0f01fb02",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab9ede12_9633b007",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 92,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-14T01:33:20Z",
      "side": 1,
      "message": "Well, wherever the signer ultimately chooses to get this from, it still needs to be put into the GSCVD by this utility, right? So we definitely need that command line option? I don\u0027t really understand what you want to wait for there, this needs to be written into the GSCVD before signing it, so this utility seems to be the only place to do that.\n\nFor the developer use case, that\u0027s supposed to be handled by just disabling RO verification on the GSC via CCD anyway (for the Dauntless story, for the Cr50 story just don\u0027t press the key combination when you have a custom image on there). There\u0027s no plan to have any sort of \"developer signing\" for this. That would be dangerous, because we don\u0027t have separate developer keys for this on the GSC, so any image you sign that has fewer restrictions that normal production images becomes a potential security risk if it leaks somewhere. I\u0027d prefer to not design any mechanism that allows that in the first place if we are not planning to use it in production.",
      "parentUuid": "1c2f9967_455c4392",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4bd66d66_fd81decc",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 459,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "Can use vb2_init_signature()",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f88a77e_c9cc93db",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 459,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4bd66d66_fd81decc",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0df5a91a_055fc62f",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 467,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "Can use vb2_init_packed_key()",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3324414d_aa25b53a",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 467,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0df5a91a_055fc62f",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d8d87d35_baaae894",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 864,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "This functionality already exists in futility/cmd_pcr.c (parse_hex() / parse_digest_or_die()), please factor it out from there into some common file (maybe futility/misc.c) and reuse it here.",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "303c593a_368802da",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 864,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d8d87d35_baaae894",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3fb58ac1_e5580e07",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 910,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "Let\u0027s use vboot APIs instead of OpenSSL here. You can declare the root key as\n\n struct vb2_hash root_key_digest_input \u003d { .algo \u003d VB2_HASH_SHA256 };\n \n(then later write the bytes into root_key_digest_input.sha256[]), and then this just becomes\n\n vb2_hash_verify(...key_offset, ...key_size, \u0026root_key_digest_input)",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c3fe98da_a592ab5d",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 910,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3fb58ac1_e5580e07",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f25eab0_6cf9e490",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 934,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "typo",
      "range": {
        "startLine": 934,
        "startChar": 3,
        "endLine": 934,
        "endChar": 7
      },
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "569d28bb_60992930",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 934,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2f25eab0_6cf9e490",
      "range": {
        "startLine": 934,
        "startChar": 3,
        "endLine": 934,
        "endChar": 7
      },
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fef19214_1bda3e88",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 940,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "Here too.\n\n struct vb2_hash hash;\n vb2_hash_calculate(...key_offset, pubk-\u003ekey_size, VB2_HASH_SHA256, \u0026hash);\n ...print out hash.sha256[]...",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "34a928e6_07c4dabd",
        "filename": "futility/cmd_gscvd.c",
        "patchSetId": 13
      },
      "lineNbr": 940,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fef19214_1bda3e88",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fddce39b_17715ac2",
        "filename": "host/lib/include/gsc_ro.h",
        "patchSetId": 13
      },
      "lineNbr": 37,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-10-12T02:41:14Z",
      "side": 1,
      "message": "BTW I think you forgot to check this in the Cr50 implementation, that still needs to be added.",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6b7d297d_8c48eb3d",
        "filename": "host/lib/include/gsc_ro.h",
        "patchSetId": 13
      },
      "lineNbr": 37,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2021-10-12T04:49:43Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "fddce39b_17715ac2",
      "revId": "668715afed72c0f182c3fea87c03222ae0af63f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}