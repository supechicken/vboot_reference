{
  "comments": [
    {
      "key": {
        "uuid": "434b4cb9_d67eacda",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 22,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "This needs a CQ-DEPEND on a depthcharge patch, right?",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ab03d0c_8a329f44",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 22,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "434b4cb9_d67eacda",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c80f1a24_ea2acce4",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 1009,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "Shouldn\u0027t it just be 9? Or do you want to display a separate entry for the \"0\" (default)? Since it should always be an alias of the other ones that\u0027s probably not that useful...",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c65d639_d4d73089",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 1009,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c80f1a24_ea2acce4",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "33fa0d0b_68da4a63",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 1014,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "I think either you should check and do something useful with this error value in the code, or the callback should just return the mask value (if there was some error looking the AltFW up, just returning 0 sounds reasonable).",
      "range": {
        "startLine": 1014,
        "startChar": 0,
        "endLine": 1014,
        "endChar": 9
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7bec70f0_8223e13c",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 1014,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "33fa0d0b_68da4a63",
      "range": {
        "startLine": 1014,
        "startChar": 0,
        "endLine": 1014,
        "endChar": 9
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1801c707_63c73e40",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 235,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "nit: outdated comment, there\u0027s no timeout anymore",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0b100d2_808aa87c",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 235,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1801c707_63c73e40",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "23bbc50c_ff02e79e",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 253,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "Shouldn\u0027t this be \u00271\u0027...\u00279\u0027?",
      "range": {
        "startLine": 253,
        "startChar": 8,
        "endLine": 253,
        "endChar": 9
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "82cea77d_f5f6b1d3",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 253,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "0 means the default bootloader. I\u0027ll add a comment.",
      "parentUuid": "23bbc50c_ff02e79e",
      "range": {
        "startLine": 253,
        "startChar": 8,
        "endLine": 253,
        "endChar": 9
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2abbe1e6_0883a770",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 253,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-11-09T01:25:58Z",
      "side": 1,
      "message": "I\u0027m just confused why we would allow that here... we don\u0027t display or highlight the default bootloader on this screen either, right? If people enter this menu they already want to look at the list rather than boot an some automatic option directly, so it seems very odd to offer them this \"default\" choice here then, when they already have the info they need to press the right button for what they want instead.\n\nOn the other hand, in vb2_developer_ui() you only allow 1..9, whereas that\u0027s the one where I think allowing 0 would actually make some sense (for people who just want to boot the default choice right away without going through the menu). Did you maybe confuse which situation this function is handling vs. the other one?",
      "parentUuid": "82cea77d_f5f6b1d3",
      "range": {
        "startLine": 253,
        "startChar": 8,
        "endLine": 253,
        "endChar": 9
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66929da2_0069ddf0",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 253,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-09T16:23:43Z",
      "side": 1,
      "message": "Well I quite like the idea of allowing \u00270\u0027 everywhere, having thought about it a bit.\n\nThe reason is that there is otherwise no way to select the default option from the altfw menu. I support we could display a prompt like (\u0027default\u0027) next to the default one.\n\nI\u0027ll add comments everywhere to explain that it is intentional. We can always adjust it later if needed.",
      "parentUuid": "2abbe1e6_0883a770",
      "range": {
        "startLine": 253,
        "startChar": 8,
        "endLine": 253,
        "endChar": 9
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6715c555_ddd99559",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 283,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "nit: dash for consistency? (Or maybe just drop the second sentence from both of these, not sure if it\u0027s really that useful.)",
      "range": {
        "startLine": 283,
        "startChar": 19,
        "endLine": 283,
        "endChar": 20
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fb450427_e2bc87d0",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 283,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6715c555_ddd99559",
      "range": {
        "startLine": 283,
        "startChar": 19,
        "endLine": 283,
        "endChar": 20
      },
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "94860e91_94b30e94",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 346,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "This... whole thing still seems way to complicated for me. You should have exactly 10 menu entries (1-9 and Cancel) in the menu struct, then current_menu_idx is easy to use. You just don\u0027t display the ones that aren\u0027t used. You should use the disabled_idx_mask global for that, that already implements all the behavior you need (e.g. when you arrow-up it skips over disabled entries that are not being displayed). You also don\u0027t need to allocate any menu entries dynamically, you just do this in the menu definition below:\n\n  [VB_MENU_ALT_FW] \u003d {\n    .screen \u003d VB_SCREEN_ALT_FW_MENU,\n    .items \u003d (struct vb2_menu_item[]){\n      {\n        .text \u003d \"Bootloader 1\",\n        .action \u003d altfw_action,\n      },\n      {\n        .text \u003d \"Bootloader 2\",\n        .action \u003d altfw_action,\n      },\n      ...\n      {\n        .text \u003d \"Cancel\",\n        .action \u003d enter_dev_warning_menu,\n      },\n  },\n\nAnd then you add this to vb2_change_menu():\n\n  if (current_menu \u003d\u003d VB_MENU_ALT_FW)\n    disabled_idx_mask \u003d ((1 \u003c\u003c 9) - 1) \u0026 ~(VbExGetAltFwIdxMask() \u003e\u003e 1);\n\n(Maybe change the API for VbExGetAltFwIdxMask a bit to make that math less ugly, this should be the only place you need it anyway.)\n\nWith that (and the right depthcharge code to actually hide those entries, since you probably can\u0027t use the standard implementation of vboot_draw_menu()... but it just takes a one-liner to skip an entry) I think this should all work out and you can just do vb2_run_altfw(current_menu_idx + 1) here.",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bcbe6472_34d8b738",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 346,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "I\u0027m not 100% convinced this is an improvement.\n\n- lots of menu items, all the same (adds 40 lines of code)\n- removes ~5 lines of code here\n- removes vb2_init_altfw_menu() (35 LOC)\n- I think the logic in DC is a wash, but haven\u0027t tried yet\n\nSo perhaps it makes the code simpler? Not sure. Anyway I\u0027ve coded it up so you can compare, I\u0027m fine with either option and I have a lot less experience maintaining this code.\n\nBTW you used enter_dev_warning_menu - was that intentional?",
      "parentUuid": "94860e91_94b30e94",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c9ab7c07_74ed1b9f",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 346,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-11-09T01:25:58Z",
      "side": 1,
      "message": "Thanks, I think the second option you have now is better. The total LOC might be similar, but I think the boilerplate code from array definitions add less cognitive load than actual code. Also, I think reusing the disabled_idx_mask mechanism makes it more consistent with other menus.\n\n\u003e BTW you used enter_dev_warning_menu - was that intentional?\n\nNo, you\u0027re right, I forgot the menu structure... enter_developer_menu() is the right one to return to from here.",
      "parentUuid": "bcbe6472_34d8b738",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "73a11d6d_bd6d4316",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 346,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-09T16:23:43Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c9ab7c07_74ed1b9f",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "37eba65c_43d421da",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 834,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-10-26T23:42:01Z",
      "side": 1,
      "message": "Well... but adding another init function also seems not that clean. Why not just check ctx.flags \u0026 VB2_CONTEXT_RECOVERY_MODE in vb2_init_menus()? (Then again, I don\u0027t think you should need to allocate anything dynamically at all here anymore, see above.)",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9f1f9ac_fc293f4c",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 834,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-07T23:26:38Z",
      "side": 1,
      "message": "This way the code is not even executed in dev mode, but anyway I don\u0027t see a problem with either approach.\n\nWith the above changes, this goes away.",
      "parentUuid": "37eba65c_43d421da",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6c11f46b_5edff556",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 834,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2018-11-09T01:25:58Z",
      "side": 1,
      "message": "Well, it\u0027s not executed if you just put a\n\n if (ctx.flags \u0026 VB2_CONTEXT_RECOVERY_MODE)\n   return;\n\nright above it either, right? I don\u0027t really see the difference.",
      "parentUuid": "c9f1f9ac_fc293f4c",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "95ad054a_dd5fc437",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 4
      },
      "lineNbr": 834,
      "author": {
        "id": 1165921
      },
      "writtenOn": "2018-11-09T16:23:43Z",
      "side": 1,
      "message": "Sure, I mean that it is nice to have it in a function which is not called at all except in dev mode. Less to worry about. Anyway it doesn\u0027t matter now.",
      "parentUuid": "6c11f46b_5edff556",
      "revId": "f0b1797ce0c779a3f84b39c263ebd926c499c4e0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}