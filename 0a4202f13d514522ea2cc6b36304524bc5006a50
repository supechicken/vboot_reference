{
  "comments": [
    {
      "key": {
        "uuid": "dadf6896_db45d9bf",
        "filename": "firmware/include/tlcl.h",
        "patchSetId": 11
      },
      "lineNbr": 93,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2018-04-04T19:51:25Z",
      "side": 1,
      "message": "should these be also included only for the host side under #ifdef CHROMEOS_ENVIRONMENT?\nwhy increase the attack surface inside firmware by adding the commands it doesn\u0027t need there?\n\nin general, I feel we are coming to the point where it makes sense to split Tlcl used in firmware from Tlcl (with not necessarily the same API) for userland. mostly for these reasons, plus less worrying about stack size in userland allowing a better design, etc.\nbut that\u0027s a separate story, bigger than this CL.",
      "range": {
        "startLine": 93,
        "startChar": 9,
        "endLine": 93,
        "endChar": 26
      },
      "revId": "0a4202f13d514522ea2cc6b36304524bc5006a50",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5bba8544_b399eaaf",
        "filename": "firmware/include/tlcl.h",
        "patchSetId": 11
      },
      "lineNbr": 93,
      "author": {
        "id": 1135824
      },
      "writtenOn": "2018-04-09T09:37:19Z",
      "side": 1,
      "message": "I can do so, but figured that since I share implementation anyways, there\u0027s no need to hide the declaration. Then again, all the auth stuff is restricted to CHROMEOS_ENVIRONMENT anyways, so maybe it doesn\u0027t make too much sense to share implementation after all... What\u0027s your preference? I don\u0027t feel strongly.\n\nRegarding the design aspect: I\u0027m thinking of Tlcl as \"lightweight TPM access library\". Suitability for inclusion in firmware is obviously the main requirement. Even though the stuff I\u0027m adding here isn\u0027t currently used in firmware, I\u0027ve written the code in a way that should allow firmware to use the functionality should it need it in the future. Thus, the #ifdefs are purely to remove dead code in the firmware build.\n\nI\u0027m not sure breaking up Tlcl or creating an entirely separate library for userland is going to be a net win as it increases the number of TPM 1.2 stacks we have to maintain from 2 -\u003e 3. The design improvements would have to be significant to outweigh that cost.",
      "parentUuid": "dadf6896_db45d9bf",
      "range": {
        "startLine": 93,
        "startChar": 9,
        "endLine": 93,
        "endChar": 26
      },
      "revId": "0a4202f13d514522ea2cc6b36304524bc5006a50",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "60c22657_83125e55",
        "filename": "firmware/include/tlcl.h",
        "patchSetId": 11
      },
      "lineNbr": 93,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2018-04-10T22:11:09Z",
      "side": 1,
      "message": "ah, right, TlclDefineSpace now uses TlclDefineSpaceEx. no need to hide under CHROMEOS_ENVIRONMENT then.\n\nfor splitting: for tpm 2.0, we could use the full set of commands supported by libtrunks directly with /dev/tpm0 instead of sending to trunksd - and that\u0027s the only diff of mount-encrypted from typical tpm-communicating entities. libtrunks is not exactly lightweight, but that reduces the number of libs back to 2 (and 1 is strictly for f/w, while 1 for OS, what makes more sense). unfortunately, not the case for tpm 1.2, but maybe something similar can be done there as well. plus many utilities define their TpmImpl vs Tpm2Impl for a common class Tpm interface. it may make sense to just gather all those in a new \u0027THCL\u0027 library, providing tpm-version-agnostic API instead. but all that\u0027s a very separate story, indeed.",
      "parentUuid": "5bba8544_b399eaaf",
      "range": {
        "startLine": 93,
        "startChar": 9,
        "endLine": 93,
        "endChar": 26
      },
      "revId": "0a4202f13d514522ea2cc6b36304524bc5006a50",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22cc50cf_de4d530e",
        "filename": "firmware/include/tlcl.h",
        "patchSetId": 11
      },
      "lineNbr": 102,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2018-04-04T19:51:25Z",
      "side": 1,
      "message": "nit: too",
      "range": {
        "startLine": 102,
        "startChar": 74,
        "endLine": 102,
        "endChar": 76
      },
      "revId": "0a4202f13d514522ea2cc6b36304524bc5006a50",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e0b5e0e_e1bc5191",
        "filename": "firmware/include/tlcl.h",
        "patchSetId": 11
      },
      "lineNbr": 102,
      "author": {
        "id": 1135824
      },
      "writtenOn": "2018-04-09T09:37:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "22cc50cf_de4d530e",
      "range": {
        "startLine": 102,
        "startChar": 74,
        "endLine": 102,
        "endChar": 76
      },
      "revId": "0a4202f13d514522ea2cc6b36304524bc5006a50",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}