{
  "comments": [
    {
      "key": {
        "uuid": "e537483f_176090c5",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 1
      },
      "lineNbr": 125,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-03-13T22:48:49Z",
      "side": 1,
      "message": "Should this check the magic/version? It seems a bit pointless to add a marker if you don\u0027t use it.",
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e99d9ae1_5a584505",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 1
      },
      "lineNbr": 125,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-03-15T05:37:05Z",
      "side": 1,
      "message": "Probably sufficient to check the magic here?  And add future checks for version if things become incompatible?",
      "parentUuid": "e537483f_176090c5",
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "591d9499_02b3a7aa",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 1
      },
      "lineNbr": 125,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-03-15T05:57:35Z",
      "side": 1,
      "message": "I think the convention is that major version signifies totally incompatible changes, whereas minor version is incremental ones? So I think you generally check that the major version is equal and the minor version is greater or equal to the one we expect. At least that\u0027s how it\u0027s done for the GBB (see 2lib/2misc.c).",
      "parentUuid": "e99d9ae1_5a584505",
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c84bac93_934e3709",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 1
      },
      "lineNbr": 125,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-03-15T07:42:20Z",
      "side": 1,
      "message": "Actually, I don\u0027t think it makes sense to check the minor version unless there are incompatible changes made.\n\nIf the data structure passed is older than that of the code, then the code should be backwards compatible (along the same major version).  Any small changes in logic can be accounted for by checking the minor version.\n\nIf the data structure passed is newer than that of the code, then the changes to the data structure should be forwards compatible (along the same major version).  E.g. adding fields to the end of the data structure.",
      "parentUuid": "591d9499_02b3a7aa",
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9b1971e_4a0aa870",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 1
      },
      "lineNbr": 125,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-03-15T19:38:34Z",
      "side": 1,
      "message": "Generally, I would not expect firmware to carry code to support older data structures, because we intend to always update coreboot, depthcharge and vboot in tandem. So there should be no way that an older vb2_sd structure could get in here and this is just a sanity check.\n\nFor crossystem the check would be different and having code to support older formats would be necessary there.",
      "parentUuid": "c84bac93_934e3709",
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f33eb542_c9ed704a",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 1
      },
      "lineNbr": 125,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-03-26T05:34:32Z",
      "side": 1,
      "message": "There is one case where firmware could be expected to support older data structures -- if we add some new features to ToT, and either: (1) flash to a device with old RO + ToT RW, or (2) cherry-pick the ToT change to firmware branch.  I can\u0027t think of any particular good reason to do this, so forget about this case.\n\nFor the case of newer data structures -- the only case I can foresee this happening is when the firmware is reading from some external source -- like GBB flags, or kernel preamble.  Assuming these data structures can\u0027t be updated with the firmware in lockstep (I think GBB flags can?), actually we have two options here -- update DS first, or firmware first.  If we prefer to keep the firmware code cleaner, then we should update DS first -- assuming that it is backwards-compatible (major version same, minor version++).\n\nFinally, we have to consider crossystem or similar -- reading firmware-related DS from OS.  In this case, I don\u0027t think we ever allow newer (minor) versions?  But it may be an option to consider, since it would allow us to not rely so much on always getting crossystem changes in first, before some particular firmware change.  If we assume that we don\u0027t allow newer versions -- then crossystem has to support *all* previous versions.  In that case, separating MAJOR and MINOR is merely an organizational feature -- it doesn\u0027t actually give us any functional benefit.\n\nSo in this case (vb2_shared_data) -- we can summarize as follows:\n* Assume RO and RW versions never get out of sync\n* Internally-generated structure\n* Therefore it is impossible to encounter a greater MAJOR or MINOR in firmware\n* In firmware, always assume MAJOR and MINOR are exactly correct versions\n* In crossystem, allow older MAJOR and newer MINOR\n\nDoes that sound reasonable?",
      "parentUuid": "f9b1971e_4a0aa870",
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eea21114_8b1c5723",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 1
      },
      "lineNbr": 125,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-03-26T21:45:19Z",
      "side": 1,
      "message": "Yes, there should be no scenario where the minor number would be newer here. It should still be fine to check \u003e\u003d (instead of \u003d\u003d) because if that still happens somehow, it should be harmless if minor version increments are defined to be downwards compatible. But you can also put a \u003d\u003d if you prefer.\n\nFor crossystem, yes, I think it also makes sense to allow \u003e\u003d minor version even if that\u0027s an unusual case, because it doesn\u0027t hurt and as you said may make changes easier to land. There may also be odd scenarios where a kernel rolls back to an older version and the firmware doesn\u0027t (not sure if we generally prevent that). In general, if the minor version is defined to be downwards compatible, I think you might as well always check \u003e\u003d instead of \u003d\u003d just because that shouldn\u0027t make a difference.\n\nFor older major *and* minor versions, crossystem needs to be able to support them and it needs custom code to deal with the older data structure in that case.",
      "parentUuid": "f33eb542_c9ed704a",
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be899845_83654c6f",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-03-13T22:48:49Z",
      "side": 1,
      "message": "What does the A stand for? (I would\u0027ve expected V2SD or VB2S or something.)",
      "range": {
        "startLine": 74,
        "startChar": 4,
        "endLine": 74,
        "endChar": 8
      },
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70248b45_aae104c6",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-03-15T05:37:05Z",
      "side": 1,
      "message": "\"Vb2\" prefix is used for vboot2.1, so I didn\u0027t want to use that.\n\"VB2\" would probably just be confusing, since it\u0027s \"very similar\" to vboot2.1\n\"VbSD\" was taken for vboot1\u0027s VbSharedDataHeader\n\nOkay, to be perfectly honest, I can\u0027t quite remember why I chose to add an A in there...\n\"V2SD\" sounds reasonable.\n\n(Although looking to the future, Vb2x as a prefix for vboot2.1 data structures seems a bit limiting with only one character.  That means we will encounter problems with \"signature\" and \"shared_data\".  \"V2\" might be a nice way of solving that earlier than later.  In that case we probably wouldn\u0027t want to use it here.)",
      "parentUuid": "be899845_83654c6f",
      "range": {
        "startLine": 74,
        "startChar": 4,
        "endLine": 74,
        "endChar": 8
      },
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72905c99_50ea5719",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-03-15T05:57:35Z",
      "side": 1,
      "message": "I mean, V20S or VS20 would also work. It\u0027s not that important, I was just wondering about the A. We could also just keep using VbSD and use a higher major version.",
      "parentUuid": "70248b45_aae104c6",
      "range": {
        "startLine": 74,
        "startChar": 4,
        "endLine": 74,
        "endChar": 8
      },
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51e53da6_3c274b36",
        "filename": "firmware/2lib/include/2struct.h",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-03-15T07:42:20Z",
      "side": 1,
      "message": "Let\u0027s stick with V2SD.",
      "parentUuid": "72905c99_50ea5719",
      "range": {
        "startLine": 74,
        "startChar": 4,
        "endLine": 74,
        "endChar": 8
      },
      "revId": "65c8a03c8fdce9bac37186e3b1819c3d3dba0c8a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}