{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8d21c694_2108d5ee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1383774
      },
      "writtenOn": "2025-10-31T10:09:23Z",
      "side": 1,
      "message": "After discussing offline with yupingso@, here are my suggestions:\n\n### 1. Could we try to put all the cleanup/probe/init error goto into `flashrom_setup()`?\nIn that case, `flashrom_setup()` will handle its err out, which maybe looks like:\n\n// In flashrom_setup()\n```\n\t// early return on success, do not do cleanup while success.\n\treturn VB2_SUCCESS;\n\nerr_cleanup:\n\tif (layout)\n\t\tflashrom_layout_release(layout);\n\tflashrom_flash_release(flashctx);\nerr_probe:\n\tflashrom_programmer_shutdown(prog);\nerr_init:\n\treturn VB2_ERROR_FLASHROM;\n```\n\n\nAnd we could keep only `err_cleanup` and `err_{read|write}_cfg` in each function with dropping `err_probe` and `err_init` in each function.\nA key benefit of this approach is that we avoid adding new, specific error return values that external callers don\u0027t actually use.\n\n### 2. If we still want to go with the current solution(adding new error codes)\n, please update this according to two rules:\n\n2-1. Please avoid inserting enums in the middle. Renumbering existing codes may break old binaries. Please only append to the very end of each block.\n2-2. Group related errors: What about creating a new block `VB2_ERROR_HOST_FLASHROM` at offset `VB2_ERROR_HOST_BASE + 0x070000` and then placing `VB2_ERROR_FLASHROM_*` there.\n```\n/**********************************************************************\n/* Errors generated by host library flashrom functions */\nVB2_ERROR_HOST_FLASHROM \u003d VB2_ERROR_HOST_BASE + 0x070000,\n\n/* Unable to initialize flashrom */\nVB2_ERROR_FLASHROM_INIT,\n\n/* Flash probing failed */\nVB2_ERROR_FLASHROM_PROBE,\n\n/* Flash has length of zero */\nVB2_ERROR_FLASHROM_ZERO_LENGTH,\n```\n\nBut I think option 1. is better.",
      "revId": "9cfe918e5dc53e2ffa9b81350a8690f542a2e8a9",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}