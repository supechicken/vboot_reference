{
  "comments": [
    {
      "key": {
        "uuid": "83997ccf_89e02c33",
        "filename": "firmware/lib/secdata_tpm.c",
        "patchSetId": 54
      },
      "lineNbr": 171,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "This is not equivalent to VbSetRecoveryRequest() -- this will try to boot the other firmware slot first, rather than going into recovery immediately. We should not mix the two.\n\n(Whether we want to make some general change to our boot policy to more often try the other slot first rather than going into recovery immediately is a different question, but that would need to be discussed first and then applied across the whole code base, not as a one-off. For now, as far as I understand, all failures that are not related to parsing the RW firmware image should immediately go into recovery.)",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3fdd664b_b0ff8c28",
        "filename": "firmware/lib/secdata_tpm.c",
        "patchSetId": 54
      },
      "lineNbr": 171,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-09-28T07:19:56Z",
      "side": 1,
      "message": "Based on Randall\u0027s response to the bug I created:\nhttps://bugs.chromium.org/p/chromium/issues/detail?id\u003d1007999\n\n\"Locking secdata_kernel shouldn\u0027t directly trigger recovery mode.  That could be caused by a bug in the current RW firmware\u0027s TPM library, and the other RW firmware slot could be able to lock it fine.\"\n\nPerhaps we should change the behaviour here?",
      "parentUuid": "83997ccf_89e02c33",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "afa661a7_5a064ab4",
        "filename": "firmware/lib/secdata_tpm.c",
        "patchSetId": 54
      },
      "lineNbr": 180,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "nit: I think I liked the \u0027global that is declared in \u003cvboot_test.h\u003e\u0027 version better than the \u0027need to have a separate function solely for tests\u0027 version. The code that\u0027s only used for tests should be pushed out into test-specific files as much as possible.",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70710130_cf1079e4",
        "filename": "firmware/lib/secdata_tpm.c",
        "patchSetId": 54
      },
      "lineNbr": 180,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-09-28T07:19:56Z",
      "side": 1,
      "message": "Sure, okay.  I also converted VbGetMode in this CL:\nhttps://chromium-review.googlesource.com/c/chromiumos/platform/vboot_reference/+/1830239",
      "parentUuid": "afa661a7_5a064ab4",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "36f6d915_be1c4b0a",
        "filename": "firmware/lib/secdata_tpm.c",
        "patchSetId": 54
      },
      "lineNbr": 204,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "nit: Rather than all the goto spaghetti here, you can just do\n\n if (!rv)\n   return TPM_SUCCESS;\n\n if (rv \u003d\u003d ...INCOMPLETE) {\n   ...\n   rv \u003d ...check()\n   if (!rv)\n     return TPM_SUCCESS;\n }\n\n VB2_DEBUG(...);\n return rv;",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dae4bf66_4cba5d8a",
        "filename": "firmware/lib/secdata_tpm.c",
        "patchSetId": 54
      },
      "lineNbr": 204,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-09-28T07:19:56Z",
      "side": 1,
      "message": "Who doesn\u0027t enjoy a good goto spaghetti once in a while?",
      "parentUuid": "36f6d915_be1c4b0a",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07f0f917_9d5a0110",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 54
      },
      "lineNbr": 366,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "nit: maybe add a comment saying that vboot never writes to the FWMP, so it\u0027s clear the omission here is intentional",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "301be984_35d7eaa9",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 54
      },
      "lineNbr": 366,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-09-28T07:19:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "07f0f917_9d5a0110",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "944d5b0b_114bc378",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 54
      },
      "lineNbr": 367,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "Uhh... can\u0027t these two fail? Where do their errors go?",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "405d9d19_4617a4cc",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 54
      },
      "lineNbr": 367,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-09-28T07:19:56Z",
      "side": 1,
      "message": "Ugh.  This is awkward.  Seems like our lock function takes care of setting recovery mode, whereas all the other functions do not.  I\u0027m going to add vb2api_fail calls within all of the secdata_* calls.  Does this work?",
      "parentUuid": "944d5b0b_114bc378",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d709e3ad_9cc0670f",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 54
      },
      "lineNbr": 367,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-10-02T01:20:09Z",
      "side": 1,
      "message": "Sorry... I looked at it but I don\u0027t think I like it. I think checking here would make more sense (like you checked in kernel_setup() above for this version).\n\nFor consistency, lock() should also just return an error and not set the recovery reason directly, then.",
      "parentUuid": "405d9d19_4617a4cc",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "880b90ed_eb0f7fea",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 54
      },
      "lineNbr": 490,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "nit: maybe update message?",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f15e8bd7_a55c7397",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 54
      },
      "lineNbr": 490,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-09-28T07:19:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "880b90ed_eb0f7fea",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "339ea1e5_8caee945",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 54
      },
      "lineNbr": 837,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "All calls to kernel_cleanup() need to check and handle return value.\n\nAlso, I think it\u0027s fine to use it in cases like this, but then the name cleanup() doesn\u0027t seem right anymore. It\u0027s more of a sync() or commit().",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ede2c234_e5f93c64",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 54
      },
      "lineNbr": 68,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "nit: I don\u0027t think updating the global hurts even if TPM2_MODE is set (otherwise you\u0027re leaving it uninitialized which isn\u0027t really better).",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "93430717_ae46d3d4",
        "filename": "tests/secdata_tpm_tests.c",
        "patchSetId": 54
      },
      "lineNbr": 225,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "Please consolidate all the override functions that are dependent on TPM mode together in one place.",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26f6ef83_f212b566",
        "filename": "tests/vboot_api_kernel4_tests.c",
        "patchSetId": 54
      },
      "lineNbr": 130,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-09-24T21:33:14Z",
      "side": 1,
      "message": "Why not just override secdata_kernel_lock() rather than this one, and then you don\u0027t need to #ifdef anything out for MOCK_TPM?",
      "revId": "973dfeda4af0b397ffaab68251faa05b2c8e9715",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}