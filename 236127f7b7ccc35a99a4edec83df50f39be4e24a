{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9b548bdd_b125cb72",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2023-02-02T19:50:40Z",
      "side": 1,
      "message": "ptal",
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3d13789_f7ec7b0d",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2023-02-02T19:19:11Z",
      "side": 1,
      "message": "can\u0027t we move this up to line 574 ?  then you don\u0027t have to reindent anything.\n\n```\nif ...; then\n  echo ...\nelif futility dump_fmap -p \"${bios_path}\" | grep -q RO_GSCVD; then\n  ...\n```",
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce1d33fa_e740978f",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2023-02-02T19:19:11Z",
      "side": 1,
      "message": "you\u0027re just doing a substring search here, not a \"real\" regex.  use a pattern match instead.\n\n`[[ ... \u003d\u003d *GUYBRUSH* ]]`",
      "range": {
        "startLine": 576,
        "startChar": 29,
        "endLine": 576,
        "endChar": 31
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9ee2924_e41606ae",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2023-02-02T19:19:11Z",
      "side": 1,
      "message": "we really really really don\u0027t want people using `${KEY_DIR}` for anything.  to wit, the key dir we pass in is a random tempdir.  in theory, that random name could have \"guybrush\" in it, and then we\u0027ll see a (admittedly extremely unlikely) flake.\n\ncan\u0027t you inspect the firmware image to determine whether \"this is guybrush\" or something instead ?",
      "range": {
        "startLine": 576,
        "startChar": 18,
        "endLine": 576,
        "endChar": 25
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "14b03457_feb4e751",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2023-02-02T19:50:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ce1d33fa_e740978f",
      "range": {
        "startLine": 576,
        "startChar": 29,
        "endLine": 576,
        "endChar": 31
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3874c836_0027c57a",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2023-02-02T19:50:40Z",
      "side": 1,
      "message": "this patch is a temporary workaround to be taken out when guybrush AP firmware is fixed. I would rather not add more complexitiy to this on the off chance that an unrelated keyset tempdir path would include \u0027guybrush\u0027 in it.\n\n\nLooks like `strings \"${bios_image}\"` returns a couple of good matches, like\n\n`CONFIG_BOARD_GOOGLE_GUYBRUSH\u003dy`\n\nor \n\n`MAINBOARD_PART_NUMBER: Guybrush`\n\nbut I am not sure now much more reliable this is, I would prefer to use the keyset name unless you insist.",
      "parentUuid": "c9ee2924_e41606ae",
      "range": {
        "startLine": 576,
        "startChar": 18,
        "endLine": 576,
        "endChar": 25
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da65d55f_11d8cacf",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2023-02-02T19:50:40Z",
      "side": 1,
      "message": "I would rather not make this check for all boards, logically it should run only in case when RO_GSVD section is found in fmap.\n\nI am not sure why gerrit is showing the diffs the way it does, the actual change is very limitied:\n```\n\u003e git diff -w HEAD~\ndiff --git a/scripts/image_signing/sign_official_build.sh b/scripts/image_signing/sign_official_build.sh\nindex 34258b3ae..27cf8c866 100755\n--- a/scripts/image_signing/sign_official_build.sh\n+++ b/scripts/image_signing/sign_official_build.sh\n@@ -573,6 +573,9 @@ resign_firmware_payload() {\n         # Do not attempt AP RO verification signing if the image FMAP does not\n         # include the RO_GSCVD section.\n         if futility dump_fmap -p \"${bios_path}\" | grep -q RO_GSCVD; then\n+          if [[ ${KEY_DIR^^} \u003d~ \"GUYBRUSH\" ]]; then\n+            echo \"Bypassing guybrush AP RO signing, b/263378945.\"\n+          else\n             local arv_root\n \n             if [[ -z ${brand_code} ]]; then\n@@ -604,6 +607,7 @@ resign_firmware_payload() {\n \n             echo \"After signing RO_GSCVD on ${bios_path}: md5 \u003d\" \\\n                  \"$(md5sum \"${bios_path}\" | awk \u0027{print $1}\u0027)\"\n+          fi\n         else\n           echo \"No RO_GSCVD section in the image, skipping AP RO signing\"\n         fi\n```",
      "parentUuid": "c3d13789_f7ec7b0d",
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0cade552_219caf9d",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1270601
      },
      "writtenOn": "2023-02-02T20:01:36Z",
      "side": 1,
      "message": "I proposed a more robust solution here: b/263378945#comment79\n\nIMO, I don\u0027t see the need to regenerate the guybrush AP RO FW.",
      "parentUuid": "3874c836_0027c57a",
      "range": {
        "startLine": 576,
        "startChar": 18,
        "endLine": 576,
        "endChar": 25
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "432e0d90_86f59850",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2023-02-02T20:06:29Z",
      "side": 1,
      "message": "For the best of my knowledge the signer is running a limited subset of statically linked or bundles with liberaries utilites, and cbfstool is not included.",
      "parentUuid": "0cade552_219caf9d",
      "range": {
        "startLine": 576,
        "startChar": 18,
        "endLine": 576,
        "endChar": 25
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dcd7a6cb_ff5b8cb6",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2023-02-02T20:07:09Z",
      "side": 1,
      "message": "this isn\u0027t the keyset name, this is the keyset dir.  even then, the keyset name is meant to be opaque as well.  don\u0027t use either other than \"here\u0027s a dir to find keys\".\n\nalso, you have more than just the firmware blob.  you have the whole rootfs.  so you could prob pull something from lsb-release or os-release.",
      "parentUuid": "0cade552_219caf9d",
      "range": {
        "startLine": 576,
        "startChar": 18,
        "endLine": 576,
        "endChar": 25
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2339166b_0e5bc72f",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2023-02-02T20:07:09Z",
      "side": 1,
      "message": "you\u0027re using `-w` so that diff isn\u0027t showing you touching every line inbetween.  the Gerrit output isn\u0027t the worst (it\u0027s showing unchanged code with lighter green vs new whitespace in darker green).  but if you check it at the top as suggested, it works fine in both cases.",
      "parentUuid": "da65d55f_11d8cacf",
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b08982bd_38c41469",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 576,
      "author": {
        "id": 1000039
      },
      "writtenOn": "2023-02-02T20:11:25Z",
      "side": 1,
      "message": "but in fact I just checked, cbfstool is there in the signer in `signer/signingtools-bin/cbfstool`, let met try using it then.",
      "parentUuid": "dcd7a6cb_ff5b8cb6",
      "range": {
        "startLine": 576,
        "startChar": 18,
        "endLine": 576,
        "endChar": 25
      },
      "revId": "236127f7b7ccc35a99a4edec83df50f39be4e24a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}