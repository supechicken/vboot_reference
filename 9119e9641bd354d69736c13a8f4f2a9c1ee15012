{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d2cb2c26_f55dbdbb",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-05-16T20:45:09Z",
      "side": 1,
      "message": "vboot is designed to also work without coreboot, so this shouldn\u0027t depend on coreboot config. We just want to check if BIOS_FMAP_VBLOCK_B exists in the FMAP, like prepare_slot() already does.",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d8705aab_83617bdb",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-05-18T13:25:06Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "d2cb2c26_f55dbdbb",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "41890f1d_51f79622",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1577712
      },
      "writtenOn": "2023-06-29T15:18:06Z",
      "side": 1,
      "message": "Removed the obsolete function",
      "parentUuid": "d8705aab_83617bdb",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c52e1b0_6abe44f1",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-05-16T20:45:09Z",
      "side": 1,
      "message": "I think the best way to fix this is to honestly just skip this FATAL() call here. Just set state-\u003earea[fw_c].metadata_hash.algo to VB2_HASH_INVALID if this call fails. Then we should still fail in check_slot_after_prepare() if the slot actually existed.",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38dc0731_cda51f18",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-05-18T13:25:06Z",
      "side": 1,
      "message": "It think `FATAL()` should be changed to `WARNING()` or at least to `VB2_DEBUG()`, as this info might be useful for debugging.",
      "parentUuid": "3c52e1b0_6abe44f1",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "006a5f42_8c5c766c",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-05-18T23:26:13Z",
      "side": 1,
      "message": "Won\u0027t we see it anyway once we get to check_slot_after_prepare()? I\u0027m not really sure why we put that message in both functions to begin with tbh, it\u0027s pretty much the exact same wording.",
      "parentUuid": "38dc0731_cda51f18",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "543f414e_b38c1924",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-05-19T05:49:07Z",
      "side": 1,
      "message": "You are right. This `FATAL()` can be dropped entirely here.",
      "parentUuid": "006a5f42_8c5c766c",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2abebe9b_9dc382de",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1577712
      },
      "writtenOn": "2023-06-29T15:18:06Z",
      "side": 1,
      "message": "Thanks, dropping the FATAL() did the trick. Futility detects the FW_B is missing and does not fail signing now.",
      "parentUuid": "543f414e_b38c1924",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93c2e9e2_67f9d859",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-07-11T00:43:27Z",
      "side": 1,
      "message": "The comment of `cbfstool_get_metadata_hash` already states that the hash type will be set to `VB2_HASH_INVALID` on errors. Therefore we don\u0027t even need to do that here.\n\nIf the slot B is considered optional, then I think we can modify `ft_sign_bios()` so that `futility sign` doesn\u0027t even print an error. The function can check the existence of FW_MAIN_B first (using `fmap_find_by_name`), and skip all the succeeding calls for FW_MAIN_B.",
      "parentUuid": "2abebe9b_9dc382de",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f2e1281_eb72bb41",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-07-12T00:50:16Z",
      "side": 1,
      "message": "\u003e The comment of cbfstool_get_metadata_hash already states that the hash type will be set to VB2_HASH_INVALID on errors. Therefore we don\u0027t even need to do that here.\n\nTrue, we don\u0027t actually need to do anything on error here.\n\n\u003e If the slot B is considered optional, then I think we can modify ft_sign_bios() so that futility sign doesn\u0027t even print an error.\n\nYeah, I guess we could downgrade the prepare_slot() and sign_bios_at_end() messages to INFO().",
      "parentUuid": "93c2e9e2_67f9d859",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7d3215b_3aca7423",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1577712
      },
      "writtenOn": "2023-07-12T13:56:55Z",
      "side": 1,
      "message": "I check the VBLOCK_B slot presence in the file first and omit the calls to:\nimage_check_and_prepare_cbfs, prepare_slot and check_slot_after_prepare.\n\nHowever, I am not sure if the downgrade of error messages to INFO in prepare_slot or sign_bios_at_end. These are also used to prepare and sign slot A, which must fail the hard way if something is wrong with the slot A.",
      "parentUuid": "5f2e1281_eb72bb41",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "03407faf_223a45ed",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-07-13T01:52:02Z",
      "side": 1,
      "message": "In my previous comment I was actually thinking about something like:\n\n```\nstatic int sign_bios_slot(slot)\n{\n    image_check_and_prepare_cbfs(slot);\n    prepare_slot(slot);\n    check_slot_after_prepare(slot);\n}\n\nint ft_sign_bios()\n{\n    futil_open_and_map_file();\n\n    sign_bios_slot(A);\n    if (fmap_find_by_name(fmap_name[BIOS_FMAP_FW_MAIN_B]))\n        sign_bios_slot(B);\n    else\n        INFO(...);\n\n    sign_bios_at_end();\n    futil_unmap_and_close_file();\n}\n```\n\nThen there\u0027s no need to downgrade the error messages. Also, when slot B is not present, `is_valid` should automatically be `0`.",
      "parentUuid": "a7d3215b_3aca7423",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50124b63_89addcad",
        "filename": "futility/file_type_bios.c",
        "patchSetId": 1
      },
      "lineNbr": 518,
      "author": {
        "id": 1577712
      },
      "writtenOn": "2023-07-17T14:08:48Z",
      "side": 1,
      "message": "I tried to apply what you suggest, but to satisfy Julius comments as well, I have not added a fmap_find_by_name call. Right now I am getting the following output from coreboot build:\n\nWARNING: prepare_slot: VBLOCK_A keyblock is invalid.\nINFO: prepare_slot: FW_MAIN_B area not found in FMAP\nINFO: sign_bios_at_end: BIOS image does not have FW_MAIN_B. Signing only FW_MAIN_A\n    FLASHMAP Layout generated for RO and A partition.\n\n\nIt is already good enough.",
      "parentUuid": "03407faf_223a45ed",
      "revId": "9119e9641bd354d69736c13a8f4f2a9c1ee15012",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}