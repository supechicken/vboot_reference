{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "913df076_45ba069d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 12
      },
      "lineNbr": 7,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-11T03:52:30Z",
      "side": 1,
      "message": "s",
      "range": {
        "startLine": 7,
        "startChar": 43,
        "endLine": 7,
        "endChar": 44
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e83cfb51_810d3a0d",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 55,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-11T03:52:30Z",
      "side": 1,
      "message": "UI",
      "range": {
        "startLine": 55,
        "startChar": 24,
        "endLine": 55,
        "endChar": 26
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "83809beb_7fda8239",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 57,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-11T03:52:30Z",
      "side": 1,
      "message": "Looks like we can remove one level of indentation.",
      "range": {
        "startLine": 57,
        "startChar": 14,
        "endLine": 57,
        "endChar": 15
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d16a762_3ea6f9e2",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 61,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-11T03:52:30Z",
      "side": 1,
      "message": "err",
      "range": {
        "startLine": 61,
        "startChar": 10,
        "endLine": 61,
        "endChar": 15
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "123b98ac_18a328cf",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 328,
      "author": {
        "id": 1383774
      },
      "writtenOn": "2021-03-09T10:43:01Z",
      "side": 1,
      "message": "Actually I could not realize this TODO here...\nIsn\u0027t we return the proper error code since we apply the VB2_TRY?",
      "range": {
        "startLine": 328,
        "startChar": 0,
        "endLine": 328,
        "endChar": 51
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "231cfe77_0585329a",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 328,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-10T07:43:48Z",
      "side": 1,
      "message": "Return vb2_errot_t so we can use:\n\nVB2_TRY(\n  check_ui_error(\n    vb2ex_get_debug_info(...)));",
      "parentUuid": "123b98ac_18a328cf",
      "range": {
        "startLine": 328,
        "startChar": 0,
        "endLine": 328,
        "endChar": 51
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "220dd0e7_5e209d95",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 328,
      "author": {
        "id": 1383774
      },
      "writtenOn": "2021-03-10T07:51:06Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "231cfe77_0585329a",
      "range": {
        "startLine": 328,
        "startChar": 0,
        "endLine": 328,
        "endChar": 51
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8ec998bd_ac627d98",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 332,
      "author": {
        "id": 1383774
      },
      "writtenOn": "2021-03-09T10:43:01Z",
      "side": 1,
      "message": "IMO we could remove these \"Failed to retrieve...\" debug info since the ui-\u003eerror_code is handled now",
      "range": {
        "startLine": 331,
        "startChar": 0,
        "endLine": 332,
        "endChar": 54
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37114f2c_b98d0715",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 332,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-11T03:52:30Z",
      "side": 1,
      "message": "If you want, you can also add another argument \"mesg\" for check_ui_error(), for the error message which will be printed when error_code is set.",
      "parentUuid": "8ec998bd_ac627d98",
      "range": {
        "startLine": 331,
        "startChar": 0,
        "endLine": 332,
        "endChar": 54
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "35b54020_9e9d4bc9",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 332,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-03-11T04:41:08Z",
      "side": 1,
      "message": "Are there any cases where the error message printed to AP console log by depthcharge is not sufficient?",
      "parentUuid": "37114f2c_b98d0715",
      "range": {
        "startLine": 331,
        "startChar": 0,
        "endLine": 332,
        "endChar": 54
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6686306_cc640a04",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 334,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-11T03:52:30Z",
      "side": 1,
      "message": "Now we\u0027re using check_ui_error for log functions, but not using it for others such as in recovery_to_dev_init(). It\u0027d be better if we could set error_code in a consistent way.",
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e69d52ef_0a8d49c2",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 334,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-03-11T04:41:08Z",
      "side": 1,
      "message": "To be honest, I\u0027m also a bit concerned about check_ui_error.  I totally agree that refactoring the log functions helps us reduce code (like pulling init/reinit out into set_content).  On the other hand, the construct:\n\n  VB2_TRY(check_ui_error(rv, VB_UI_ERROR, ui))\n\n... is doing tons of things that are very hard to understand for someone not familiar with Groot, including a `screen_back` call (which, as Yu-Ping mentioned, is sometimes desired when setting an error, sometimes not), as well as the implicit return from the VB2_TRY macro.\n\nTo show by example, it\u0027s pretty obvious what this is doing:\n\tconst char *log_string \u003d vb2ex_get_firmware_log(reset);\n\tif (!log_string) {\n\t\tui-\u003eerror_code \u003d VB2_UI_ERROR_FIRMWARE_LOG;\n\t\treturn vb2_ui_screen_back(ui);\n\t}\n\tvb2_error_t rv \u003d log_page_update(ui, log_string);\n\tif (rv !\u003d VB2_SUCCESS) {\n\t\tui-\u003eerror_code \u003d VB2_UI_ERROR_FIRMWARE_LOG;\n\t\treturn vb2_ui_screen_back(ui);\n\t}\n\nWhereas I\u0027m going to have to jump around to a few places to understand this piece of code:\n\tconst char *log_string \u003d vb2ex_get_firmware_log(reset);\n\tvb2_error_t rv \u003d log_string ? VB2_SUCCESS : VB2_ERROR_UNKNOWN;\n\tVB2_TRY(check_ui_error(rv, ui, VB2_UI_ERROR_FIRMWARE_LOG));\n\tVB2_TRY(check_ui_error(log_page_update(ui, log_string), ui,\n\t\t\t       VB2_UI_ERROR_FIRMWARE_LOG));\n\nIf you\u0027d like to further reduce the amount of boilerplate code required for log screens, perhaps it would make sense to store some of this information (i.e. the appropriate log strings, the callbacks to retrieve / update logs) in vb2_screen_info alongside .page_up_item and friends, and further generalize these functions to share across screens.",
      "parentUuid": "f6686306_cc640a04",
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f990695_6e038a93",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 334,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-11T07:13:07Z",
      "side": 1,
      "message": "I totally agree.\n\nI\u0027m considering another issue.\nAssume that some function return VB2_REQUEST (i.e. REQUEST_UI_EXIT, REQUEST_SHUTDOWN), they will be caught and transform into REQUEST_UI_CONTINUE if we just check `if (rv)`.\nI\u0027m not sure if this would be an issue.\n\nIf we handle all these return value checking in a single place, I think it is more easier to maintian and avoid misusing.\nBut if currently the `if (rv)` can handle all the situaction, than I think we can keep the current form.\n\nBTW, I will move those set_content into previous refactor CL.",
      "parentUuid": "e69d52ef_0a8d49c2",
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e087aa4_de0677ef",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 334,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-11T07:51:40Z",
      "side": 1,
      "message": "Also, I noticed that `debug_info_init()` doesn\u0027t check the return value of `log_page_reset_to_top()`. If the error comes from here, the error_code won\u0027t be set.\n\nI\u0027m considering if we can add a `default_error_code` to vb2_screen_info, and handle the error_code from the `ui_loop`?",
      "parentUuid": "9f990695_6e038a93",
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a867867c_7c43e9ab",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 334,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-12T08:02:56Z",
      "side": 1,
      "message": "\u003e I\u0027m considering if we can add a `default_error_code` to vb2_screen_info, and handle the error_code from the `ui_loop`?\n\nActually I also thought about that, but there might multiple errors from one vb2_screen (for example, in vb2_ui_developer_mode_boot_altfw_action()). How would you deal with these cases?",
      "parentUuid": "4e087aa4_de0677ef",
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e51cfcb8_21e439cf",
        "filename": "firmware/2lib/2ui_screens.c",
        "patchSetId": 12
      },
      "lineNbr": 1159,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-11T03:52:30Z",
      "side": 1,
      "message": "Can fit in one line.",
      "range": {
        "startLine": 1158,
        "startChar": 2,
        "endLine": 1159,
        "endChar": 17
      },
      "revId": "313187a99bae2a7faeb7a55cfd83af187c02c260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}