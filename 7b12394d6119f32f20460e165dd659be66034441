{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2b9a7827_844c4569",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 547,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-09-30T01:20:44Z",
      "side": 1,
      "message": "You should rename these two as well to match the new nomenclature. (fw_version_secdata already gets updated when a new version is written, so it was never really \"start\" to begin with.)",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1ed50395_22e51548",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 547,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-10-02T06:28:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2b9a7827_844c4569",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a520afbf_276ba2fe",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 549,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-09-30T01:20:44Z",
      "side": 1,
      "message": "When you change this you should also change how crossystem displays those values in the same patch. And, more importantly, you need to add fallback code to crossystem so that the old VBSD version is still interpreted according to the old meaning.",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2d463e6f_aadf1afa",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 549,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-10-02T06:28:24Z",
      "side": 1,
      "message": "Done.\n\nBTW, I think we only need the fallback code for `vdat_lfdebug`, because that is the only option that uses `*_version_tpm_start`.\n\nAnd we correct the meaning of `*_version_tpm` in this CL.",
      "parentUuid": "a520afbf_276ba2fe",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2dc4a914_49081340",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 549,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-10-03T01:09:32Z",
      "side": 1,
      "message": "Well, I think you should probably also change GetVdatInt() to return fw_version_act for VDAT_INT_FW_VERSION_TPM for the old VBSD version. That\u0027s different from what it does today but it would be more correct, especially once we also output the current versions through crossystem (shouldn\u0027t that also be added in this patch, btw? Or do you want to do that later?).\n\nRight now, sd-\u003efw_version contains the version currently booted and sd-\u003efw_version_secdata contains the version in the TPM at the end of the boot. The previous code moved sd-\u003efw_version into vbsd-\u003efw_version_tpm and sd-\u003efw_version_secdata into vbsd-\u003efw_version_tpm_start (which is now vbsd-\u003efw_version_act). So if crossystem will show both tpm_fwver and act_fwver in the future, for devices with the old VBSD version it should show what originally came from sd-\u003efw_version_secdata in tpm_fwver and what originally came from sd-\u003efw_version in act_fwver.\n\nBasically, the VBSD source fields for tpm_fwver and act_fwver should be exactly flipped between the old and new VBSD versions in crossystem. (Alternatively we could also consider renaming the VBSD fields differently... so that the one currently called vbsd-\u003efw_version_tpm_start will then be called vbsd-\u003efw_version_tpm and the one currently called vbsd-\u003efw_version_tpm will then be called vbsd-\u003efw_version_act. Then things would match between the old and new version. Maybe that would be cleaner?)",
      "parentUuid": "2d463e6f_aadf1afa",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4d295e34_1bf94e50",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 549,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-10-03T08:30:49Z",
      "side": 1,
      "message": "Done.\nBTW, we cannot rename the `tpm_fwver` and `tpm_kernver` in crossystem easily.\nBecause the chromeos test infra relies on these two fields, I preserve the original naming and correct the remaining code.",
      "parentUuid": "2dc4a914_49081340",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "88ae0ffc_815cffc4",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 549,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-10-06T07:05:49Z",
      "side": 1,
      "message": "No, sorry, I think we got something confused here now, this is not what I meant. We do want to keep `tpm_fwver` and `tpm_kernver` in crossystem and we want them to continue to mean what they used to mean (the version stored in the TPM at the end of the boot). We just want to add two _additional_ crossystem output fields on top of that which I would suggest should be called `act_fwver` and `act_kernver` which then instead show the version that was currently booted. (For older VBSDs the `act_kernver` will not be available so it should check for VBSD version there and just not show it or show \"(unavailable)\" or something like that for the old one.)\n\nI think my previous comment may have been too confusing because I was talking about several different ways to tackle the \"support old VBSDs\" problem (VDAT_INT_FW_VERSION_TPM was only supposed to return fw_version_act on the old version where fw_version_act actually used to be fw_version_tpm_start and thus actually contained the TPM version, not the active one). I think the alternative approach that I outlined at the end of that comment is a cleaner and (hopefully?) less confusing way to achieve all this. See the other comment on how to match up the fields to get that.",
      "parentUuid": "4d295e34_1bf94e50",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7756930f_9e25a441",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 16
      },
      "lineNbr": 549,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-10-06T13:43:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "88ae0ffc_815cffc4",
      "revId": "7b12394d6119f32f20460e165dd659be66034441",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}