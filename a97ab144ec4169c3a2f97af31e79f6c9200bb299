{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8aa576c3_0e3b7857",
        "filename": "futility/cmd_gbb_utility.c",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-06T09:45:37Z",
      "side": 1,
      "message": "Instead of adding a new option for each use case, I wonder if we can make it more general. I can see a few options:\n\n1. If the goal is to stop calling `flashrom`, we already have `futility read` (added CL:4075310) to use in CL:4308230.\n2. Add `--flash` to `futility show` to read from SPI flash. An extra option `--gbb` is needed to read only the GBB region.\n3. Add `--all` to `futility gbb` to report all information found in the GBB region (we already have a function `ft_show_gbb` doing that).",
      "revId": "a97ab144ec4169c3a2f97af31e79f6c9200bb299",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7971dca_f6194036",
        "filename": "futility/cmd_gbb_utility.c",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-06T09:46:39Z",
      "side": 1,
      "message": "Correction: 3. Add `--all` to `futility gbb --get`",
      "parentUuid": "8aa576c3_0e3b7857",
      "revId": "a97ab144ec4169c3a2f97af31e79f6c9200bb299",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7d51e32d_80c00bb6",
        "filename": "futility/cmd_gbb_utility.c",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1314079
      },
      "writtenOn": "2023-03-06T12:18:12Z",
      "side": 1,
      "message": "Merely swapping flashrom cli for futility cli isn\u0027t the goal here. It is more to understand the actual behavioral requirements of SPI interactions required for ChromeOS to work correctly and provide that as a ABI.\n\n1./ CL:4075310 wasn\u0027t added for CL:4308230, it was intended to read all of flash in a ChromeOS specific way (pad what cannot be read etc to fix flashrom usage techdebt). Reading all of flash is not suitable for just a very specific bit of data. CL:4075310 is more suitable as a hammer for bring up.\n\n2./ I looked at both implementations, `show` and `gbb`, the implementation fits nicely within `gbb` and not `show` in practice. Furthermore, since `gbb` is technically where this data is stored it is a logical grouping to have a relevant flag associated with it.\n\n3./ Seems orthogonal to the issue here to obtaining a key version, a reasonable ABI requirement much as-is the case of flags||hwid||digest. The \u0027--all\u0027 sounds more like what the `show` sub-command does.",
      "parentUuid": "a7971dca_f6194036",
      "revId": "a97ab144ec4169c3a2f97af31e79f6c9200bb299",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f500b07_f19b0d39",
        "filename": "futility/cmd_gbb_utility.c",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-08T07:41:24Z",
      "side": 1,
      "message": "My concern is that we will end up with more and more duplicate (or similar) code in `show` and `gbb`. If `--recoverykey-ver` is added now, there will likely be `--rootkey-ver` or `--recoverykey-algo` added in the future. It doesn\u0027t make sense for futility as a single tool to have multiple ways to do the same thing. I know that reading GBB flags and hwid are already supported for both `show` and `gbb` commands, but we don\u0027t want that to keep getting worse.\n\n\u003e Furthermore, since gbb is technically where this data is stored it is a logical grouping to have a relevant flag associated with it.\n\nFrom the perspective of \"signing and verification\", which is why vboot exists, the recovery key is just one out of many keys that a ChromeOS firmware image has. The key version that CL:4308230 needs to know is in GBB only because it is for miniOS (recovery). Therefore if we really want an option to read the key version only, `futility show [--flash] --recoverykey-ver` looks like a good solution to me, because the caller doesn\u0027t even need to know where the recovery key is stored. futility should know where the key is, and only read that section from SPI flash.",
      "parentUuid": "7d51e32d_80c00bb6",
      "revId": "a97ab144ec4169c3a2f97af31e79f6c9200bb299",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c0cc99c_5573ed8c",
        "filename": "futility/cmd_gbb_utility.c",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1314079
      },
      "writtenOn": "2023-06-19T04:54:34Z",
      "side": 1,
      "message": "\u003e My concern is that we will end up with more and more duplicate (or similar) code in `show` and `gbb`. If `--recoverykey-ver` is added now, there will likely be `--rootkey-ver` or `--recoverykey-algo` added in the future. It doesn\u0027t make sense for futility as a single tool to have multiple ways to do the same thing. I know that reading GBB flags and hwid are already supported for both `show` and `gbb` commands, but we don\u0027t want that to keep getting worse.\n\u003e \n\nThis seems like an orthogonal issue where we should actually just merge those two sub-commands. Much in the same way we should merge cmd_{dump,load}_fmap.c . \"show\" never was clear as a sub-command, \u0027show what\u0027 is the immediate thing that comes to mind. Therefore I agree with exactly your core point just that the implementation should be the other way, to squash show into gbb and not gbb into show.\n\n\u003e \u003e Furthermore, since gbb is technically where this data is stored it is a logical grouping to have a relevant flag associated with it.\n\u003e \n\u003e From the perspective of \"signing and verification\", which is why vboot exists, the recovery key is just one out of many keys that a ChromeOS firmware image has. The key version that CL:4308230 needs to know is in GBB only because it is for miniOS (recovery). Therefore if we really want an option to read the key version only, `futility show [--flash] --recoverykey-ver` looks like a good solution to me, because the caller doesn\u0027t even need to know where the recovery key is stored. futility should know where the key is, and only read that section from SPI flash.",
      "parentUuid": "2f500b07_f19b0d39",
      "revId": "a97ab144ec4169c3a2f97af31e79f6c9200bb299",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4255dc1a_998ebee6",
        "filename": "futility/cmd_gbb_utility.c",
        "patchSetId": 2
      },
      "lineNbr": 51,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-06-20T01:56:18Z",
      "side": 1,
      "message": "Sorry, but I still disagree. I think it\u0027s pretty clear from the help text of `futility show` that the FILE argument could be various things including a keyblock file and an AP firmware image. And it\u0027s designed to be \"smart\" enough to tell which kind of files it\u0027s reading, so that people don\u0027t need to remember tons of different option names.\n\n\u003e Therefore I agree with exactly your core point just that the implementation should be the other way, to squash show into gbb and not gbb into show.\n\nI\u0027m afraid that\u0027s not possible, because many file formats `futility show` supports are not in the GBB section. Maybe you mean squashing \"part of futility show\" to \"futility gbb\"? Again, from the perspective of \"signing and verification\", I don\u0027t think that will make things better.",
      "parentUuid": "7c0cc99c_5573ed8c",
      "revId": "a97ab144ec4169c3a2f97af31e79f6c9200bb299",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}