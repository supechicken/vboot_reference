{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4de19e3d_084601e0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 14
      },
      "lineNbr": 0,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-15T11:24:49Z",
      "side": 1,
      "message": "Try to catch error from the callers of ui actions of screens.",
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a85abd1d_501401cd",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 75,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-18T09:35:36Z",
      "side": 1,
      "message": "I\u0027d prefer explicit checking it before calling try_ui_action().",
      "range": {
        "startLine": 75,
        "startChar": 3,
        "endLine": 75,
        "endChar": 62
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81d3121e_223bac5c",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 75,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-18T10:10:09Z",
      "side": 1,
      "message": "OK, I agree.",
      "parentUuid": "a85abd1d_501401cd",
      "range": {
        "startLine": 75,
        "startChar": 3,
        "endLine": 75,
        "endChar": 62
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9a6dbda2_592596e6",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 75,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-22T10:12:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "81d3121e_223bac5c",
      "range": {
        "startLine": 75,
        "startChar": 3,
        "endLine": 75,
        "endChar": 62
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "883cf8cd_0b114723",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 85,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-18T09:35:36Z",
      "side": 1,
      "message": "In general I think this makes everything even more complicated. Looking at this PS, several questions are in my mind:\n\n1. When should we use try_ui_action()? I can\u0027t see why some actions are wrapped with try_ui_action() and others are not. For example, why isn\u0027t screen-\u003eget_menu() wrapped?\n\n2. Calling vb2_ui_screen_back() in this function also adds extra complexity. Now for some errors vb2_ui_screen_back() is called in init() function, while others rely on this function to call vb2_ui_screen_back() for them.\n\n3. After this CL, when we encounter an error in screen-\u003einit() (or friends), it looks like we only have 2 options:\n(a) Set error_code, call vb2_ui_screen_back(), and return VB2_REQUEST_UI_CONTINUE\n(b) Return any error and let try_ui_action() do the rest\nIs my understanding correct?",
      "range": {
        "startLine": 85,
        "startChar": 19,
        "endLine": 85,
        "endChar": 32
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8dc2eaee_a94cb7a7",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 85,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-18T10:10:52Z",
      "side": 1,
      "message": "\u003e 1. When should we use try_ui_action()? I can\u0027t see why some actions are wrapped with try_ui_action() and others are not. For example, why isn\u0027t screen-\u003eget_menu() wrapped?\n\nSorry I missed it.\n\n\u003e 2. Calling vb2_ui_screen_back() in this function also adds extra complexity. Now for some errors vb2_ui_screen_back() is called in init() function, while others rely on this function to call vb2_ui_screen_back() for them.\n\u003e 3. After this CL, when we encounter an error in screen-\u003einit() (or friends), it looks like we only have 2 options:\n\u003e (a) Set error_code, call vb2_ui_screen_back(), and return VB2_REQUEST_UI_CONTINUE\n\u003e (b) Return any error and let try_ui_action() do the rest\n\nYes. I set back_on_error\u003d1 if the error makes the screen cannot be generated correctly.\nBasically, all the error of actions break the screen except the error from menu_item-\u003eaction. If a menu_item-\u003eaction failed we should stay at the current screen rather than go back to the parent screen.\n\nFor some errors which we want to show specific message, like VB2_UI_ERROR_UNTRUSTED_CONFIRMATION, we show the message by set the error_code and return. (also without vb2_ui_screen_back.)\n\nSo this change is focus on all the \"unexpected\" errors which may break the ui loop. Because currently in some screen we only give users some general message like \"Could not get firmware log.\" I think this should cover most of the current cases.",
      "parentUuid": "883cf8cd_0b114723",
      "range": {
        "startLine": 85,
        "startChar": 19,
        "endLine": 85,
        "endChar": 32
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7d15275c_16dd9193",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 85,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-22T10:12:09Z",
      "side": 1,
      "message": "Added get_menu to try_ui_action.",
      "parentUuid": "8dc2eaee_a94cb7a7",
      "range": {
        "startLine": 85,
        "startChar": 19,
        "endLine": 85,
        "endChar": 32
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "485907c4_0babde6b",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 104,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-18T09:35:36Z",
      "side": 1,
      "message": "Do you want to overwrite it if this has already been set? IMO it makes more sense to report the very first error.",
      "range": {
        "startLine": 104,
        "startChar": 5,
        "endLine": 104,
        "endChar": 15
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "73968f1d_3da356e5",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 104,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-18T10:10:09Z",
      "side": 1,
      "message": "Yes. I decided to overwrite it. But I\u0027m ok for both keeping the first or keeping the last.\n\nBecause REQUEST_UI_CONTINUE should not be caught, this should only happen when another error ocuss in vb2_ui_screen_back() or after other manually set error_code. ((a) in the above comment)\n\nFor (a), I think the last error is more important than the first one. Because the first one should be what we expected.\nFor the error in vb2_ui_screen_back(), it could be:\ni. Some errors in vb2_* functions.\nii. Some errors in the reinit() of other screens.\nI\u0027m not sure which is more important.",
      "parentUuid": "485907c4_0babde6b",
      "range": {
        "startLine": 104,
        "startChar": 5,
        "endLine": 104,
        "endChar": 15
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e569d9eb_0630b622",
        "filename": "firmware/2lib/2ui.c",
        "patchSetId": 14
      },
      "lineNbr": 104,
      "author": {
        "id": 1240396
      },
      "writtenOn": "2021-03-22T10:12:09Z",
      "side": 1,
      "message": "Keep the first error code and log the error codes.",
      "parentUuid": "73968f1d_3da356e5",
      "range": {
        "startLine": 104,
        "startChar": 5,
        "endLine": 104,
        "endChar": 15
      },
      "revId": "3bd09656ba84ec6c230307218e04fdf1c7786f2f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}