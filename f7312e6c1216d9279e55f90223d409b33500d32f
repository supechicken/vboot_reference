{
  "comments": [
    {
      "key": {
        "uuid": "68d9e31f_c2152324",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1260470
      },
      "writtenOn": "2020-09-29T19:01:34Z",
      "side": 1,
      "message": "Does factory mode have a way know to do the cold reboot then?",
      "revId": "f7312e6c1216d9279e55f90223d409b33500d32f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4aa5654f_5536aab4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1302633
      },
      "writtenOn": "2020-09-30T19:29:23Z",
      "side": 1,
      "message": "Yes, Based on my interaction with Hung-Te. We probably have to update the detail in the Care \u0026 Feeding Doc to be more clear.",
      "parentUuid": "68d9e31f_c2152324",
      "revId": "f7312e6c1216d9279e55f90223d409b33500d32f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "66cf23f9_574a30ed",
        "filename": "futility/updater.c",
        "patchSetId": 2
      },
      "lineNbr": 542,
      "author": {
        "id": 1003000
      },
      "writtenOn": "2020-10-01T18:09:12Z",
      "side": 1,
      "message": "What happens in these cases:\n1. Recovery mode - Is board-postinst run in this case? Even if it does, I believe it ends up creating the force_csme_update file on external disk. So, on reboot, will CSME not be updated?\n\n2. Manual update by developers - When developers run chromeos-firmwareupdate, how is CSME update handled in that case?\n\n3. Labs - How do labs perform firmware update? Do they use chromeos-firmwareupdate? How is CSME update handled in that case?\n\n4. Testing - What happens in case of FAFT/autotest/tast? Are there any paths for chromeos-firmwareupdate?",
      "range": {
        "startLine": 541,
        "startChar": 43,
        "endLine": 542,
        "endChar": 52
      },
      "revId": "f7312e6c1216d9279e55f90223d409b33500d32f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f4bf1069_02805d8f",
        "filename": "futility/updater.c",
        "patchSetId": 2
      },
      "lineNbr": 542,
      "author": {
        "id": 1302633
      },
      "writtenOn": "2020-10-05T15:40:04Z",
      "side": 1,
      "message": "To address all the concerns mentioned above, it seems the better option is to set the preserve flag for SI_ME region in the SPI ROM during board-postinst. Also preserve the SI_ME region only for auto-update. This will ensure that the recovery and factory mode remain the same as today. Also the testlab and FAFT tests are not impacted if they use a non auto-update workflow.\n\nThoughts??",
      "parentUuid": "66cf23f9_574a30ed",
      "range": {
        "startLine": 541,
        "startChar": 43,
        "endLine": 542,
        "endChar": 52
      },
      "revId": "f7312e6c1216d9279e55f90223d409b33500d32f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12af4c5e_d407522e",
        "filename": "futility/updater.c",
        "patchSetId": 2
      },
      "lineNbr": 542,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2020-10-06T01:25:06Z",
      "side": 1,
      "message": "\u003e set the preserve flag for SI_ME region in the SPI ROM during board-postinst.\n\nI\u0027m not sure what does that mean?\n\n\u003e Also preserve the SI_ME region only for auto-update. \n\nThe auto-update by default will only do A/B update, not touching SI_ME. The RO (and other) sections are preserved only when WP not enabled and RO changes found (will fallback to recovery mode).\n\nBut if your goal is to help dogfooders, that should be sufficient and  you can check cfg-\u003etry_update for that. P.S: I\u0027m not sure if FAFT will be impacted or not. If your device can\u0027t run \u0027reboot\u0027 after CSME updated, some FAFT items may still fail - you have to test and run.",
      "parentUuid": "f4bf1069_02805d8f",
      "range": {
        "startLine": 541,
        "startChar": 43,
        "endLine": 542,
        "endChar": 52
      },
      "revId": "f7312e6c1216d9279e55f90223d409b33500d32f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07119c44_b3bbbcb9",
        "filename": "futility/updater.c",
        "patchSetId": 2
      },
      "lineNbr": 542,
      "author": {
        "id": 1302633
      },
      "writtenOn": "2020-10-06T04:25:55Z",
      "side": 1,
      "message": "\u003e\u003e I\u0027m not sure what does that mean?\n\nHere are the details:\n\nIf WP is enabled, then board-postinst returns immediately\nIf factory mode, then board-postinst is not invoked\nIf recovery install, then board-postinst returns immediately (planning to check IS_RECOVERY_INSTALL environment variable for that)\n\nIf all the above conditions are not met, then\n1) Read the FMAP image region from the SPI ROM.\n2) Extract the FMAP Area flag for ME region from that FMAP image.\n3) Set the FMAP_AREA_PRESERVE flag and write the updated FMAP image back to the SPI ROM. Also install the force_csme_update file in stateful partition.\n4) In the futility, perform the following under the preserve_management_engine_section\n  a) If FMAP_AREA_PRESERVE is set, preserve the SI_ME region. FYI, FMAP_AREA_PRESERVE is set in the source/from image. This is done because we cannot update the to/destination image in the RO filesystem.\n5) When the user triggers a reset, CSME region is updated post boot during the start of UI.\n6) Post CSME update, trigger a cold reset. Since the to/destination image does not have FMAP_AREA_PRESERVE flag set for ME, nothing additional needs to be done.\n\nThis will ensure that this whole thing is done only for dogfooders.\n\nI was initially thinking about just checking config-\u003etry_update to handle the recovery mode scenario. But then it leaves open questions about FAFT and how testlab performs firmware update. Hence proposed this option to solve one problem at a time.",
      "parentUuid": "12af4c5e_d407522e",
      "range": {
        "startLine": 541,
        "startChar": 43,
        "endLine": 542,
        "endChar": 52
      },
      "revId": "f7312e6c1216d9279e55f90223d409b33500d32f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}