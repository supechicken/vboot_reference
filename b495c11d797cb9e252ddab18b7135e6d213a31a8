{
  "comments": [
    {
      "key": {
        "uuid": "48613042_669a628c",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-03T23:13:51Z",
      "side": 1,
      "message": "Are you sure this works right? This message is drawn before we do the key action, so if the intention is to make sure to redraw the message whenever they key action may have redrawn the screen, I think this wouldn\u0027t work up here.\n\nThen again, I don\u0027t think(?) any of the actions available from the disable_dev_boot path would overpaint this message anyway, so maybe it\u0027s enough to just hoist this in front of the loop?",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc4f0e39_2d94973b",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-02-04T06:29:57Z",
      "side": 1,
      "message": "\u003e Then again, I don\u0027t think(?) any of the actions available from the disable_dev_boot path would overpaint this message anyway, so maybe it\u0027s enough to just hoist this in front of the loop?\n\nFunctions such as boot_disk_action() (when pressing ctrl-d) will overpaint this message by calling vb2_error_notify() if disable_dev_boot, so we cannot just print this message once before the loop.\n\n\u003e Are you sure this works right? This message is drawn before we do the key action, so if the intention is to make sure to redraw the message whenever they key action may have redrawn the screen, I think this wouldn\u0027t work up here.\n\nI think there\u0027s nothing wrong here.\n\n- If nothing is pressed in an iteration, then nothing will be redrawn.\n- If a key is pressed, then the error message will be drawn before calling the corresponding function. If the function overpaints the message with another one, then I think we should keep the more specific message, i.e., the latter.",
      "parentUuid": "48613042_669a628c",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c40213f5_fcd506f7",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-02-04T09:28:04Z",
      "side": 1,
      "message": "Okay, the second part of my last comment is wrong.\n\n- We cannot draw the error message before the key action because vb2_draw_current_screen(), called from the action, will potentially clears the whole screen.\n- We also cannot draw the message after the action because we\u0027ll want to keep the more specific error message drawn by the action visible to the user.\n\nTherefore, if we\u0027re going to fix the flickering without breaking other behavior, the easiest way is to draw the error inside enter_to_norm_menu().",
      "parentUuid": "fc4f0e39_2d94973b",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d313316b_2b8b79bb",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-04T10:58:40Z",
      "side": 1,
      "message": "I don\u0027t think putting the call inside enter_to_norm_menu() is going to work either.  vb2_draw_current_screen() gets called every time UP/DOWN navigation is used.  IIUC, that will clear the dev_disable_msg text.",
      "parentUuid": "c40213f5_fcd506f7",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6909a844_82b2acae",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-04T21:23:04Z",
      "side": 1,
      "message": "I really think you shouldn\u0027t overthink this. This case is already super rare (i.e. there\u0027s a reason why no one ever bothered to fully internationalize this message like we should have), and if the user then goes ahead and presses Ctrl+D from the TO_NORM screen (which technically works but isn\u0027t really an intended flow), then I guess they won\u0027t see this message again afterwards... whoop-dee-doo. They presumably saw it the first time before they started pressing buttons already.\n\nSimilarly, moving around between menu options shouldn\u0027t clear this (if you follow the call chain from vb2_draw_current_screen() it shouldn\u0027t end up redrawing the base screen when staying within the same menu), and if people do go into the language menu then, well, they probably did that because they didn\u0027t understand the message and redisplaying it in English isn\u0027t gonna fix that.\n\nJust take out all these extra variables and print this once before the loop, it\u0027s gonna be good enough. This is all ready a crappy poor-man\u0027s excuse for a UI because we were too lazy to make a real one, let\u0027s not waste tons of time (and code complexity) on polishing a turd. (And yes, for Groot it would be good to have a real, internationalized info screen for this.)",
      "parentUuid": "d313316b_2b8b79bb",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd4a284b_64f08573",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-04T23:03:47Z",
      "side": 1,
      "message": "Good sanity check... I hadn\u0027t thought through the fact that (a) Ctrl+D means they won\u0027t see the screen again and (b) choosing a different language isn\u0027t going to change the message from English anyways (\u003d\n\nIf vb2_draw_current_screen() won\u0027t clear the message, then should we just keep it in enter_to_norm_menu() like the latest PS4 does?",
      "parentUuid": "6909a844_82b2acae",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1b4a1160_d63dfe77",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-04T23:21:44Z",
      "side": 1,
      "message": "\u003e Ctrl+D means they won\u0027t see the screen again\n\nNo, they will, because it always fails in this mode. Still, it\u0027s not something that anyone would normally want to press (or even know is an option) on this screen.\n\n\u003e should we just keep it in enter_to_norm_menu() like the latest PS4 does?\n\nYeah, okay, I guess that\u0027s simple enough too.",
      "parentUuid": "dd4a284b_64f08573",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1df0ec0f_f97bae3f",
        "filename": "firmware/lib/vboot_ui_menu.c",
        "patchSetId": 3
      },
      "lineNbr": 775,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-02-05T09:07:18Z",
      "side": 1,
      "message": "\u003e Similarly, moving around between menu options shouldn\u0027t clear this (if you follow the call chain from vb2_draw_current_screen() it shouldn\u0027t end up redrawing the base screen when staying within the same menu).\n\nNavigating between options will clear *part* of the error message because the screen description is not contained in the base screen. There seems to be no trivial way to solve both flickering and overlapping problem. After an offline discussion with @hungte, @drinkcat and @kitching, we decided to leave it as is for now.\n\nFiled https://bugs.chromium.org/p/chromium/issues/detail?id\u003d1049029.",
      "parentUuid": "1b4a1160_d63dfe77",
      "range": {
        "startLine": 775,
        "startChar": 46,
        "endLine": 775,
        "endChar": 54
      },
      "revId": "b495c11d797cb9e252ddab18b7135e6d213a31a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}