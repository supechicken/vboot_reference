{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "929b6ebd_666eb843",
        "filename": "firmware/2lib/include/2nvstorage_fields.h",
        "patchSetId": 4
      },
      "lineNbr": 105,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "not anymore",
      "range": {
        "startLine": 105,
        "startChar": 30,
        "endLine": 105,
        "endChar": 45
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6ffee72a_74a9f198",
        "filename": "firmware/2lib/include/2nvstorage_fields.h",
        "patchSetId": 4
      },
      "lineNbr": 105,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Moved to 0x10 and updated to \"unused \u003d 0x20\".  Also removed the \"unused\" text from VB2_NV_OFFS_BOOT2.",
      "parentUuid": "929b6ebd_666eb843",
      "range": {
        "startLine": 105,
        "startChar": 30,
        "endLine": 105,
        "endChar": 45
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "921fd379_f2a3ecfd",
        "filename": "firmware/2lib/include/2nvstorage_fields.h",
        "patchSetId": 4
      },
      "lineNbr": 105,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-24T22:18:36Z",
      "side": 1,
      "message": "Well, now it should be `unused \u003d 0xa0` though, right?",
      "parentUuid": "6ffee72a_74a9f198",
      "range": {
        "startLine": 105,
        "startChar": 30,
        "endLine": 105,
        "endChar": 45
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "beae3460_6fe58a97",
        "filename": "firmware/2lib/include/2nvstorage_fields.h",
        "patchSetId": 4
      },
      "lineNbr": 105,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-26T08:40:42Z",
      "side": 1,
      "message": "Ah, right.  I was thinking of this as \"the first unused field\" rather than \"a bitmask of unused fields\".",
      "parentUuid": "921fd379_f2a3ecfd",
      "range": {
        "startLine": 105,
        "startChar": 30,
        "endLine": 105,
        "endChar": 45
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2349adde_adf7606b",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 90,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "nit: keep original whitespace?",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4c0ef5ad_f1b6aba1",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 90,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "I\u0027m not sure it\u0027s super useful when the flags are so far apart from one another (in between the comments)?  Anyways, I moved the whitespace change to CL:2872251 -- let me know there if you\u0027d prefer to keep them aligned.",
      "parentUuid": "2349adde_adf7606b",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0046faea_080a7a22",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 128,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "nit: needs documentation comment",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c9da8a8e_3c31ce03",
        "filename": "firmware/include/vboot_api.h",
        "patchSetId": 4
      },
      "lineNbr": 128,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0046faea_080a7a22",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f8545598_83c15d1a",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 96,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "nit: is it worth adding these? (if we want more debug output I\u0027d at least print some extra relevant information, like info flags, disk size, etc.)",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff95a7ac_15f03657",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 96,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Thought it might be useful to tell whether we are in partition-search-mode or sector-search-mode.  Moved that information to a VB2_DEBUG line at the top of the function.",
      "parentUuid": "f8545598_83c15d1a",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "48651859_6d29a263",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 243,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-19T06:55:18Z",
      "side": 1,
      "message": "TODO: Start setting EXTERNAL_1 and EXTERNAL_0 correctly.",
      "range": {
        "startLine": 243,
        "startChar": 1,
        "endLine": 243,
        "endChar": 3
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a1ae9fcb_98d4b3c9",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 243,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-19T05:58:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "48651859_6d29a263",
      "range": {
        "startLine": 243,
        "startChar": 1,
        "endLine": 243,
        "endChar": 3
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c46559d_b1cbcb79",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 273,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-19T06:55:18Z",
      "side": 1,
      "message": "Note that these two blocks can probably be collapsed into one.  We may even want to do regular recovery image rollback checking here just for consistency, even if we do it in the recovery image as well?  (Or we can remove it from there eventually?)",
      "range": {
        "startLine": 273,
        "startChar": 0,
        "endLine": 273,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9ed26c26_107cbd98",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 273,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-09-02T02:01:36Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "2c46559d_b1cbcb79",
      "range": {
        "startLine": 273,
        "startChar": 0,
        "endLine": 273,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "49035db6_9a2b5f50",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "I\u0027m not really sure whether this should be a key version or preamble version check tbh. Preamble would be more in line with the way it works on USB recovery images (where the version is baked into the body image). But I guess then again, if we *can* cover the key why not do it? But that means we need to be careful, if we want to bump this version to lock out old images we\u0027ll always have to actually change the recovery subkey (even if the key is fine and there\u0027s just a problem with the image). If we just naively update the NBR code and bump the version number in our signer configs, the old subkey will just get resigned with a newer version number, and an attacker can combine that new keyblock with an old NBR image which will verify just fine. The recovery subkey is already not rollback protected for USB images anyway, so if that key leaks we\u0027re pretty much already maximally screwed. So maybe there\u0027s no point in covering the key part for NBR and it would be better to put this in the preamble to avoid someone making the signing mistake mentioned above?\n\n...honestly, all of this is a consequence of trying to jam a shitty poor man\u0027s rollback protection that doesn\u0027t really cover all the bases properly into our existing TPM spaces. Really, we should just have keyblock *and* preamble/body rollback checks for both NBR and USB recovery and store that version separately in the TPM (with some clever mechanism of how to update it -- maybe commandeer one of the reserved fields in the kernel preamble?). I know that\u0027s again a big request that nobody has time for (and updating TPM space layouts is annoying), but the technical debt of all these versions getting abused for what they weren\u0027t really designed for is starting to cost us, too.\n\n(Also, did we answer the question what should happen if there\u0027s a problem with TPM communication? Because I think then sd-\u003ekernel_version_secdata will have been initialized to 0 -- which, I guess is what we want?.)",
      "range": {
        "startLine": 274,
        "startChar": 6,
        "endLine": 274,
        "endChar": 17
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef4c46e3_afe5e516",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Okay, assuming we go with the preamble option, are we still checking it against the top 4 bits of kernel_version_secdata (even though the top 8 bits are normally used for keyblock checking)?",
      "parentUuid": "49035db6_9a2b5f50",
      "range": {
        "startLine": 274,
        "startChar": 6,
        "endLine": 274,
        "endChar": 17
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f50f156a_0900ad46",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-24T22:18:36Z",
      "side": 1,
      "message": "\u003e Okay, assuming we go with the preamble option, are we still checking it against the top 4 bits of kernel_version_secdata (even though the top 8 bits are normally used for keyblock checking)?\n\nI mean... I guess? Like I said they\u0027re both not really the right place to put it, it would really be better to just revamp the whole thing to give it its own proper version field.\n\nI think Randall put it in the key version because we need that less often for its actual intended purpose than the other version, so it\u0027s more likely we can spare the bits. (We should also consider whether for something more complicated like NBR, 4 bits is really enough... I\u0027m worried that might get a bit tight for the initial shaking-out-the-bugs period.)",
      "parentUuid": "ef4c46e3_afe5e516",
      "range": {
        "startLine": 274,
        "startChar": 6,
        "endLine": 274,
        "endChar": 17
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d43061b_ce6f59b0",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-26T08:40:42Z",
      "side": 1,
      "message": "Given that we are not going to revamp all of the version fields at the moment, sharing with kernel_version_secdata sounds like the best solution.\n\nWould assigning 5 bits allay your concerns, or would that be very awkward?",
      "parentUuid": "f50f156a_0900ad46",
      "range": {
        "startLine": 274,
        "startChar": 6,
        "endLine": 274,
        "endChar": 17
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f2687357_081e6de2",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-27T00:28:44Z",
      "side": 1,
      "message": "\u003e Given that we are not going to revamp all of the version fields at the moment\n\nBut, but... tech debt...   :Â°-(\n\n\u003e Would assigning 5 bits allay your concerns, or would that be very awkward?\n\nLet\u0027s make it 8, at least, so it\u0027s not quite as awkward.",
      "parentUuid": "9d43061b_ce6f59b0",
      "range": {
        "startLine": 274,
        "startChar": 6,
        "endLine": 274,
        "endChar": 17
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7b327a2a_8c5709d5",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-06-16T00:33:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f2687357_081e6de2",
      "range": {
        "startLine": 274,
        "startChar": 6,
        "endLine": 274,
        "endChar": 17
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "01a290e7_9ba11f6e",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 341,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-19T06:55:18Z",
      "side": 1,
      "message": "Not 100% sure about the logic here.",
      "range": {
        "startLine": 340,
        "startChar": 5,
        "endLine": 341,
        "endChar": 57
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0808559_376f7096",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 341,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "Not really sure why you\u0027d add this? Isn\u0027t boot_mode still VB2_BOOT_MODE_RECOVERY for NBR? (I wouldn\u0027t see NBR as a separate boot_mode for those purposes, it\u0027s just a different menu option in the manual recovery boot mode menu. Same as Ctrl+D and Ctrl+U both are BOOT_MODE_DEVELOPER.)",
      "parentUuid": "01a290e7_9ba11f6e",
      "range": {
        "startLine": 340,
        "startChar": 5,
        "endLine": 341,
        "endChar": 57
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "335e84a4_57b220a9",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 341,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d0808559_376f7096",
      "range": {
        "startLine": 340,
        "startChar": 5,
        "endLine": 341,
        "endChar": 57
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "78342100_963e586a",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 497,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "Took me a while to figure out why you need to reopen a new stream here (so you don\u0027t skip sectors when unsuccessful), so maybe add a comment to clarify that?",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "35cb0656_bcc43885",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 497,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "78342100_963e586a",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f8070b39_4413fe3f",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-19T06:55:18Z",
      "side": 1,
      "message": "Do we want to pass disk_info along directly?  Or even just the single relevant flag in disk_info-\u003eflags?",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "272d44db_051af3d5",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "How about making a new lpflag for this? (And then either pass lpflags into vb2_verify_kernel_vblock() or turn it into a boolean at that point.)",
      "parentUuid": "f8070b39_4413fe3f",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7b2db4a5_af1d5377",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "So if we decide to hinge this decision off of \"the user is accessing the NBR boot feature of the UI\" rather than \"this is an external USB disk\" (see discussion above about EXTERNAL_0 vs. NBR_0), then this needs to be either (1) set as a context flag before calling VbTryLoadKernel, or (2) sent as a flag into this function, plumbed all the way down into vb2_verify_kernel_vblock, or even (3) sent as a flag into this function, and set (temporarily) in vb2_shared_data while calling LoadKernel*.\n\nAny preference?",
      "parentUuid": "272d44db_051af3d5",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8930d57a_bac73ad9",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-24T22:18:36Z",
      "side": 1,
      "message": "Sorry, I\u0027m confused: this function is part of the sector search (aka NBR boot) code. You can only possibly get here if someone selected the NBR option from the menu. So you know 100% you are booting NBR here. All you need to do is pass that info down from here into vb2_load_partition() (and then on to vb2_verify_kernel_vblock()). I\u0027d suggest adding a new type of lpflag for that. (It should still stay in the disk flags as well, of course, because TryLoadKernel() needs that. I\u0027m just saying use the other flags here so you don\u0027t need to have two different kinds of flags in vb2_load_partition().)",
      "parentUuid": "7b2db4a5_af1d5377",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "419082b2_f71b1bbf",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-26T08:40:42Z",
      "side": 1,
      "message": "Added a new lpflag as you suggested, but also took the \"SECTOR_SEARCH\" flag out of VbTryLoadKernel disk_flags (formerly get_info_flags).\n\nI also figured that if we\u0027re not considering external NBR boots as you suggest, then we may as well create a separate API call (VbTryLoadNbrKernel) which specifies disk_flags itself (since they must be set to FIXED).  Let me know if you would strongly prefer keeping all the flags together in disk_flags under one API call.",
      "parentUuid": "8930d57a_bac73ad9",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "973c66bb_59f7b6b8",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-27T00:28:44Z",
      "side": 1,
      "message": "Well, I thought the idea was mainly to be able to reuse the existing code in VbTryLoadKernel() as far as it applies to NBR (e.g. fetching and looping through disks). If you think there\u0027s not enough code left in that function that NBR actually needs to make this worth it, I guess we can also make a new function (but I don\u0027t really see a big problem with the disk flag tbh).",
      "parentUuid": "419082b2_f71b1bbf",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70ad05d9_4b4587d0",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-06-16T00:33:42Z",
      "side": 1,
      "message": "We\u0027re still making use of the same disk looping code under-the-hood.  But (1) it seemed really weird to be grouping \"NBR_BOOT\" as a flag alongside the type of disk being booted, and (2) the API would only be valid when the appropriate flags are set at the same time (i.e. BOOT_NBR|DISK_FIXED).  If NBR is *only* valid under this kind of situation, it seemed like we were better off not tainting the VB_DISK_FLAG mask (whose functionality should really be limited to disk-related things used with  VbEx disk functions), and creating a separate call to hide disk selection for the NBR case.",
      "parentUuid": "973c66bb_59f7b6b8",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1d119d3_282f302f",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 502,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-09-02T02:01:36Z",
      "side": 1,
      "message": "Julius, are you okay with latest implementation (PS39)?",
      "parentUuid": "70ad05d9_4b4587d0",
      "range": {
        "startLine": 502,
        "startChar": 47,
        "endLine": 502,
        "endChar": 63
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c97f9be7_29d87aef",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 523,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "nit: a lot of these should probably be different codes than NO_DISK_FOUND?",
      "range": {
        "startLine": 523,
        "startChar": 9,
        "endLine": 523,
        "endChar": 11
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b05d861e_3cb49598",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 523,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Sure, we can do that.\n\nI\u0027m also trying to figure out: When we attempt loading kernels across a bunch of different sectors, and none of them succeed, which failure do we return?  I would say \"the one with the lowest value\" (since we decided to order LoadKernel errors from most specific to least specific) -- but that means we need to throw away any value returned by vb2_load_partition (and map it to INVALID_KERNEL_FOUND).  Is that okay?  (I guess that\u0027s what we\u0027re doing in LoadKernel()...)  Should I also try to make use of these new return values in LoadKernel() as well?",
      "parentUuid": "c97f9be7_29d87aef",
      "range": {
        "startLine": 523,
        "startChar": 9,
        "endLine": 523,
        "endChar": 11
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "28cfffa1_2730768f",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 523,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-24T22:18:36Z",
      "side": 1,
      "message": "I mean, the point of the whole LoadKernel() ordering is to make sure we get the right recovery reason. Since this cannot trigger recovery, it\u0027s not as important.\n\nI guess for LoadKernel(), when you get read errors you\u0027ll currently end up with 0x5b (No bootable kernel found). If you want, I guess we could introduce a new \"Disk read error\" reason to differentiate that... in practice, I think that\u0027s not very important because most disk communication errors already hit during the disk initialization in depthcharge and then depthcharge doesn\u0027t even present it as a disk (so you get 0x5a (No bootable storage device)).\n\nSo I think you can either translate all of these to NO_KERNEL_FOUND to match the other LoadKernel() or you can just leave them at whatever codes they are, since they aren\u0027t gonna get translated into recovery reasons it doesn\u0027t matter. I think you shouldn\u0027t add new VB2_ERROR_LK_ errors for this, though... that class of errors should be restricted to only those that TryLoadKernel() actually translates into recovery reasons according to a certain priority. For the other stuff here I\u0027d just reuse or create other normal VB2_ERROR_ codes.",
      "parentUuid": "b05d861e_3cb49598",
      "range": {
        "startLine": 523,
        "startChar": 9,
        "endLine": 523,
        "endChar": 11
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "201f5b86_7ccd91a8",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 523,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-26T08:40:42Z",
      "side": 1,
      "message": "Seems like overkill to have two LoadKernel sections (one for errors that have recovery code equivalents, and one for errors that don\u0027t).  Are we okay just returning NO_KERNEL_FOUND?",
      "parentUuid": "28cfffa1_2730768f",
      "range": {
        "startLine": 523,
        "startChar": 9,
        "endLine": 523,
        "endChar": 11
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d6001cd_fccee805",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 523,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-27T00:28:44Z",
      "side": 1,
      "message": "I mean, you don\u0027t need to create another new section, you can just throw it into one of the existing generic ones. But yes, I\u0027m also okay with only returning NO_KERNEL_FOUND.",
      "parentUuid": "201f5b86_7ccd91a8",
      "range": {
        "startLine": 523,
        "startChar": 9,
        "endLine": 523,
        "endChar": 11
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c81bfcd3_4e0f3880",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 523,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-06-16T00:33:42Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "4d6001cd_fccee805",
      "range": {
        "startLine": 523,
        "startChar": 9,
        "endLine": 523,
        "endChar": 11
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac96b730_65592830",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 560,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "This will blow up on UFS with 4K sectors.",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d2a73c67_0e669d45",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 560,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Good point... I can\u0027t really think of a better solution other than just repeating the expression twice.",
      "parentUuid": "ac96b730_65592830",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d305a2da_22b1a6ca",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 568,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "Don\u0027t you want to... like... break the loop on success or something?",
      "range": {
        "startLine": 568,
        "startChar": 18,
        "endLine": 568,
        "endChar": 37
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f862bea7_6b344443",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 568,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d305a2da_22b1a6ca",
      "range": {
        "startLine": 568,
        "startChar": 18,
        "endLine": 568,
        "endChar": 37
      },
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f7c31dfb_f1833736",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 574,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "nit: I think this might read cleaner with an\n\n if (!bottom_region) {\n   start \u003d ...;\n   end \u003d ...;\n } else {\n   start \u003d ...;\n   end \u003d ...;\n }\n\n VB2_DEBUG(\"Checking %s of disk...\n for (sector \u003d start; sector \u003c end; sector +\u003d batch_count) ...\n\napproach.",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31d54166_c0705c0f",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 574,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f7c31dfb_f1833736",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21a58309_d943c23a",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 588,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "I think we may have different concepts of where the \"bottom\" of a disk is? In my head disks start at the bottom and grow upwards, but your code seems to have it the other way around. Probably better to say front/back or something like that instead?",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50e95be2_e5cb414e",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 588,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "How about \"start\" and \"end\"?",
      "parentUuid": "21a58309_d943c23a",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "af1b8d28_58aa85a1",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 588,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-24T22:18:36Z",
      "side": 1,
      "message": "SGTM",
      "parentUuid": "50e95be2_e5cb414e",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c9525fe_70097de1",
        "filename": "host/lib/crossystem.c",
        "patchSetId": 4
      },
      "lineNbr": 439,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-05-19T23:16:05Z",
      "side": 1,
      "message": "Should probably translate this from/to \"A\"/\"B\" like we do for fw_try_next?",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b57128c7_03799a4a",
        "filename": "host/lib/crossystem.c",
        "patchSetId": 4
      },
      "lineNbr": 439,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-05-21T12:29:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6c9525fe_70097de1",
      "revId": "8e34eacec545f7564513cadd2d8a5e925e062eed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}