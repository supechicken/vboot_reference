{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "796623c9_8c92d177",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 1331721
      },
      "writtenOn": "2021-01-21T17:08:26Z",
      "side": 1,
      "message": "You should also run the FIPS 180-2 test vectors with the SHA256 extensions enabled. These are in tests/vb2_sha_tests.c.",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "000ac94a_f1fd0a06",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-18T08:40:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "796623c9_8c92d177",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5381d93c_5314824e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "Resolved most of comments, thanks a lot for thorough review!\n\nOne remaining concern is testing. Unfortunately SHA extension is pretty new so even my P920 doesn\u0027t have it. I haven\u0027t checked our CQ machines but I don\u0027t think they have it neither.\n\nIf we just want to validate this against FIPS test vectors I can modify depthcharge to run test vectors and print results, but I believe we need something better than that so will try QEMU options Julius mentioned.",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ab45675_086a2097",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 431,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-01-22T00:13:29Z",
      "side": 1,
      "message": "Hmm... is the -march really necessary? Does it not allow you to specify -msha alone? This switch is AMD-specific so I would not like to hardcode it in an option that\u0027s also supposed to be used on Intel CPUs, and I wouldn\u0027t want to take such a wide-reaching option away from coreboot\u0027s control either.\n\nIf GCC doesn\u0027t let you get around the -march in any way, I think I\u0027d rather have the code use inline assembly than use that flag. (Or we need to start dragging this into coreboot and depthcharge which would be the appropriate place to set such a far-reaching flag for firmware builds.)",
      "range": {
        "startLine": 431,
        "startChar": 10,
        "endLine": 431,
        "endChar": 23
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c2720b1_df29a6bb",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 431,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-01-22T00:13:29Z",
      "side": 1,
      "message": "Why the -m32? For firmware builds this should already be set anyway. For userland builds, we can\u0027t just compile the whole library in 32-bit because of this. Do the SHA instructions not work in 64-bit?",
      "range": {
        "startLine": 431,
        "startChar": 24,
        "endLine": 431,
        "endChar": 28
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b0042f9b_cb2f51e8",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 431,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "It turned out that what I need here is -msse3 instead of -march. gcc error message was very confusing with \"target specific option mismatch\" so I added march here..",
      "parentUuid": "1ab45675_086a2097",
      "range": {
        "startLine": 431,
        "startChar": 10,
        "endLine": 431,
        "endChar": 23
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b0415907_4ac946e5",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 431,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "Done.\nSeems like it\u0027s added while I was trying to make it compile and never tested without it :(",
      "parentUuid": "9c2720b1_df29a6bb",
      "range": {
        "startLine": 431,
        "startChar": 24,
        "endLine": 431,
        "endChar": 28
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dcc07621_871af2a9",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 692,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-01-22T00:13:29Z",
      "side": 1,
      "message": "There needs to be some kind of test for this stuff. If you can\u0027t fit it into the normal test framework (might be tricky since it\u0027s a compile-time flag), you could add a compiled test like these that manually builds and links in the extra file. (You would also need to make it detect the host machine and skip that test if it doesn\u0027t have the right hardware support, of course. Does anyone know if our Chrome OS builders support these instructions? If not, maybe we can have the ebuild run it through QEMU... see https://chromium.googlesource.com/chromiumos/docs/+/master/testing/running_unit_tests.md#Non_native-architectures-e_g_QEMU )",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5cfa5d3_3a7798a2",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 692,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-18T08:40:14Z",
      "side": 1,
      "message": "I made a test, but it looks like even QEMU doesn\u0027t support it. (At least for the QEMU build in chrome os)\n\n$ qemu-x86_64 -cpu Snowridge build/tests/vb2_sha256_x86_tests\nqemu-x86_64: warning: TCG doesn\u0027t support requested feature: CPUID.07H:EBX.sha-ni [bit 29]\nqemu: uncaught target signal 4 (Illegal instruction) - core dumped\nIllegal instruction",
      "parentUuid": "dcc07621_871af2a9",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fb93a6a1_3943d4a1",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 692,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-03-04T02:48:26Z",
      "side": 1,
      "message": "Hmm... that\u0027s unfortunate. So is QEMU just generally unable to emulate these things when the host CPU doesn\u0027t support them? I find it hard to understand their code...\n\nThere are other CPU VMs/emulators that may support this... for example there\u0027s a project called Bochs which is a real instruction-by-instruction emulator for x86 that always tends to have support for all the shiny new things very quickly. But it\u0027s a bare-metal emulator for a whole PC, you\u0027d have to write a unit tests that can operate in that environment and figure out some form of I/O to communicate results.\n\nMaybe Raul\u0027s suggest of writing a Tast test is the best approach instead... just run the unit test on a real Chromebook where we know the hardware supports it. Is it still possible to make a HWtest build-blocking these days?",
      "parentUuid": "c5cfa5d3_3a7798a2",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c337c59_e59058e7",
        "filename": "Makefile",
        "patchSetId": 1
      },
      "lineNbr": 692,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-03-08T07:06:44Z",
      "side": 1,
      "message": "Yes I think it\u0027s possible to make tast test to block CQ if it fails - https://chrome-internal.googlesource.com/chromeos/chromeos-admin/+/master/doc/tast_add_test.md#step-4_remove-attribute-to-make-it-run-on-infra.",
      "parentUuid": "fb93a6a1_3943d4a1",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84eda496_b0b652f8",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-01-22T00:13:29Z",
      "side": 1,
      "message": "What is this and where does it come from?",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "99f04248_f5af205f",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "It\u0027s a gcc header for intrinsics like _mm_sha256rnds2_epu32()",
      "parentUuid": "84eda496_b0b652f8",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6be1cc33_86311d8f",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-06-17T03:37:58Z",
      "side": 1,
      "message": "Removed.",
      "parentUuid": "99f04248_f5af205f",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "805738b7_29d004fe",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-01-22T00:13:29Z",
      "side": 1,
      "message": "Please find a way to factor these out from 2sha256.c rather than copy\u0026pasting the whole thing (e.g. put them in a common header or a separate C file or something).",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "42ac6aad_3d48d690",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "805738b7_29d004fe",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c05782d_597b126e",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 57,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-01-22T00:13:29Z",
      "side": 1,
      "message": "Where does all this code come from? Did you write it all from scratch? If you used any external sources, please add a comment about where it was taken from.",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a1b2f958_de142070",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 57,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6c05782d_597b126e",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79c8f3a8_3bff1cda",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1331721
      },
      "writtenOn": "2021-01-21T17:08:26Z",
      "side": 1,
      "message": "these parameters are not used in the macro body, and should be removed.",
      "range": {
        "startLine": 59,
        "startChar": 29,
        "endLine": 59,
        "endChar": 35
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "36a96efa_da50884f",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "79c8f3a8_3bff1cda",
      "range": {
        "startLine": 59,
        "startChar": 29,
        "endLine": 59,
        "endChar": 35
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dea05f38_34fd900c",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 1331721
      },
      "writtenOn": "2021-01-21T17:08:26Z",
      "side": 1,
      "message": "Since SHA256_X86_PUT_STATE0 doesn\u0027t use j or i, you only need j in this macro.",
      "range": {
        "startLine": 65,
        "startChar": 27,
        "endLine": 65,
        "endChar": 28
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e51e2c74_e2dad4ed",
        "filename": "firmware/2lib/2sha256_x86.c",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dea05f38_34fd900c",
      "range": {
        "startLine": 65,
        "startChar": 27,
        "endLine": 65,
        "endChar": 28
      },
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9a6a783e_3bdab8c7",
        "filename": "firmware/2lib/2stub_hwcrypto.c",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1270601
      },
      "writtenOn": "2021-01-21T16:16:50Z",
      "side": 1,
      "message": "Is this required? Won\u0027t these functions get overwritten by 2sha256_x86.c?",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4804e7d4_e0824f81",
        "filename": "firmware/2lib/2stub_hwcrypto.c",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1331721
      },
      "writtenOn": "2021-01-21T17:08:26Z",
      "side": 1,
      "message": "I this they will, because of the __attribute__((weak)). So the #ifndef should be unnecessary.",
      "parentUuid": "9a6a783e_3bdab8c7",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b67906ce_5f2e0114",
        "filename": "firmware/2lib/2stub_hwcrypto.c",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-03T09:38:09Z",
      "side": 1,
      "message": "It is, if I keep both weak and strong symbol weak version was selected. I guess ld chooses whatever they see first. (maybe https://stackoverflow.com/a/37191811)",
      "parentUuid": "4804e7d4_e0824f81",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b484793_cf90178a",
        "filename": "firmware/2lib/2stub_hwcrypto.c",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1270601
      },
      "writtenOn": "2021-02-03T17:30:37Z",
      "side": 1,
      "message": "The strong will override the weak. So you shouldn\u0027t need it.",
      "parentUuid": "b67906ce_5f2e0114",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3033ed4_e499ed90",
        "filename": "firmware/2lib/2stub_hwcrypto.c",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1365538
      },
      "writtenOn": "2021-02-04T04:32:26Z",
      "side": 1,
      "message": "In theory, yes. In practice, no.\n\n(in chroot) $ cat bar1.c\n#include \u003cstdio.h\u003e\n__attribute__((weak))\nvoid bar() {\n        printf(\"weak\\n\");\n}\n\n$ cat bar2.c\n#include \u003cstdio.h\u003e\nvoid bar() {\n        printf(\"strong\\n\");\n}\n\n$ cat foo.c\nvoid bar();\nvoid foo() {\n        bar();\n}\n\n$ cat main.c\nvoid foo();\n\nint main () {\n        foo();\n        return 0;\n}\n\n\n$ make\ngcc -c -o foo.o foo.c\ngcc -c -o bar1.o bar1.c\ngcc -c -o bar2.o bar2.c\nar qc some_lib.a foo.o bar1.o bar2.o\ngcc -c -o main.o main.c\ngcc -o test main.o some_lib.a\n\n$ ./test\nweak\n\nIf I change order of bar1 and bar2 in ar command strong version is selected. But I\u0027d like to add ifdef instead of depending on order of arguments in compilation.",
      "parentUuid": "0b484793_cf90178a",
      "revId": "33a259854a645e612af35c4e9d9de49b7d5f41fd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}