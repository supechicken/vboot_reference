{
  "comments": [
    {
      "key": {
        "uuid": "b04aed96_fec9754b",
        "filename": "firmware/2lib/include/2return_codes.h",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-07-31T09:24:38Z",
      "side": 1,
      "message": "I don\u0027t think this applies anymore, since vboot is not being compiled with UEFI?\n\nI don\u0027t really have a strong preference for using uint32_t or int.  What do you think?",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 12,
        "endChar": 40
      },
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4515d39f_86962882",
        "filename": "firmware/2lib/include/2return_codes.h",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-08-01T01:06:14Z",
      "side": 1,
      "message": "For data types that get serialized, it\u0027s definitely always a good idea to use a fixed-width type. We\u0027re not UEFI but we still have cases where different pieces run with different architectures.\n\nThe question is, does vb2_error_t ever actually get serialized? I can\u0027t think of a point where it does... but on the other hand, it doesn\u0027t really hurt to be careful. How about making it an int32_t, so that it\u0027s fixed-width but does still convert implicitly to an int when needed? (I mean, the other extreme would be to define it as typedef struct { uint32_t err; } and change all the constants to #define VB2_SUCCESS ((vb2_error_t){ .value \u003d 0 })... that way, you force explicit compiler checking for the type. But I\u0027m not sure we want to go that far? And you\u0027d have to introduce some weird syntax for comparison, like if (IS_VB2_SUCCESS(rv)) or something like that.)\n\nI\u0027m also wondering if we should maybe make all the values negative. In lots of other code, negative values are used for errors. If a vb2_error_t ever finds its way into a function that didn\u0027t expect it and checks it with if (rv \u003c 0), that would make it still work. (Of course, we have plenty of other examples where people are using 1 instead of -1 for their default error value so we sort of have that problem already anyway.)",
      "parentUuid": "b04aed96_fec9754b",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 12,
        "endChar": 40
      },
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c8649e6_58b61f38",
        "filename": "firmware/2lib/include/2return_codes.h",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-01T07:38:20Z",
      "side": 1,
      "message": "Re. serialization:\n\n- There is one instance in vboot_kernel.c where it is stored in shcall-\u003ereturn_code (as uint8_t).\n- Another occurs in 2misc.c where the error code is passed to vb2_fail (also casted to uint8_t), which then gets stored in nvram as VB2_NV_RECOVERY_SUBCODE.\n- One location where this nvram variable is read back is in vb2_check_recovery, which has a clause of code where it may end up in sd-\u003erecovery_reason (?!?!?).\n\nAnyways, I don\u0027t think we should be too concerned since these are already ridiculous enough.\n\nRe. using a struct for typedef:\n\nI suppose that\u0027s the C way of doing an enum class?  Seems pretty unwieldy... let\u0027s stick with plain old uint32_t?\n\nRe. negative values:\n\nWe\u0027ve already put a lot of effort into maintaining stable error code values... I suppose if everything just gets switched over to its negative equivalent, that\u0027s not so bad.  But I also haven\u0027t really come across any code (rv \u003c 0) like you mentioned?  (And anyways, this should be changed to (VB2_SUCCESS !\u003d rv).)",
      "parentUuid": "4515d39f_86962882",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 12,
        "endChar": 40
      },
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c1f68fbf_9e1483e2",
        "filename": "firmware/2lib/include/2return_codes.h",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-08-03T05:58:48Z",
      "side": 1,
      "message": "As long as the type that ends up getting serialized is fixed width, it\u0027s fine. Try not to look at the subcode thing too much, that field was overloaded for a few too many purposes. ;) Essentially, the subcode field is supposed to be a special extra info field whose meaning is specific to the main recovery reason. For manual recovery (reason 0x2) in particular, it contains the previous recovery reason which vboot wanted to preserve (when the user was at the BROKEN screen and initiated manual recovery). Otherwise it\u0027s not really used much, although there used to be TPM error codes for some of the TPM-related reasons in there at one point which would be somewhat useful if it still worked (which it doesn\u0027t, crbug.com/637067).\n\nI think defining this to uint32_t is fine. I just wanted to mention that there\u0027s a way to get forced type checking in C if you really want to, but as you mentioned it\u0027s somewhat unwieldy. We don\u0027t really have enough problems with mixing up error types to warrant it, I guess.\n\nSince we\u0027re going to change most of these values anyway (from vb1 to vb2 error space), I thought now if any time might be a good opportunity to switch to negative. But I\u0027m not sure if there\u0027s really a point in that, if you think there isn\u0027t that\u0027s fine too.",
      "parentUuid": "3c8649e6_58b61f38",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 12,
        "endChar": 40
      },
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "18dd6e34_701f32bb",
        "filename": "firmware/2lib/include/2return_codes.h",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-04T11:49:41Z",
      "side": 1,
      "message": "\u003e it contains the previous recovery reason which vboot wanted to preserve\n\nThen I guess it would only tell you the last 8 bits of the previous recovery reason?\n\n\u003e We don\u0027t really have enough problems with mixing up error types to warrant it, I guess.\n\nAfter combing through the error-reporting code, I\u0027m not so sure this is such a true statement.\n\n\u003e now if any time might be a good opportunity to switch to negative.\n\nYeah, let\u0027s stick with positive values.",
      "parentUuid": "c1f68fbf_9e1483e2",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 12,
        "endChar": 40
      },
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "248a8fa2_f9c4db5f",
        "filename": "tests/ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 190,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-08-01T01:06:14Z",
      "side": 1,
      "message": "80 chars",
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b5ea8b9_fcf33658",
        "filename": "tests/ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 190,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-01T07:38:20Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "248a8fa2_f9c4db5f",
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c0caef7d_ff72f118",
        "filename": "tests/ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 242,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-08-01T01:06:14Z",
      "side": 1,
      "message": "ditto",
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "32a0ac56_af748b8f",
        "filename": "tests/ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 242,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-01T07:38:20Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c0caef7d_ff72f118",
      "revId": "05a7dd8b10fe10edd0cce9068521d07b6e384e9b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}