{
  "comments": [
    {
      "key": {
        "uuid": "440e51e2_678a30b4",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 32,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:05:59Z",
      "side": 1,
      "message": "How about modeling this in a single enum variable with three states: POWER_BUTTON_HELD_SINCE_BOOT (initial value), POWER_BUTTON_PRESSED, POWER_BUTTON_RELEASED.",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9fe542e3_3cbe8ca9",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 32,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-05-09T22:19:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "440e51e2_678a30b4",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "05e2317b_bdc487b1",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 66,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:05:59Z",
      "side": 1,
      "message": "Then all this would be\n\n if (shutdown_request \u0026 VB_SHUTDOWN...) {\n   shutdown_request \u0026\u003d ~VB_SHUTDOWN...;\n   if (power_button_state \u003d\u003d POWER_BUTTON_RELEASED)\n     power_button_state \u003d POWER_BUTTON_PRESSED;\n } else {\n   if (power_button_state \u003d\u003d POWER_BUTTON_HELD_SINCE_BOOT)\n     shutdown_request \u0026\u003d ~VB_SHUTDOWN...; // first release, so don\u0027t shut down here\n   power_button_state \u003d POWER_BUTTON_RELEASED;\n }",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6e9095b8_3b7c909f",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 66,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:09:32Z",
      "side": 1,
      "message": "edit: Should\u0027ve re-read this before sending comments. Should be\n\n if (shutdown_request \u0026 VB_SHUTDOWN...) {\n   shutdown_request \u0026\u003d ~VB_SHUTDOWN...;\n   if (power_button_state \u003d\u003d POWER_BUTTON_RELEASED)\n     power_button_state \u003d POWER_BUTTON_PRESSED;\n } else {\n   if (power_button_state \u003d\u003d POWER_BUTTON_PRESSED)\n     shutdown_request |\u003d VB_SHUTDOWN...; // trigger shutdown now, after press and then release\n   power_button_state \u003d POWER_BUTTON_RELEASED;\n }",
      "parentUuid": "05e2317b_bdc487b1",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e7fcab4_6dc2755f",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 66,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-05-09T22:19:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6e9095b8_3b7c909f",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a60b5e12_1abcfc91",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 123,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:05:59Z",
      "side": 1,
      "message": "Yeah, this is terrible. Just make vb2_init_ui() non-static so the test\u0027s ResetMock() can call it directly.",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af279ad8_56c3f1ec",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 123,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-05-09T22:19:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a60b5e12_1abcfc91",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "92f5e998_6262e447",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 439,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:05:59Z",
      "side": 1,
      "message": "This can be cleaned up as well now, right? (Can be a later CL too... but we should count it when looking at which option is cleaner.)",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a79cc58c_15ae2a52",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 439,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-05-09T22:19:27Z",
      "side": 1,
      "message": "The removal is handled by crrev.com/c/1534621 , which is still pending on the next cr50 release.",
      "parentUuid": "92f5e998_6262e447",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8bc2f7f1_8bc296e9",
        "filename": "tests/vboot_api_kernel2_tests.c",
        "patchSetId": 4
      },
      "lineNbr": 320,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:05:59Z",
      "side": 1,
      "message": "I think this is missing gpio[0].count? Maybe factor this out into a MockGpioAfter(ticks, gpio_type) helper?",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a6c77c5e_6db0137c",
        "filename": "tests/vboot_api_kernel2_tests.c",
        "patchSetId": 4
      },
      "lineNbr": 320,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-05-09T22:19:27Z",
      "side": 1,
      "message": "The # of events reported is \".count + 1\", so leaving .count as zero means that it\u0027ll get used once (rather than zero times).  When mocked functions use mock_gpio[] they always use mock_gpio[mock_gpio_count].gpio_flags and then either decrements .count (if it\u0027s positive) or increments mock_gpio_count (if it\u0027s already zero).  This approach seemed straightforward and avoided the need for callers to set .count \u003d 1 (I\u0027ve removed some instances of \".count \u003d 1\" that I unnecessarily added).  I\u0027ve added a MockGpioAfter().",
      "parentUuid": "8bc2f7f1_8bc296e9",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "47ce1f16_17195a8c",
        "filename": "tests/vboot_api_kernel2_tests.c",
        "patchSetId": 4
      },
      "lineNbr": 491,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:05:59Z",
      "side": 1,
      "message": "nit: Should be 100 or ~0 or something",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b526d3a8_7077ba7a",
        "filename": "tests/vboot_api_kernel2_tests.c",
        "patchSetId": 4
      },
      "lineNbr": 491,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-05-09T22:19:27Z",
      "side": 1,
      "message": "Given the prior comment \u0026 update I just deleted the line, since there\u0027s no need to set .count to zero and leaving count as zero will cause GPIO_SHUTDOWN to be indicated once.\n\nI originally used \"\u003d ~0\" in most of the places that now use \"\u003d 100\", but this caused some tests to slow down too much -- shutdown is now only recognized on a release, so ~0 means the test has to run through ~2^32 loops before the held power button gets released.",
      "parentUuid": "47ce1f16_17195a8c",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "366edc16_1d026bb0",
        "filename": "tests/vboot_api_kernel2_tests.c",
        "patchSetId": 4
      },
      "lineNbr": 491,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-10T22:16:50Z",
      "side": 1,
      "message": "Oh, I forgot about the release part. Good point.",
      "parentUuid": "b526d3a8_7077ba7a",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ccd29d08_2e4670b9",
        "filename": "tests/vboot_api_kernel2_tests.c",
        "patchSetId": 4
      },
      "lineNbr": 1254,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-05-06T23:05:59Z",
      "side": 1,
      "message": "Not sure if 3, 4 and 5 are worth testing, because in practice it shouldn\u0027t be possible for a user to time it such that they stop pressing a button at the exact moment where they begin pressing another, and if they do I\u0027d be okay with either result. (We should test for the policy we care about, not for how our current implementation behaves in every possible case.)",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9ee4bb8a_72cabe5b",
        "filename": "tests/vboot_api_kernel2_tests.c",
        "patchSetId": 4
      },
      "lineNbr": 1254,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-05-09T22:19:27Z",
      "side": 1,
      "message": "Some of these cases mattered more in the earlier implementation where responses got deferred.  Not I suppose that 3 and 4 help to confirm they behave the same as 1 and 2 (i.e., once a button is released any subsequent button presses should be ignored).  I think I can delete #5 and the other cases that are merely a \"s\" variation of another case that has \"sss\".",
      "parentUuid": "ccd29d08_2e4670b9",
      "revId": "4964b4aafb20c138ff3ce4af9f86277df709c36a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}