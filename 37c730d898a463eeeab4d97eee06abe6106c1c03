{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "20688aa3_9f55ab0b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-03-19T01:12:52Z",
      "side": 1,
      "message": "Honestly, I have no idea what you\u0027ve tried to do here. You were already sourcing the key_config.sh file, so doesn\u0027t that mean that it was already executing in the same shell to begin with? Does BASH_ENV even run on source (I thought it only runs when a new shell is created)?\n\nI\u0027m not a shell expert by any means but I hope you ran this by one, because it looks very strange to me.",
      "revId": "37c730d898a463eeeab4d97eee06abe6106c1c03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37dbbcce_f48dd54d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2024-03-19T02:10:00Z",
      "side": 1,
      "message": "yeah it doesn\u0027t seem like setting BASH_ENV is necessary here.  the vars that are active in the current scope are available to the sourced script.\n\nalso, does this work ?  I thought `\u003c(...)` would close once the statement finishes.\n\n```\n$ (foo\u003d\u003c(echo hi); cat $foo)\ncat: /dev/fd/63: No such file or directory\n```\n\nalso, I thought BASH_ENV was for executing a shell script, not sourcing it.  a quick test over here suggests that\u0027s how it behaves, and that\u0027s what the man page says.",
      "parentUuid": "20688aa3_9f55ab0b",
      "revId": "37c730d898a463eeeab4d97eee06abe6106c1c03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "deb7f1dc_a5d12692",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-03-19T02:54:20Z",
      "side": 1,
      "message": "I did test this and it worked:\n\nBefore - http://screen/BxeVtCTHhz6cF8d\n\nAfter - http://screen/4vc5Sc5KF5dyXN2\n\nI\u0027m open to any suggestions, I\u0027m not a bash expert at all, just going off this stack overflow answer - https://stackoverflow.com/a/21941473",
      "parentUuid": "37dbbcce_f48dd54d",
      "revId": "37c730d898a463eeeab4d97eee06abe6106c1c03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e63cd6e_01b3ecab",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-03-19T22:19:13Z",
      "side": 1,
      "message": "Are you sure that moving the `declare -a` outside of the function in line 7 wasn\u0027t already all the fix you need, and the `BASH_ENV` stuff down here is superfluous?",
      "parentUuid": "deb7f1dc_a5d12692",
      "revId": "37c730d898a463eeeab4d97eee06abe6106c1c03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0c0c505_bddb822f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2024-05-09T17:57:57Z",
      "side": 1,
      "message": "that SO question is about exporting arrays into the env for executing a new program.  sourcing a script (i.e. the `.` command) is not executing a new program, it\u0027s loading source directly into the current execution context.\n\nare you sure you tested your changes correctly ?  if i login to chromeos-signing.cbf, the example you showed works just fine w/out BASH_ENV.\n\n```\n# cd /cros/vboot_reference/\n# git diff\n--- a/scripts/image_signing/lib/keycfg.sh\n+++ b/scripts/image_signing/lib/keycfg.sh\n@@ -66,8 +66,6 @@ setup_keycfg() {\n   export KEYCFG_KEY_DIR\u003d\"${key_dir}\"\n   if [ -f \"${key_dir}/key_config.sh\" ]; then\n     # Use process substitution to pass in the array to the key_config.sh file.\n-    BASH_ENV\u003d\u003c(declare -p KEYCFG_ROOT_KEY_VBPUBK_LOEM \\\n-      KEYCFG_FIRMWARE_VBPRIVK_LOEM KEYCFG_FIRMWARE_KEYBLOCK_LOEM) \\\n       . \"${key_dir}/key_config.sh\"\n   fi\n }\n\n# (source scripts/image_signing/lib/keycfg.sh\n   setup_keycfg /cros/keys/AmbassadorMPKeys-v8\n   get_firmware_vbprivk 2)\n/cros/keys/AmbassadorMPKeys-v8/firmware_data_key.loem2.vbprivk\n```",
      "parentUuid": "deb7f1dc_a5d12692",
      "revId": "37c730d898a463eeeab4d97eee06abe6106c1c03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "296967a8_8dc83159",
        "filename": "scripts/image_signing/lib/keycfg.sh",
        "patchSetId": 2
      },
      "lineNbr": 70,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-03-19T01:12:52Z",
      "side": 1,
      "message": "You fixed the typo below but these still all say \"FIRMARE\"",
      "range": {
        "startLine": 70,
        "startChar": 15,
        "endLine": 70,
        "endChar": 17
      },
      "revId": "37c730d898a463eeeab4d97eee06abe6106c1c03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a9a9aaf_73b17b3d",
        "filename": "scripts/image_signing/lib/keycfg.sh",
        "patchSetId": 2
      },
      "lineNbr": 70,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-03-19T02:54:20Z",
      "side": 1,
      "message": "ugh - thanks for pointing this out. https://chromium-review.googlesource.com/c/chromiumos/platform/vboot_reference/+/5379740",
      "parentUuid": "296967a8_8dc83159",
      "range": {
        "startLine": 70,
        "startChar": 15,
        "endLine": 70,
        "endChar": 17
      },
      "revId": "37c730d898a463eeeab4d97eee06abe6106c1c03",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}