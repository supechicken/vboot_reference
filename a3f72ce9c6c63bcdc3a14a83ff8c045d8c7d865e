{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "72f23994_72a3718d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 3487009
      },
      "writtenOn": "2025-11-13T11:46:34Z",
      "side": 1,
      "message": "Automatically set CQ+1 by AutoRunner. See go/chromeos-cqw:auto-runner-doc for details. \nReport Bugs/Feedback: go/cros-auto-runner-bug. \n",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b57815b_f03eef12",
        "filename": "tests/libavb.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-14T01:07:50Z",
      "side": 1,
      "message": "Why can we not test with the real `libavb.h` from the AVB repo? If it is reachable for building fwlib, shouldn\u0027t it also be reachable for tests?",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f034e4c_15b49ee7",
        "filename": "tests/libavb.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-11-14T09:29:27Z",
      "side": 1,
      "message": "fwlib does not contain AVB. AVB and vboot are built and linked together via libpayload ebuild. I could refer to the headers file in AVB repo, but don\u0027t want to do that for unit tests, it just makes no sense. I have creation of separate ebuild for libavb on my TODO list, so maybe it simplify the makefile.",
      "parentUuid": "3b57815b_f03eef12",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cb883baf_715a67d4",
        "filename": "tests/libavb.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-11-17T03:04:08Z",
      "side": 1,
      "message": "\u003e but don\u0027t want to do that for unit tests, it just makes no sense\n\nWhy? With your approach now we have duplicate libavb.h code. Can we pass the `LIBAVB_SRCDIR` from vboot_reference ebuild, and then in Makefile we can add `-I$(LIBAVB_SRCDIR)`. This is also the approach we\u0027ve been using for depthcharge unit testing (with libpayload dependency).",
      "parentUuid": "3f034e4c_15b49ee7",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c90900b2_4cfe1890",
        "filename": "tests/libavb.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-11-17T16:20:59Z",
      "side": 1,
      "message": "Actually LIBAVB_SRCDIR is passed by libpayload ebuild, but I think I can just change the default value from vboot Makefile. But AVB is built only if USE_AVB is set. Do you want me to add `vb2_avb_test` under `ifneq ($(filter-out 0,${USE_AVB}),)` in the same way as `vb2_host_flashrom_tests` is  build only for USE_FLASHROM?",
      "parentUuid": "cb883baf_715a67d4",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2388c01_a909933d",
        "filename": "tests/libavb.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-11-18T06:48:01Z",
      "side": 1,
      "message": "\u003e add `vb2_avb_test` under `ifneq ($(filter-out 0,${USE_AVB}),)`\n\nYes, I think that\u0027s the way to go. `vb2_host_flashrom_tests` is guarded by `USE_FLASHROM` just in order to support the use case (outside ChromeOS) where libflashrom is unavailable. Therefore, as the new test also depends on another repo, we should use `USE_AVB` similarly.\n\nNote that you\u0027ll need to pass both `LIBAVB_SRCDIR` and `USE_AVB` from vboot_reference ebuild to Makefile. You\u0027ll also need to add the avb repo to `CROS_WORKON_DESTDIR`. The libpayload ebuild is irrelevant to vboot tests.",
      "parentUuid": "c90900b2_4cfe1890",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be23aca3_75f43cbb",
        "filename": "tests/libavb.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-21T01:15:35Z",
      "side": 1,
      "message": "\u003e AVB and vboot are built and linked together via libpayload ebuild.\n\nWhy is that, actually? Is there a good reason for that? AVB is only referenced from within vboot as far as I\u0027m aware(?), I think it would make a lot more sense to pull in the AVB sources from the vboot ebuild, build it into fwlib, and then pull that into libpayload. There\u0027s no penalty for nesting libraries multiple levels deep, but   it would make more organizational sense in this case, I think.\n\n\u003e I could refer to the headers file in AVB repo, but don\u0027t want to do that for unit tests, it just makes no sense\n\nIt makes a lot more sense than copy\u0026pasting code to me tbh. That should generally be the last resort.",
      "parentUuid": "c2388c01_a909933d",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21deb5f3_cb396df9",
        "filename": "tests/libavb.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-11-21T03:28:45Z",
      "side": 1,
      "message": "\u003e pull in the AVB sources from the vboot ebuild, build it into fwlib, and then pull that into libpayload\n\n+1",
      "parentUuid": "be23aca3_75f43cbb",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "508ec399_bfcad001",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 69,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-14T01:07:50Z",
      "side": 1,
      "message": "nit: When braces are on one side of the if they should also be on the other.",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "45006e7a_b16fb5f2",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 69,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-11-14T09:29:27Z",
      "side": 1,
      "message": "I removed this code, but it kind of sucks when using .clang-format generates code which gets code style comments.",
      "parentUuid": "508ec399_bfcad001",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "479ba014_b3069062",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 69,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-21T01:15:35Z",
      "side": 1,
      "message": "I think the `.clang-format` file was once put as a best effort there by someone who wanted it. It\u0027s not authoritative and we do not maintain it. Feel free to fix it if you want.",
      "parentUuid": "45006e7a_b16fb5f2",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7d6afc9e_35063645",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 105,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-14T01:07:50Z",
      "side": 1,
      "message": "Don\u0027t really like having all this stuff in a test file here tbh. It would be nicer if we could generate the corresponding AVB version to our test keys with a known-good utility and then just store it next to the ChromeOS and PEM versions in the testkeys directory. Can\u0027t you just use avbtool.py to create vbmeta partitions with those .pem keys, extract the AVB key part from each and store those as files there? (Maybe put the commands used to do that in a comment here so that they\u0027re reproducible if needed.)",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "76bde98d_086347f6",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 105,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-11-14T09:29:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7d6afc9e_35063645",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0f49518_ada6068f",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 158,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-14T01:07:50Z",
      "side": 1,
      "message": "What is this needed for here?",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "96abda04_a99467fd",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 158,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-11-14T09:29:27Z",
      "side": 1,
      "message": "It is required for load_parition() from vboot_avb_ops. I moved it to firmware/stub/vboot_api_stub_stream.c though.",
      "parentUuid": "f0f49518_ada6068f",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f919fd88_67695e54",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-14T01:07:50Z",
      "side": 1,
      "message": "nit: Would be preferable if we could link in and use the actual AVB version rather than copy\u0026paste.",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae3de042_84390a80",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-11-14T09:29:27Z",
      "side": 1,
      "message": "As I said in a previous comment, avb is not a part of vboot, it is a separate library. I think mocking AVB function for vboot tests is justified, we do the same for vboot callback from depthcharge.",
      "parentUuid": "f919fd88_67695e54",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9162794_3f089542",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-11-17T03:04:08Z",
      "side": 1,
      "message": "I think the answer depends on what exactly we want to check in this test. In this case, we are not testing how `validate_vbmeta_public_key` interacts with `avb_rsa_public_key_header_validate_and_byteswap`. Instead, we are testing \"vboot+libavb\" as a whole. Therefore, I agree we should use the actual `avb_rsa_public_key_header_validate_and_byteswap` implementation.",
      "parentUuid": "ae3de042_84390a80",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "989d0153_9a3885f7",
        "filename": "tests/vb2_avb_tests.c",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-11-21T01:15:35Z",
      "side": 1,
      "message": "I don\u0027t see a point in enforcing a separation here. Mistakes creep in at the boundaries between components, it\u0027s actually better to test several things at once as long as the scope of the test doesn\u0027t grow too far because of that (which I think we can assume here because we take AVB as already \"known good\" because of its own tests, so even when pulling in the whole library the only thing that should make tests fail is the interaction with vboot which is the part we want to test).",
      "parentUuid": "e9162794_3f089542",
      "revId": "a3f72ce9c6c63bcdc3a14a83ff8c045d8c7d865e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}