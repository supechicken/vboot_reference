{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d143fc9f_bee99ac3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1314079
      },
      "writtenOn": "2021-12-22T04:11:01Z",
      "side": 1,
      "message": "Thanks for the review Hung-Te.",
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fa8992cb_0a3cbca0",
        "filename": "futility/cmd_update.c",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2021-12-22T03:04:35Z",
      "side": 1,
      "message": "can we call this USE_LIBFLASHROM?\n\nIt\u0027s confusing because we do use flashrom, no matter via lib or external programs.\n\nIn fact, I wonder if you can support both - when libflashrom is linked, do that internally; and if not, call the external flashrom. That would be even better (and yes, that implies moving lots of code back... but I think that would be a good idea?)",
      "range": {
        "startLine": 16,
        "startChar": 7,
        "endLine": 16,
        "endChar": 19
      },
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54359c53_e54ab1c1",
        "filename": "futility/cmd_update.c",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1314079
      },
      "writtenOn": "2021-12-22T04:11:01Z",
      "side": 1,
      "message": "Happy to rename to USE_LIBFLASHROM. I called it this because there is existing subprocess still remaining due to the various code duplications in vboot_ref I am working though to consolidate.\n\nI definitely think this is a very bad idea. I am happy to GVC to explain why in depth but the short version is two fold:\n\n1) maintaining two paths is problematic to say the least (in fact vboot_ref has three paths to flashrom implemented), I would like to see this reduced down to one that is comprehensible and thus well tested with good coverage.\n\n2) the loose coupling of cli subprocess has been exceedingly fragile, linking libflashrom has already exposed bugs because of the tighter coupling inherent in linking over spawning.\n\nSuppose for a second we were to have a fallback to cli, what would that gain us? My reasoning is, because if libflashrom doesn\u0027t exist on the system it means flashrom doesn\u0027t exist. So in truth you are simply falling back to a decoupled path that fails at runtime in odd ways than failing at build time in obvious ways. In fact the flashrom cli is largely just another user of libflashrom.",
      "parentUuid": "fa8992cb_0a3cbca0",
      "range": {
        "startLine": 16,
        "startChar": 7,
        "endLine": 16,
        "endChar": 19
      },
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7ceab5d2_90c45773",
        "filename": "futility/cmd_update.c",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2021-12-22T05:31:08Z",
      "side": 1,
      "message": "\u003e Suppose for a second we were to have a fallback to cli, what would that gain us?\n\nActually that\u0027s not my primary goal. Instead I want \u0027update\u0027 command to be always available - that people can do testing and emulation.\n\n\u003e My reasoning is, because if libflashrom doesn\u0027t exist on the system it means flashrom doesn\u0027t exist. \n\nConsidering Linux packaging systems, the distro may by default disable USE_FLASHROM so the vboot can be easily installed (less dependency); and if we support executing external flashrom, developers can still use futility updater after they install manually flashrom (that\u0027s what I did outside chroot), without re-compiling futility.\n\n\u003e In fact the flashrom cli is largely just another user of libflashrom.\n\nI was hoping we can make a simple wrapper so the updater doesn\u0027t need to worry if the underlying is libflashrom or real flashrom. But if that\u0027s a huge effort then I\u0027d agree with your current implementation until we see some critical scenarios that need \u0027update\u0027 to run with external flashrom.",
      "parentUuid": "54359c53_e54ab1c1",
      "range": {
        "startLine": 16,
        "startChar": 7,
        "endLine": 16,
        "endChar": 19
      },
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a7ac81fc_a2302466",
        "filename": "futility/cmd_update.c",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1314079
      },
      "writtenOn": "2021-12-22T23:48:17Z",
      "side": 1,
      "message": "I think everything you are asking for here can be achieved and nothing is in conflict so far. I will of course touch base with you perhaps after Christmas so we can discuss more and ensure we are absolutely aligned. Thank you for your thoughts.\n\nThe quick version here is that; cutting down the multiple flashrom subprocess logic down to one canonical path that calls into libflashrom will allow us to do the following:\n\n * Single knowable interface boundary to target testing for coverage,\n * Be able to mock with a libflashrom implementation with much better coupling of cyclomatic complexity of the test coverage,\n * Be possible to have a libflashrom that _could_ conceivably call the cli (if demanded),\n * Mild modification needed to have the libflashrom DSO as runtime loadable so the functionality turns on if flashrom was installed after the fact as you alluded to above.\n \nOf course there is a plethora of other benefits that the modularity brings along however i\u0027ll leave it to the above short list just to note that I went though a fair amount of reasonable thought already on what lies ahead however we will surely discuss more.",
      "parentUuid": "7ceab5d2_90c45773",
      "range": {
        "startLine": 16,
        "startChar": 7,
        "endLine": 16,
        "endChar": 19
      },
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5ab65aac_54447835",
        "filename": "futility/flashrom_drv.c",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2021-12-22T03:04:35Z",
      "side": 1,
      "message": "can you clarify why renaming this is required? is it related to futility without flashrom? maybe we should move this to another change?",
      "range": {
        "startLine": 169,
        "startChar": 14,
        "endLine": 169,
        "endChar": 29
      },
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be5543ae_d8eb32f0",
        "filename": "futility/flashrom_drv.c",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1314079
      },
      "writtenOn": "2021-12-22T04:11:01Z",
      "side": 1,
      "message": "I can move that down to the previous change. The reason being this method requires flashrom to perform the task and is scoped to the flashrom drv namespace.",
      "parentUuid": "5ab65aac_54447835",
      "range": {
        "startLine": 169,
        "startChar": 14,
        "endLine": 169,
        "endChar": 29
      },
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "73edcfb6_438ed22f",
        "filename": "futility/flashrom_drv.c",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1314079
      },
      "writtenOn": "2021-12-22T04:17:05Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "be5543ae_d8eb32f0",
      "range": {
        "startLine": 169,
        "startChar": 14,
        "endLine": 169,
        "endChar": 29
      },
      "revId": "0ee76c99a324eff11d5b53b2d6235993b8b8ec47",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}