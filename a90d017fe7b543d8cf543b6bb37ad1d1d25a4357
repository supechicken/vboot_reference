{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "641ba301_af8748f3",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 897,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-13T13:35:15Z",
      "side": 1,
      "message": "if the partition doesn\u0027t exist, the function should return too.  otherwise it spits a bunch of errors as it tries to run on a missing dev node.",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4a8991bf_dec7ffa5",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 897,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-14T20:01:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "641ba301_af8748f3",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81d3d149_440243e8",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 904,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-13T13:35:15Z",
      "side": 1,
      "message": "should hoist this up a bit.  at least to the top of this func if not the file.  and use MINIOS_KERNEL_GUID to indicate it\u0027s a constant.",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d50f0a13_bb512286",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 904,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-14T20:01:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "81d3d149_440243e8",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fbb6a000_de5b0350",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 909,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-07-07T22:49:13Z",
      "side": 1,
      "message": "Can we take the size check out now that it\u0027s a separate GUID?",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5c46da24_8ecf8bf3",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 909,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-14T20:01:25Z",
      "side": 1,
      "message": "I don\u0027t think so -- like I mentioned in the other comment thread, recovery/installer images still use the same GUID for partition 10, but change the size to 2 MB and don\u0027t put a kernel in there.",
      "parentUuid": "fbb6a000_de5b0350",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8937989e_ff37e534",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 909,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-07-14T21:04:00Z",
      "side": 1,
      "message": "Hmmm... can\u0027t we change that? If the disk_layout.json overrides \"size\" of a partition for special images, it could also override \"type\". I feel like using the GPT tag as source of truth for what\u0027s supposed to be in there would be a lot cleaner than just size heuristics.",
      "parentUuid": "5c46da24_8ecf8bf3",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "834dc829_cd21b761",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 909,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-14T23:49:04Z",
      "side": 1,
      "message": "i\u0027m on the fence about clearing the type.  but i agree a size check is just leaving a landmine for us in the future.\n\nwon\u0027t there be a magic string in the start of the partition to indicate it\u0027s valid ?  we could read the first 8 bytes and if they\u0027re all NUL, then issue a warning, and skip it.",
      "parentUuid": "8937989e_ff37e534",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a34957d2_87fd02aa",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 909,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-15T05:33:58Z",
      "side": 1,
      "message": "\u003e won\u0027t there be a magic string in the start of the partition to indicate it\u0027s valid ?\n\nYes, there will be a VB2_KEYBLOCK_MAGIC.  But that only seems slightly better than just running `futility vbutil_kernel` and silently ignoring failures?\n\nPerhaps I\u0027ll just go with Julius\u0027 approach of overriding the \"type\", using the \"reserved\" value for unused MINIOS-B partitions.  (Although that begs the question, why do we even need them at all?)  See CL:3027786.  Does that work?\n\n(I\u0027d change the other unused partitions to \"reserved\" as well, but that would probably require double-checking that it won\u0027t adversely affect any other code, and that\u0027s not a rabbit hole I particularly want to go down at the moment.)",
      "parentUuid": "834dc829_cd21b761",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37b48eb1_ae67c7a5",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 909,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-15T17:19:31Z",
      "side": 1,
      "message": "\u003e But that only seems slightly better than just running `futility vbutil_kernel` and silently ignoring failures\n\nimo checking for zeros is significantly better than ignoring vbutil_kernel failures as that will ignore failures on partitions populated with real data\n\nbut if you just want to go the type route, i\u0027m fine with that",
      "parentUuid": "a34957d2_87fd02aa",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3eb221ca_ee8e0975",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 909,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-07-15T20:48:15Z",
      "side": 1,
      "message": "I think the point is that we *want* to check the magic, and error our if the partition wasn\u0027t intialized correctly by whatever built the image. So yeah, I think using the type to signal intent here is the right approach, and then vbutil_kernel can throw a proper error if that intent doesn\u0027t match reality.",
      "parentUuid": "37b48eb1_ae67c7a5",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7962d9a_fa7ab1f7",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 914,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-13T13:35:15Z",
      "side": 1,
      "message": "since this is a new thing, should add an explicit check for the key existing, and if it\u0027s missing, log that as an error \u0026 return quickly.\n\nexperience has shown that people triaging error logs get confused quickly unless it\u0027s spelled out explicitly.",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8695bba9_7eb05956",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 914,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-14T20:01:25Z",
      "side": 1,
      "message": "Added checks at the top of function for both keyblock and private key.",
      "parentUuid": "e7962d9a_fa7ab1f7",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "402c78af_14476691",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-13T13:35:15Z",
      "side": 1,
      "message": "will it ?  `error` only echos a message, it doesn\u0027t abort anything.  you need to `return 1`, and the caller needs to check it too.",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1bb0618_abbd4abc",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-14T20:01:25Z",
      "side": 1,
      "message": "Added the \"return 1\".  The script seems to already end with failure without the caller checking though?",
      "parentUuid": "402c78af_14476691",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e3a23fd_1ce7be39",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-07-15T20:48:15Z",
      "side": 1,
      "message": "Doesn\u0027t `set -e` count here? So I don\u0027t think you need to return (and the caller doesn\u0027t check any return code anyway, other than again implicitly through `set -e`), but Mike would know better.",
      "parentUuid": "b1bb0618_abbd4abc",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64d7cbf9_63f162bc",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-15T21:19:49Z",
      "side": 1,
      "message": "we don\u0027t want to rely on `set -e` behavior.  it often behaves in ways you don\u0027t expect.\nhttps://mywiki.wooledge.org/BashFAQ/105",
      "parentUuid": "8e3a23fd_1ce7be39",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a45f5ef2_c017de80",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-07-15T22:04:29Z",
      "side": 1,
      "message": "Okay, fair enough, but most of this script doesn\u0027t do error propagation beyond `set -e`, it would be a lot more work to fix it all. For now we can have the explicit check here and in sign_image_file(), I guess, but everything else seems beyond the scope of this patch.",
      "parentUuid": "64d7cbf9_63f162bc",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "791da6ec_879d51e0",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2021-07-16T00:08:26Z",
      "side": 1,
      "message": "i\u0027m not suggesting we change the rest of the script here.  the new code Joel has written should not assume `set -e` behavior.",
      "parentUuid": "a45f5ef2_c017de80",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50357c5d_b9b560f5",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 7
      },
      "lineNbr": 916,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-07-16T16:56:14Z",
      "side": 1,
      "message": "Okay -- I added a check in sign_image_file when calling resign_minios_kernels.",
      "parentUuid": "791da6ec_879d51e0",
      "revId": "a90d017fe7b543d8cf543b6bb37ad1d1d25a4357",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}