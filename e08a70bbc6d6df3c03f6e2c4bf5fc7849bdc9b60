{
  "comments": [
    {
      "key": {
        "uuid": "d859fbe3_acfda736",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 21,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "This patch needs plenty of unit tests.",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "359044a6_07a4fd52",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 21,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "The tests are on my to-do list, but I first focused on getting the implementation a bit jelled first so I didn\u0027t write tests for irrelevant code.  This feature depends on the power button, and looks like the FAFT doc for Wilco doesn\u0027t have an answer yet for how to handle that button (it merely identifies it as an issue).",
      "parentUuid": "d859fbe3_acfda736",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "60be2181_8c65c0b3",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 4
      },
      "lineNbr": 195,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Can this be a compile-time flag (similar to https://chromium-review.googlesource.com/c/chromiumos/platform/depthcharge/+/1466822/12/src/vboot/Makefile.inc) instead?",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ae85e189_c344aa85",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 4
      },
      "lineNbr": 195,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "My interpretation of the design doc was that depthcharge should have a config option that controls a bit that vboot looks at.  I think I had asked Simon about making the behavior a compile-flag that controlled the presence/absence of the feature but I think he wanted it this way so the functionality could be more readily used/tested on other boards too.",
      "parentUuid": "60be2181_8c65c0b3",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c871eb2b_b4a0980c",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 4
      },
      "lineNbr": 195,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-16T00:10:01Z",
      "side": 1,
      "message": "I think generally it\u0027s always better to compile out these board-specific features to save code size (and therefore boot time) on platforms that don\u0027t need it. The same is being done for the comparable feature of adding service tags (see CL:1466822).",
      "parentUuid": "ae85e189_c344aa85",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "33988cb0_30d898c7",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 4
      },
      "lineNbr": 195,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "I\u0027ve gotten rid of the flag though I haven\u0027t yet switched the functionality to compile-time (but I\u0027ll try to address this in the next draft since Simon seems to be warming up to the approach).",
      "parentUuid": "c871eb2b_b4a0980c",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4e4f4335_20ce847b",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 4
      },
      "lineNbr": 200,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "I\u0027m confused, what do you need these for? It\u0027s triggered by an NVRAM flag, so can\u0027t vboot kernel verification just read that on its own and immediately act on it? Why does this need to be in the context?",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c652fb47_ad036fe0",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 4
      },
      "lineNbr": 200,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "I think you\u0027re right that it can be removed since the set and read are within the same function. It\u0027s something I planned to do as long as no other uses cropped up.  I took me a bit of time to wrap my head around the various shared regions/contents and how/when (\u0026 with what they\u0027re shared).",
      "parentUuid": "4e4f4335_20ce847b",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3dfaa48_00c3b063",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 4
      },
      "lineNbr": 200,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c652fb47_ad036fe0",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3cdae2d1_30d100a5",
        "filename": "firmware/include/vboot_struct.h",
        "patchSetId": 4
      },
      "lineNbr": 260,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Again not sure why this is needed.",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b199c3e6_48f7150d",
        "filename": "firmware/include/vboot_struct.h",
        "patchSetId": 4
      },
      "lineNbr": 260,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "This is from the spec (or at least my interpretation of it) defining that depthcharge set a bit that\u0027s checked by vboot (vs. affecting whether the feature is included in the compilation).",
      "parentUuid": "3cdae2d1_30d100a5",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0f71fcf7_b63b2f8c",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 443,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Could just do the NVRAM check right here, then wouldn\u0027t need to have an extra context flag.",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "75f6dae6_da85473e",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 443,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0f71fcf7_b63b2f8c",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "36df4759_157170e2",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 453,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Is the goal booting normally when the user presses Esc or lets the timeout run out? Is that really the behavior that we want? I think shutting down would make more sense (from the user\u0027s perspective they had just been in recovery mode and pressed Ctrl+C, it\u0027s not necessarily apparent that the machine rebooted into \"normal\" mode for them, I think doing a normal boot at that point would be unexpected).",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f8ccfa2d_27363af8",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 453,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "I don\u0027t think the doc exactly specified how to opt-out of the confirmation nor what to do if the running isn\u0027t confirmed.  I didn\u0027t see much point in doing yet another reboot (we\u0027ve just done one) so I\u0027ve opted to have the boot continue as it normally would (as if Ctrl-C hadn\u0027t been pressed).",
      "parentUuid": "36df4759_157170e2",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "659368b5_b7c2a97b",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 456,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Why is this indented? Just have four\n\n if (...) {\n   ...\n } else if (...) {\n   ...\n } else if (...) {\n   ...\n } else {\n   ...\n }\n\nat the same rank.",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a75eaa90_f5138b32",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 456,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "If I understand you\u0027re comment, the layout is a consequence of having a non-confirmation of the rom resume with normal execution, whether it be dev mode and normal boot.  The other approaches I considered involved duplicating code content, and I was hesitant to do yet another reboot just for the sake of keeping the code delta smaller.",
      "parentUuid": "659368b5_b7c2a97b",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d883de39_b33ca2d1",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 4
      },
      "lineNbr": 456,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-16T00:10:01Z",
      "side": 1,
      "message": "Since this is not at all a critical path anyway I think cleaner code might be worth more than avoiding another reboot. But really, I think it would be better to shut down anyway (took that discussion back to the design doc).",
      "parentUuid": "a75eaa90_f5138b32",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3099e596_c683a936",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 230,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Why do you need two physical presence checks? That was not in the design doc. One should be enough... the NVRAM flag cannot be trusted anyway, so checking in recovery mode is useless. Just reboot immediately when someone presses Ctrl+C.",
      "range": {
        "startLine": 230,
        "startChar": 3,
        "endLine": 230,
        "endChar": 58
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f0ace24_0dbc4216",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 230,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "The spec seemed to describe two confirmations, one after the Ctrl-C and another after the reboot.  Both confirms seem like overkill (though I\u0027d like to pick a different key that\u0027s farther away from Ctrl-D to minimize issues from accidental presses from bad aim), and I didn\u0027t see a precise description of how to confirm the Ctrl-C.  I originally had two different screens for the confirms, but it seemed to add complexity and space when the same screen could be used for both.  This means that the power key is used for both, which is less effort for the year (vs. using two different keys for confirm), though might confuse the user because it\u0027s no so clear they need to eventually press a 2nd time (it\u0027s more clear with a dev firmware that take several seconds to reboot, but I don\u0027t know how quickly a release firmware can reboot on Wilco).",
      "parentUuid": "3099e596_c683a936",
      "range": {
        "startLine": 230,
        "startChar": 3,
        "endLine": 230,
        "endChar": 58
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db633988_48b70cd7",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 230,
      "author": {
        "id": 1000423
      },
      "writtenOn": "2019-02-15T01:39:48Z",
      "side": 1,
      "message": "We want at least one physical presence check before launching, similar to how we expect one before confirming developer mode entry.\n\nI think the one that matters more is the one after the reboot since we\u0027re coming up after a reset and we don\u0027t want it to be triggered remotely just by setting VB2_NV_DIAG_REQUEST.\n\nI suppose the check at the recovery screen before the reboot is to give the user a chance to press ESC and abort?\n\nIt does seem cumbersome...  Could we have a timeout \"Preparing diagnostics, press ESC to cancel...\" and then reboot in a few seconds?  That can make it harder to test since it is timing based..",
      "parentUuid": "2f0ace24_0dbc4216",
      "range": {
        "startLine": 230,
        "startChar": 3,
        "endLine": 230,
        "endChar": 58
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e24b0402_f3f2c250",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 230,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-16T00:10:01Z",
      "side": 1,
      "message": "I don\u0027t really see a need to give the user two chances to abort (before and after the reboot). In practice, I assume the reboot is only going to be a screen flicker for 1-2 seconds anyway, it\u0027s not a big deal from the user\u0027s perspective.",
      "parentUuid": "db633988_48b70cd7",
      "range": {
        "startLine": 230,
        "startChar": 3,
        "endLine": 230,
        "endChar": 58
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0cf660b1_1a8eafbe",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 268,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Are you trying to check for release here? Because then you need to check \u0026\u0026 !power_pressed as well.",
      "range": {
        "startLine": 268,
        "startChar": 13,
        "endLine": 268,
        "endChar": 37
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a0fdfe82_c883d567",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 268,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "The !power_pressed is already implied by being an else to the earlier \"if (power_pressed)\".",
      "parentUuid": "0cf660b1_1a8eafbe",
      "range": {
        "startLine": 268,
        "startChar": 13,
        "endLine": 268,
        "endChar": 37
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "baf94143_4b31fc99",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 268,
      "author": {
        "id": 1308749
      },
      "writtenOn": "2019-02-15T17:58:26Z",
      "side": 1,
      "message": "For the Cr50 implementation of GET_PWR_BTN, I didn\u0027t anticipate vboot needing to know when the button is released.  The Cr50 latches the power button press, and the GET_PWR_BTN command clears the latched state.   So regardless of how long the user holds the power button, from vboot\u0027s perspective it will look like a quick press.",
      "parentUuid": "a0fdfe82_c883d567",
      "range": {
        "startLine": 268,
        "startChar": 13,
        "endLine": 268,
        "endChar": 37
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "20696f7a_9fc12021",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 268,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-16T00:10:01Z",
      "side": 1,
      "message": "Right, I confused myself with the logic here. Maybe this would be more easy to follow as\n\n int power_pressed \u003d VbExGetSwitches(...);\n\n if (power_pressed)\n   power_pressed_at_least_once \u003d 1;\n\n if (power_pressed_at_least_once \u0026\u0026 !power_pressed) {\n   ...\n }\n\nAs long as reading the switch clears the latch, I think this would probably be good enough. If the user keeps it pressed for 8 seconds the EC will force shutdown the system and we don\u0027t get a chance to notice the release here anymore.",
      "parentUuid": "baf94143_4b31fc99",
      "range": {
        "startLine": 268,
        "startChar": 13,
        "endLine": 268,
        "endChar": 37
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "815bc198_43c4ce14",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 273,
      "author": {
        "id": 1000423
      },
      "writtenOn": "2019-02-15T01:39:48Z",
      "side": 1,
      "message": "We might also need vb2_nv_set(ctx, VB2_NV_OPROM_NEEDED, 1); and then set it back to 0 before launching the payload in the next phase.\n\nIf we are rebooting into normal mode we would skip the GOP step and not be able to display the screen.",
      "range": {
        "startLine": 273,
        "startChar": 20,
        "endLine": 273,
        "endChar": 39
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b3d0a09f_42d0d975",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 273,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "Would this be a system-specific or generic issue?  So far things work fine as-is, at least when I test on Atlas.",
      "parentUuid": "815bc198_43c4ce14",
      "range": {
        "startLine": 273,
        "startChar": 20,
        "endLine": 273,
        "endChar": 39
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff636421_82ac0c20",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Doesn\u0027t this get called automatically when you return? Shouldn\u0027t need to do it explicitly here.",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d2ed9f5_2b4b8980",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "I\u0027d have to double-check, but in my runtime testing I saw that one of the two operations set/clear operations (probably the clear) wasn\u0027t getting committed.  I had to add a commit to one, and given that commit already has a internal check on whether to do any work it seemed safer and more consistent for me to have a commit on both given that a reboot can shortly follow either.",
      "parentUuid": "ff636421_82ac0c20",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "37966c54_071dcf84",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-16T00:10:01Z",
      "side": 1,
      "message": "No, let\u0027s not sprinkle statements around \"just in case\" that we know shouldn\u0027t be needed. The way this is designed, you should never need to commit explicitly unless you expect an asynchronous reboot (the only case I\u0027m aware of where that normally happens is on the BROKEN screen, that\u0027s why we always commit language changes immediately there).\n\nIn this case, I don\u0027t see any reason why you should be needed either one of your two vb2_nv_commit()s (because all those code paths should lead through vb2_kernel_cleanup() later). Please double-check if you actually need one of them, and if so try to figure out why.",
      "parentUuid": "2d2ed9f5_2b4b8980",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9cbbb292_8dfe3393",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 274,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "The commits that\u0027s currently needed is to clear the bit. This the path where we we subsequently run the rom and thus vb2_kernel_cleanup() doesn\u0027t get called.  Afaict this situation also applies for conventional legacy boot and doesn\u0027t seem specific to the diagnostic rom feature (other than the feature wants to make a change to nvram before running a payload).",
      "parentUuid": "37966c54_071dcf84",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17bfff26_18f045cb",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 294,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "As mentioned on the depthcharge CL, this isn\u0027t safe. You have to specially encode this case.",
      "range": {
        "startLine": 294,
        "startChar": 19,
        "endLine": 294,
        "endChar": 20
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4b8a0f05_1518d1f7",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 294,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "17bfff26_18f045cb",
      "range": {
        "startLine": 294,
        "startChar": 19,
        "endLine": 294,
        "endChar": 20
      },
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6540596f_1c2d6fe7",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 300,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "...or the TPM access might have failed",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "99698792_49db139b",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 320,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "I think it would be better to extend VbWantShutdown with another parameter (e.g. an ignore_mask or something).",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "feaa1662_da532c4b",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 320,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "I was tempted to add a parameter to VbExIsShutdownRequested so it could always consistently report the power button status, as this would\u0027ve avoided the need to add a flag to VbExGetSwitches().  I\u0027ll have to see what I can do about VbWantShutdown().  The situation is already a bit unclean in there.",
      "parentUuid": "99698792_49db139b",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "68b05631_bad6f0af",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 320,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-16T00:10:01Z",
      "side": 1,
      "message": "Returning a bit mask (instead of just 0 or 1) from VbWantShutdown() and then using that for both the power button and the shutdown check here sounds like a reasonable alternative, as long as we make sure that the result of VbWantShutdown() still also works fine when interpreted as a boolean (for the existing cases).",
      "parentUuid": "feaa1662_da532c4b",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87d50549_d410d530",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 320,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "I\u0027ve changed the function to return a bitmask so this particular code block is cleaner, though I haven\u0027t gone as far as using it as a replacement for VbExGetSwitches(). To do the latter I think I\u0027d have to start passing in a flag (and change all the callsites to pass in a value) to request consistent/reliable reporting of the power button, and it seems like some people like having a more distinct abstraction between physical presense and power button.",
      "parentUuid": "68b05631_bad6f0af",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8867da10_b528a44b",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 349,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Please don\u0027t count delay iterations... instead, get the start timestamp directly with VbExGetTimer(), and then keep calling that to compare whether 30 seconds have passed since then.",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ae77fca4_695b9eb0",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 349,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "A force of habit from trying to write kernel code that isn\u0027t susceptible to ntp changes, timezone changes, hibernate, or bad clocks that go backwards.  I suppose none of those problems apply here in firmware.",
      "parentUuid": "8867da10_b528a44b",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "24d688bb_e35e64de",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 349,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ae77fca4_695b9eb0",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e19acc70_cf966182",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 353,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Rather than tracking whether you need to do this, wouldn\u0027t it be easier to track whether you need to boot the diagnostic tool (either with an explicit variable or by just checking if result is VBERROR_SUCCESS), and then boot at the end (after you ran through all the cleanup, including the screen blanking)?",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6d57e29e_3fcfe5b7",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 353,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "Your suggestion would have the advantage that the power button is always disabled \u0026 enabled unconditionally in 1 place, so I\u0027ll give it a try.  I mostly ended up with this because runtime tested pointed out to me that I had neglected to re-enable the power button before jumping to the payload.",
      "parentUuid": "e19acc70_cf966182",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12e049b8_0564591d",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 353,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6d57e29e_3fcfe5b7",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c3b6895a_3890146a",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 753,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "nit: please write keys in hex for consistency (or write Ctrl+C as (0x1f \u0026 \u0027C\u0027) because it\u0027s easier to read).",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0945335e_bcd2a545",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 753,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c3b6895a_3890146a",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "81e1ce35_e098d7cd",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 754,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-15T00:12:04Z",
      "side": 1,
      "message": "Why not use existing \u0027retval\u0027?",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39236d22_c4d39702",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 754,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-15T01:14:40Z",
      "side": 1,
      "message": "retval isn\u0027t exactly the proper type (though I haven\u0027t looked at what VbError_t is defined as), but I can turn a blind eye to that and use retval.",
      "parentUuid": "81e1ce35_e098d7cd",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4f03b3a4_2a5a9021",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 754,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-02-16T00:10:01Z",
      "side": 1,
      "message": "Well... VbTryLoadKernel() also returns VBERROR values. I think it\u0027s accepted practice here to put VBERRORs into uint32_ts, but feel free to change the type of retval to VbError_t if you want.",
      "parentUuid": "39236d22_c4d39702",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0615452e_8032d4d7",
        "filename": "firmware/lib/vboot_ui.c",
        "patchSetId": 4
      },
      "lineNbr": 754,
      "author": {
        "id": 1276303
      },
      "writtenOn": "2019-02-19T23:01:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4f03b3a4_2a5a9021",
      "revId": "e08a70bbc6d6df3c03f6e2c4bf5fc7849bdc9b60",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}