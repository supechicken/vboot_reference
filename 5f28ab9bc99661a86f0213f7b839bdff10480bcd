{
  "comments": [
    {
      "key": {
        "uuid": "cf7e959c_15a71457",
        "filename": "host/lib/crossystem.c",
        "patchSetId": 1
      },
      "lineNbr": 616,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2016-07-26T11:59:19Z",
      "side": 1,
      "message": "I think non-cros x86 chromebooks will also fall into the case (no HWID + no devsw_boot). Do we have anything better that can explicitly know \"we are running inside VM\"?\n\nAlso, there may be proto devices that have broken devsw_boot (with on HWID provisioned).  You probably want to trust other values, for example mainfw_type \u003d\u003d nonchrome to see if we\u0027re really not on Chromebooks.",
      "range": {
        "startLine": 616,
        "startChar": 11,
        "endLine": 616,
        "endChar": 13
      },
      "revId": "5f28ab9bc99661a86f0213f7b839bdff10480bcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8fa2dd7a_03312ef2",
        "filename": "host/lib/crossystem.c",
        "patchSetId": 1
      },
      "lineNbr": 616,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2016-07-26T12:16:31Z",
      "side": 1,
      "message": "\u003e  non-cros x86 chromebooks will also fall into the case\n\nwhich is fine since they have no HWID.\n\n\u003e  there may be proto devices that have broken devsw_boot (with on HWID provisioned). \n\nthen the VbGetArchPropertyString() call above will have already answered, we wont go through this path.",
      "parentUuid": "cf7e959c_15a71457",
      "range": {
        "startLine": 616,
        "startChar": 11,
        "endLine": 616,
        "endChar": 13
      },
      "revId": "5f28ab9bc99661a86f0213f7b839bdff10480bcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf7e959c_d5a0bc3c",
        "filename": "host/lib/crossystem.c",
        "patchSetId": 1
      },
      "lineNbr": 616,
      "author": {
        "id": 1000239
      },
      "writtenOn": "2016-07-26T12:31:15Z",
      "side": 1,
      "message": "\u003e which is fine since they have no HWID.\n\nBut the HWID has \u0027VM\u0027 in it while the non-cros x86 laptops are not VMs - which may confuse, especially for ChromiumOS users.\n\nI still think it\u0027s not the best place to workaround the \"chrome init warning for VM\" in such low level system tool like crossystem by changing its behavior (returning fake HWID on particular environments).\n\nDo you think it is OK to fix that by checking more settings in where Chrome checks HWID, by commands I\u0027ve specified (checking mainfw_type)?",
      "parentUuid": "8fa2dd7a_03312ef2",
      "range": {
        "startLine": 616,
        "startChar": 11,
        "endLine": 616,
        "endChar": 13
      },
      "revId": "5f28ab9bc99661a86f0213f7b839bdff10480bcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8fa2dd7a_63afc2e6",
        "filename": "host/lib/crossystem.c",
        "patchSetId": 1
      },
      "lineNbr": 616,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2016-07-26T12:42:23Z",
      "side": 1,
      "message": "We discussed with Nicolas doing it in hwid_checker.cc / IsMachineHWIDCorrect()\nbut he mentioned that other places would benefit from a lower level stub rather than patching one by one the ussers.\n(on Chrome side, we already have AutoEnrollmentController::GetMode() doing something similar to what would need to be in hwid_checker)",
      "parentUuid": "cf7e959c_d5a0bc3c",
      "range": {
        "startLine": 616,
        "startChar": 11,
        "endLine": 616,
        "endChar": 13
      },
      "revId": "5f28ab9bc99661a86f0213f7b839bdff10480bcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8fa2dd7a_23922aa3",
        "filename": "host/lib/crossystem.c",
        "patchSetId": 1
      },
      "lineNbr": 616,
      "author": {
        "id": 1158184
      },
      "writtenOn": "2016-07-26T13:07:30Z",
      "side": 1,
      "message": "Changing crossystem allows us to handle all the calls in various places at once rather than having everyone doing it slightly differently, e.g. https://chromium.googlesource.com/aosp/platform/system/update_engine/+/a435daa1be828dc8e6001c35bfa17514860f4fcc/hardware_chromeos.cc#128\nIt also has the benefit that running the crossystem utility shows very obviously what the state is (we think we\u0027re in a VM) for debug, rather than having to dig in different log files.\n\nA possibility could be to the same as here https://chromium.googlesource.com/aosp/platform/system/update_engine/+/stabilize-8447.B/common/hwid_override.cc, we could have a custom /etc/lsb-release for VM images. If the custom hwid in /etc/lsb-release is there, crossystem would show the HWID from the file, otherwise there would be an error.",
      "parentUuid": "8fa2dd7a_63afc2e6",
      "range": {
        "startLine": 616,
        "startChar": 11,
        "endLine": 616,
        "endChar": 13
      },
      "revId": "5f28ab9bc99661a86f0213f7b839bdff10480bcd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}