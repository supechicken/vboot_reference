{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a2a633c7_3f5bc737",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-03-04T00:55:50Z",
      "side": 0,
      "message": "I honestly don\u0027t think removing this is an improvement. I think this enum did a good job clarifying that \"developer boot\" is not the same as \"developer switch set\" and the two need to be carefully distinguished. You now replaced this with individual checks like (dev_mode \u0026\u0026 !rec_mode) but that feels less clear and more prone to mistakes to me (like I\u0027d say you already made one in require_official_os() even though that wasn\u0027t the last line of defense for that case). I think being able to check \"this is a developer *boot*\" in one go without having to open code the details of how rec_mode and dev_mode interact with each other every time is useful.",
      "revId": "a893a93c04c37dae592c4fbfcb79d57f310890a3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1514e71e_39ef15b2",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-03-04T06:29:21Z",
      "side": 0,
      "message": "Yeah... fair enough.  I was also questioning the changes as I was working through this CL.  Actually, REC_MODE and DEV_MODE are already kind of confusing.  DEV_MODE is more like a switch or a flag, whereas the \"boot mode\" itself can be one of {broken, recovery, diag, dev, normal}.  I wonder if it would be useful to get rid of REC_MODE, and introduce an API function which returns one of these five boot types.\n\n(I remember we had talked about removing REC_MODE/DEV_MODE before, since they\u0027re duplicated internally by sd-\u003erecovery_reason and sd-\u003eflags \u0026 VB2_SD_FLAG_DEV_MODE_ENABLED.)\n\nBut maybe that would just be creating a bunch of extra churn for no good reason.\n\n\nAlternatively, this get_kernel_boot_mode function could be pulled up as a utility function, or moved to API level.  Or, functions could be introduced to check each mode, such as vb2_is_rec_boot() and vb2_is_dev_boot().\n\nWhat are your thoughts?",
      "parentUuid": "a2a633c7_3f5bc737",
      "revId": "a893a93c04c37dae592c4fbfcb79d57f310890a3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e935c0aa_aea4573d",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2021-03-05T00:16:43Z",
      "side": 0,
      "message": "Hmmm... yeah, maybe we should export this boot mode concept instead. I\u0027m not sure it\u0027s a good idea to eliminate the old context flags right away but at least we can offer the alternative and switch all callers to use that. Looking through the existing uses of vboot_developer_mode_enabled() in coreboot and vboot_in_developer() in depthcharge, making them return false for rec+dev mode shouldn\u0027t be making anything worse.\n\nI guess you can make it an API, or you can just put a new 8-bit enum value in the context. I think the latter would be a bit better to avoid forcing function call overhead for every little detail, although IIRC making changes to the context format can be a bit of a pain.\n\nIf you want to split the recovery and broken concepts you need to be careful though, because many callers use \"recovery\" as a synonym that applies to both. The existing vboot_in_recovery() should then be rewritten to check for (ctx-\u003eboot_mode \u003d\u003d vb2_boot_recovery_manual || ctx-\u003eboot_mode \u003d\u003d vb2_boot_recovery_broken). Also, that decision actually depends on an external callout (vb2ex_ec_trusted()) which we wouldn\u0027t want to build into all stages. Could maybe change the flow to eliminate that callback and instead have this information passed in with the initial context to fw_phase1().",
      "parentUuid": "1514e71e_39ef15b2",
      "revId": "a893a93c04c37dae592c4fbfcb79d57f310890a3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "95c70ecb_bf3abd92",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2021-03-05T07:51:48Z",
      "side": 0,
      "message": "Created a bug to track this as a potential future change: b/181931817\n\nIn the meantime, keeping the enum in this file, and cleaning up to better match vboot2 style.",
      "parentUuid": "e935c0aa_aea4573d",
      "revId": "a893a93c04c37dae592c4fbfcb79d57f310890a3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab7305f0_c9b9d2ba",
        "filename": "firmware/lib/vboot_kernel.c",
        "patchSetId": 2
      },
      "lineNbr": 463,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2021-03-09T10:53:17Z",
      "side": 0,
      "message": "Remove this field?",
      "range": {
        "startLine": 463,
        "startChar": 8,
        "endLine": 463,
        "endChar": 17
      },
      "revId": "a893a93c04c37dae592c4fbfcb79d57f310890a3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}