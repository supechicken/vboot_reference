{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f3ad1907_27cd0645",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-07T20:09:14Z",
      "side": 1,
      "message": "Thank you Julius for all you valuable comments. I am very busy these days so I cannot look at them in details but Monir is looking in them with my support.\n\nI hope to have more time next week to help on those patches again.",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "caa17498_66f8ac8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-07T20:56:08Z",
      "side": 1,
      "message": "I\u0027ll be out most of next week unfortunately, I\u0027ll probably only work on Monday and Friday. I\u0027ll try to prioritize this review with the time I have.",
      "parentUuid": "f3ad1907_27cd0645",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f67b149_0243fbec",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 419,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "The name for this should say \"RSA\" somewhere, e.g. `X86_RSA_SSE2`.",
      "range": {
        "startLine": 419,
        "startChar": 24,
        "endLine": 419,
        "endChar": 38
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f7d73bde_3e763fd6",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 419,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-13T22:09:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5f67b149_0243fbec",
      "range": {
        "startLine": 419,
        "startChar": 24,
        "endLine": 419,
        "endChar": 38
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05b10915_429c1202",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 431,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "IIRC for 2sha256_x86.c we decided to reimplement the necessary intrinsics in the file directly to keep the firmware build hermetic, so we should do the same here as well.\n\nShould you maybe also add an `-mno-avx` here to make sure the compiler doesn\u0027t go further than intended with this?",
      "range": {
        "startLine": 431,
        "startChar": 51,
        "endLine": 431,
        "endChar": 72
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6ecefc46_e96ddab3",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 431,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-13T22:09:06Z",
      "side": 1,
      "message": "I re-implemented the necessary intrinsics to get rid of this `filter-out`. However, we decided to use `__builtins` function instead of re-implementing in assembly.\n\nI added `-mno-avx` as I agree this is good addition.",
      "parentUuid": "05b10915_429c1202",
      "range": {
        "startLine": 431,
        "startChar": 51,
        "endLine": 431,
        "endChar": 72
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77b4a4b7_22bad0a8",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 1151,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "We should have special tests similar to here to cover this RSA implementation. Maybe you could build a second version of the `vb20_verify_fw` test that links the hwcrypto implementation and then have `vb2_firmware_tests.sh` run that in addition to the default one with the same arguments (that way we would also have the workbuffer watermark numbers for this version in the test output, which would be good).",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0a7f874_4bbb3a34",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 1151,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-15T18:38:45Z",
      "side": 1,
      "message": "Just a reminder that this item is still open.",
      "parentUuid": "77b4a4b7_22bad0a8",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f1f8dfcf_53c71ab2",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 1151,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-15T23:15:58Z",
      "side": 1,
      "message": "Absolutely and we have been working on it. Monir made good progress, I unfortunately did not get a chance to look into this as much I wanted. Nevertheless I have uploaded the patch. Please have a look and let us know if this approach is satisfying.",
      "parentUuid": "e0a7f874_4bbb3a34",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "48ee430a_93abb2a2",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 1151,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-16T00:13:07Z",
      "side": 1,
      "message": "Okay, thanks, we can discuss the details in that CL.",
      "parentUuid": "f1f8dfcf_53c71ab2",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ff418d8_44025a8d",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 29,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "Normally I like these macros, but since we only need it in a single spot here it\u0027s probably easier to just hardcode the masking there.",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2a7c4377_6054bec9",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 29,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-13T22:09:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3ff418d8_44025a8d",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "42716495_b7244cf9",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 52,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-08T01:17:00Z",
      "side": 1,
      "message": "Can this be optimized with `_subborrow_u32()`?",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "efa50305_d94c4564",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 52,
      "author": {
        "id": 3062142
      },
      "writtenOn": "2023-12-11T22:58:48Z",
      "side": 1,
      "message": "We have implemented using _subborrow_u32() according to your suggestion and tested Vboot RSA signature verification with Linux user-space program (performance of user-space program is linear to the boot time as we experimented before). Unfortunately, this implementation increases the performance overhead by around 12%, which is a significant degradation. Again, _subborrow_u32() is not available in SSE2, it requires AVX (reference given below).\n\nhttps://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text\u003d_subborrow_u32\u0026ig_expand\u003d305,2886,2886,2886,4602,1338,1338,1338,6665,6665",
      "parentUuid": "42716495_b7244cf9",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "176328e7_b7a58aa3",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 52,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-12T01:11:49Z",
      "side": 1,
      "message": "Huh... that seems strange, isn\u0027t that API specifically made to speed up subtractions with borrow like this? It shouldn\u0027t be slower than the C implementation. Are you saying that the system doesn\u0027t support AVX and this intrinsic gets automatically software emulated on your machine, and that\u0027s why it\u0027s slower? I was assuming RaptorLake/MeteorLake would support AVX?\n\nAnyway, it was just a minor suggestion, if it doesn\u0027t help then just forget about it. I would be curious _why_ it doesn\u0027t help, but we can go with your software implementation for now.",
      "parentUuid": "efa50305_d94c4564",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7876e4b7_c4109949",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 52,
      "author": {
        "id": 3062142
      },
      "writtenOn": "2023-12-13T00:44:05Z",
      "side": 1,
      "message": "Yeah! It seems strange! We were also curious to see that. The system on which we tested user-space program earlier indeed supports AVX. Raptor Lake and Meteor Lake both support AVX indeed. To avoid confusion with software emulation for user-space programs, today we have tested real boot on Meteor Lake SoC-based Rex board. We have observed the similar trend in the results. There was a 3.6% degradation in boot time because of using _subborrow_u32().",
      "parentUuid": "176328e7_b7a58aa3",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12b15493_8688f62b",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 52,
      "author": {
        "id": 3062142
      },
      "writtenOn": "2023-12-13T06:04:53Z",
      "side": 1,
      "message": "A correction: The aforementioned 3.6% degradation is in modpow execution (i.e., RSA signature verification) using _subborrow_u32().",
      "parentUuid": "7876e4b7_c4109949",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "85995145_17121522",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 52,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-15T18:38:45Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "12b15493_8688f62b",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "35c8590a_795db342",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 104,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-07T01:25:01Z",
      "side": 1,
      "message": "Just want to double-check, are there any integer multiply-and-add instructions in SSE that would allow us to combine these two steps into a single one? I found that Arm has a UMLAL instruction which I believe would work for that, but it seems that Intel has no equivalent?",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc854bfb_9eca8473",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 104,
      "author": {
        "id": 3062142
      },
      "writtenOn": "2023-12-11T23:09:12Z",
      "side": 1,
      "message": "You are correct. We also did not find such instructions (32 bits of MUL and 64bits of ADD operations) in SSE/SSE2. We find _mm_madd_epi16, which suggests 16 bits of MUL and 32 bits of ADD operations.",
      "parentUuid": "35c8590a_795db342",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b38f9ab2_fd444c5c",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 104,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-12T01:11:49Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "bc854bfb_9eca8473",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4c686d48_e77e2835",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 110,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "Is there a notable time difference if you just regenerate `b_modulus[i]` from scratch inside this loop, rather than memoize it beforehand? I mean this is basically the difference between loading one full 128-bit SSE2 register from memory vs. loading two 32-bit locations (`b[i]` and `key-\u003en[i]`) into an SSE2 register from memory. I\u0027m wondering if we can save some space by avoiding the `b_modulus` array.",
      "range": {
        "startLine": 110,
        "startChar": 28,
        "endLine": 110,
        "endChar": 40
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "83774743_b94f7254",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 110,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-08T00:24:32Z",
      "side": 1,
      "message": "I just did the experiments: Removing the array and using `_mm_set_epi32(0, b[i], 0, key-\u003en[i])` instead of per-computing increases the modpow() total time by about 4%.",
      "parentUuid": "4c686d48_e77e2835",
      "range": {
        "startLine": 110,
        "startChar": 28,
        "endLine": 110,
        "endChar": 40
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "25df3480_616a671a",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 110,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-08T00:57:19Z",
      "side": 1,
      "message": "That sounds like it\u0027s probably within the margin of measurement error and could be acceptable?\n\nI think I would prefer for simplicity if we can fit within the existing 12KB workbuf size (at least for the common 11-7-4 algorithm case... 11-11-11 isn\u0027t really used in practice, so as long as that would safely fall back to the old code by implementing this as a hwcrypto backend, I think we don\u0027t need to care about it). With all the suggestions I added (eliminate `b_modulus`, cut `de` in half and reuse `inout` buffer), I think that might just barely be possible. But if it isn\u0027t and we need to make some architecture-specific adjustment either way, then I guess the amount for x86 doesn\u0027t really matter so we could leave it at whatever is the fastest.",
      "parentUuid": "83774743_b94f7254",
      "range": {
        "startLine": 110,
        "startChar": 28,
        "endLine": 110,
        "endChar": 40
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0fb540a4_a5975fd5",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 110,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-08T18:55:56Z",
      "side": 1,
      "message": "\u003e That sounds like it\u0027s probably within the margin of measurement error and could be acceptable?\n\nNo with the methodology I use the precision margin is 0.4% so 4% is a significant degradation.",
      "parentUuid": "25df3480_616a671a",
      "range": {
        "startLine": 110,
        "startChar": 28,
        "endLine": 110,
        "endChar": 40
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6c6acd1c_43105945",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 110,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-15T18:38:45Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "0fb540a4_a5975fd5",
      "range": {
        "startLine": 110,
        "startChar": 28,
        "endLine": 110,
        "endChar": 40
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70a8a6b5_e84122db",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "Could we use `_mm_mask_compressstoreu_epi32` (or a similar instruction if you know a better one) to store the two 32-bit integers we care about here in a 64-bit array in memory, and then later re-extract them from there with `_mm_maskz_expandloadu_epi32` where we need them? I\u0027m trying to find more ways to cut down on the workbuf space demand.",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce66374e_0dc751be",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 3062142
      },
      "writtenOn": "2023-12-13T06:04:53Z",
      "side": 1,
      "message": "To execute these instructions, SoC requires to support AVX512 family (required compilation flags or extensions: AVX512F and AVX512VL). We tried this to execute these intrinsic instructions that you suggested, but we observe illegal instruction exception while computing modpow. The reason behind this is that Intel SIMD AVX-512 may not be available on all SKUs. Again, when hybrid computing is enabled, AVX-512 is disabled. Basically, the processor contains two types of cores, denoted as big and small cores. The big and small cores share the same instruction set and model specific registers. The available instruction sets, when hybrid computing is enabled, is limited compared to the instruction sets available to the big core and AVX-512 is not available in that case.\n\nFurthermore, the CPI (cycles per instruction) is 2 for _mm_mask_compressstoreu_epi32 [1] and _mm_maskz_expandloadu_epi32 [2], which is significantly high as compared to the CPI of 0.33 for _mm_and_si128 [3] that we used.\n\nReferences:\n[1] https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text\u003d_mm_mask_compressstoreu_epi32\u0026ig_expand\u003d2886,2886,2886,4602,1338,1338,1338,6665,6665,5737,6414,305,1338,305,1338,305,1338,220,6665,2886,1338,305,305,1338\n[2] https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#ig_expand\u003d2886,2886,2886,4602,1338,1338,1338,6665,6665,5737,6414,305,1338,305,1338,305,1338,220,6665,2886,1338,305,305,1338,2886\u0026text\u003d_mm_maskz_expandloadu_epi32%2520\n[3] https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text\u003d_mm_and_si128\u0026ig_expand\u003d2886,2886,2886,4602,1338,1338,1338,6665,6665,5737,6414,305,1338,305,1338,305,1338,220,6665,2886,1338,305,305",
      "parentUuid": "70a8a6b5_e84122db",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "72ee2055_41bd0d80",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 114,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-15T18:38:45Z",
      "side": 1,
      "message": "Okay, thanks for trying. It sounds like there\u0027s no practical way to fit within the 12KB workbuf anyway, so then let\u0027s just forget about all this and stick with your 20KB implementation after all (if it has to be made platform-specific anyway, I guess the exact size doesn\u0027t matter that much anymore, at least not for recent Intel chips where we usually have enough CAR space).",
      "parentUuid": "ce66374e_0dc751be",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9ac7ea9_ca85d0b9",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 134,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "Since we know this is only targeting x86 to begin with we can probably just use `__builtin_bswap32()` here. (In fact, I\u0027m not sure why we didn\u0027t just do that everywhere to begin with...)",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "41be6510_49a373f5",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 134,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-13T18:10:28Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a9ac7ea9_ca85d0b9",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "43fefae8_2fc518ed",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 160,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-08T00:57:19Z",
      "side": 1,
      "message": "Actually, was there ever a good reason why `inout` is copied into `a` instead of just swapping the bytes in-place? That shouldn\u0027t be hard, right? That could save us another `4*arrsize` bytes...",
      "range": {
        "startLine": 160,
        "startChar": 28,
        "endLine": 160,
        "endChar": 33
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "25a729a6_8a850999",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 160,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-15T17:04:44Z",
      "side": 1,
      "message": "I suggest to go over that comment in a separate commit.",
      "parentUuid": "43fefae8_2fc518ed",
      "range": {
        "startLine": 160,
        "startChar": 28,
        "endLine": 160,
        "endChar": 33
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "61e8acad_f81822d0",
        "filename": "firmware/2lib/2modpow_sse2.c",
        "patchSetId": 11
      },
      "lineNbr": 160,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-15T18:38:45Z",
      "side": 1,
      "message": "Okay, can probably forget about this now if we decide to not care that much about the size.",
      "parentUuid": "25a729a6_8a850999",
      "range": {
        "startLine": 160,
        "startChar": 28,
        "endLine": 160,
        "endChar": 33
      },
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31c81088_1bb0ce40",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-06T01:56:45Z",
      "side": 1,
      "message": "Let\u0027s make this a macro that takes `key_bytes` as an argument, that way you can make this `((s * 11) + 8)` instead of `(s * 12)` (or better `((s * 7) + 8)` if you can avoid the `b_modulus` array).",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "efd6c5c2_54ac5f3d",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-14T21:52:57Z",
      "side": 1,
      "message": "Actually, I think the hwcrypto implementation should provide the size of the work buffer it neesds to run. I created and implemented `vb2ex_hwcrypto_modexp_workbuf_size` for this purpose. Let me know what you think.",
      "parentUuid": "31c81088_1bb0ce40",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e3ff9c4_0a47e1a2",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-12-15T09:25:35Z",
      "side": 1,
      "message": "Julius suggested another approach in CL:5055249:\n\n\u003e In order to allow for the bigger work buffer use, I think we should change the signature of vb2ex_hwcrypto_modexp() to pass in `wblocal` directly, and then the implementation can make its own allocations as necessary.\n\nThe problem with this approach is that `vb2_workbuf_alloc` should be private to vboot.\n\nYour `vb2ex_hwcrypto_modexp_workbuf_size` solution looks fine. However you\u0027ll need to implement that for coreboot/src/soc/amd/common/psp_verstage/vboot_crypto.c, to not break amd boards.\n\nI think another simpler solution is to allocate as much memory as possible (even all the remaining in `wblocal`) for `vb2ex_hwcrypto_modexp`. The range of memory will be freed right after the `vb2ex_hwcrypto_modexp` call anyway. For that to work, we\u0027ll just need to pass `workbuf32_size` to `vb2ex_hwcrypto_modexp` (and maybe change `workbuf32` to `void *`), so that the platform\u0027s implementation can fail if the allocated size is too small.\n\n(I\u0027ll be OOO until Dec 25)",
      "parentUuid": "efd6c5c2_54ac5f3d",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24dd92ad_7383cd97",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-15T16:44:42Z",
      "side": 1,
      "message": "I totally forgot about **Julius** original suggestion, thanks for the reminder. I considered such a solution though. I did not have any strong argument against but here is what I though :\n\n-   I had concern about the fact the hwcrypto implementation was going to be responsible of memory allocation. I believe that this function should stick to the algorithm only to keep it simple.\n-   The change of prototype could would make the code in `2rsa.c` looks a little bit less consistent.\n\nThe solution I went with isn\u0027t perfect either as it adds an extra function.\n\n**@Julius** and **@Yu-Ping**, let me know what is your final recommendation and I will go with it.",
      "parentUuid": "5e3ff9c4_0a47e1a2",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e23a874_a3cf9201",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-15T18:38:45Z",
      "side": 1,
      "message": "I actually like Yu-Ping\u0027s suggestion a lot â€” just pass the entire remaining space, and then we don\u0027t have to deal with those API visibility issues or add extra callbacks. You should be able to just use `VB2_MIN(wb-\u003esize, wb-\u003esize - VB2_WORKBUF_ALIGN)` as the allocation size and then that should always fit exactly what we have left (minus an amount of alignment padding that shouldn\u0027t matter at these sizes). You can reuse that same allocation for the hwcrypto and the fallback implementation so it should look pretty clean in 2rsa.c.",
      "parentUuid": "24dd92ad_7383cd97",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac3d204b_eda91e68",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-15T23:15:58Z",
      "side": 1,
      "message": "Implemented Yu-Ping suggestion. I did not get the point of your `VB2_MIN(wb-\u003esize, wb-\u003esize - VB2_WORKBUF_ALIGN)`, is it for overflow ? so I kept this comment open...",
      "parentUuid": "1e23a874_a3cf9201",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d785d9a3_f3104182",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-12-16T00:13:07Z",
      "side": 1,
      "message": "Yeah sorry, it was just for overflow, but now that I think about it since you check the result of vb2_workbuf_alloc() with that anyway, it shouldn\u0027t be needed.",
      "parentUuid": "ac3d204b_eda91e68",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8f270792_80f165f3",
        "filename": "firmware/2lib/include/2rsa_private.h",
        "patchSetId": 11
      },
      "lineNbr": 17,
      "author": {
        "id": 1542640
      },
      "writtenOn": "2023-12-18T23:53:36Z",
      "side": 1,
      "message": "It turns out it was failing the following test:\n```\ntests/vb2_common2_tests.c:202: vb2_verify_data() workbuf too small ... FAILED\n```\nSo I added your suggestion.",
      "parentUuid": "d785d9a3_f3104182",
      "revId": "97998692835dd0afb66b5f84c86ab32ba0cd50d4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}