{
  "comments": [
    {
      "key": {
        "uuid": "cff1e955_bbd02c57",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 433,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-04-12T04:40:29Z",
      "side": 0,
      "message": "nit: not quite sure why this line needs to move, I kinda like how it gets cleared immediately after the check (even though your patch just moves that a few functions further down the same call stack, this way it\u0027s immediately obvious that this can never stay stuck on in some weird edge case).",
      "revId": "516732f868a0c4bade1e718875b3779d3361c72f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "98c7c954_d0be6ed1",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 433,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-04-12T05:31:12Z",
      "side": 0,
      "message": "I agree that it\u0027s a nice property to see that it is checked and cleared right away.  But I don\u0027t think that logic belongs in the main boot path branching point.\n\nIf you prefer not to group everything in the UI function (which admittedly isn\u0027t ideal), then perhaps we should try something like what Campfire did -- add an extra function call right after EC sync, with logic something like:\n\n  if DIAG_REQUEST:\n    unset DIAG_REQUEST\n    set VB2_CONTEXT_DIAGNOSTIC_MODE",
      "parentUuid": "cff1e955_bbd02c57",
      "revId": "516732f868a0c4bade1e718875b3779d3361c72f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cfd60f67_c99f50ba",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 1
      },
      "lineNbr": 433,
      "author": {
        "id": 1284883
      },
      "writtenOn": "2019-04-12T06:19:08Z",
      "side": 0,
      "message": "I\u0027m not clear if \"everything in the UI function\" is this current draft or something like:\n\n} else if (DIAGNOSTIC_UI \u0026\u0026 !(retval \u003d VbBootDiagnostic(ctx))) {\n  /* empty */\n} else if (ctx-\u003eflags \u0026 VB2_CONTEXT_DEVELOPER_MODE) {\n\nAnd have VbBootDiagnostic() check vb2_nv_get(ctx, VB2_NV_DIAG_REQUEST). This would be a way to keep the bit read/update in the same function (now in the callee rather than the caller). I\u0027m not sure this would be a net win, and seems more prone to accidental error introduced in a later code change (the compilers in some repos are also configured to be aggressive about prohibiting assignment within conditionals [even when parens are used]).",
      "parentUuid": "98c7c954_d0be6ed1",
      "revId": "516732f868a0c4bade1e718875b3779d3361c72f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}