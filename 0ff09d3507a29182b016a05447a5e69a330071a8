{
  "comments": [
    {
      "key": {
        "uuid": "3a2af2df_4203c7ac",
        "filename": "tests/vb2_api_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 396,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-05T22:24:22Z",
      "side": 1,
      "message": "I\u0027m somewhat confused why we\u0027re testing NV_RECOVERY_REQUEST here at all. It seems somewhat inconsequential to the flow being tested. Could maybe consider just taking it out (all of these here).",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "539a8766_3077f8f1",
        "filename": "tests/vb2_api_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 396,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-07T06:56:03Z",
      "side": 1,
      "message": "Well.. I suppose we are checking that the recovery request is *not* cleared, regardless of whether it is from a previous boot, or from the current boot before vb2_check_recovery() is run.\n\nOr do you think our tests in vb2_misc_tests.c are sufficient for that purpose?",
      "parentUuid": "3a2af2df_4203c7ac",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9df7c440_c5c391ce",
        "filename": "tests/vb2_api_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 396,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-08T00:32:57Z",
      "side": 1,
      "message": "I don\u0027t think it really belongs here (I guess in general it would always be good to confirm that the whole state of everything other than what was intended to change didn\u0027t change, but we don\u0027t do that elsewhere either) but it doesn\u0027t hurt anything.",
      "parentUuid": "539a8766_3077f8f1",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ad1ae8ff_9ff1562a",
        "filename": "tests/vb2_api_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 396,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-08T02:34:26Z",
      "side": 1,
      "message": "An \"ideal test\" would confirm that the whole state of everything is as expected -- but then you have very highly coupled test/code which will fail on any code change.\n\nI think the difference in this case is that this particular state *may* change with certain inputs -- specifically, when failures occur after the vb2_check_recovery() call, then VB2_NV_RECOVERY_REQUEST *should* be set.\n\nOn a side note, is it just me or will the vb2api_fail(VB2_RECOVERY_DEV_SWITCH) line in vb2api_fw_phase1 never take effect?  In the one case where vb2_check_dev_switch() returns failure, it already calls vb2api_fail() itself...",
      "parentUuid": "9df7c440_c5c391ce",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d813c6f4_29efbc40",
        "filename": "tests/vb2_api_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 396,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-08T06:29:01Z",
      "side": 1,
      "message": "Yes. I think this was just defensive programming by Randall -- i.e. if anyone ever makes a change to vb2_check_dev_switch() that allows it to return an error without also setting a recovery reason, there\u0027s still a fallback recovery reason in the higher layer. I think that\u0027s not necessarily a bad idea... maybe we should do that in more places (e.g. many return paths in VBSLK() just rely on the leaf function having set the recovery reason correctly and it\u0027s not always easy to confirm that they do in all cases). vb2api_fail() was intentionally designed to be used that way, after all. Maybe if you introduce the VB2_TRY() you proposed, that will make it easier to do this.",
      "parentUuid": "ad1ae8ff_9ff1562a",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cf4ba56e_98c4db6a",
        "filename": "tests/vb2_api_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 396,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-09T08:37:09Z",
      "side": 1,
      "message": "Yeah I suppose that makes sense.  We can work that in as part of the VB2_TRY efforts.",
      "parentUuid": "d813c6f4_29efbc40",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3de4e440_a87bcb8c",
        "filename": "tests/vb2_misc_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 401,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-02-05T22:24:22Z",
      "side": 1,
      "message": "Since the clearing no longer happens here, shouldn\u0027t we also add something to some of the VBSLK tests to test that the reason gets cleared under all intended circumstances in the new place?",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "234817c5_6d768d0f",
        "filename": "tests/vb2_misc_tests.c",
        "patchSetId": 5
      },
      "lineNbr": 401,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-02-07T06:56:03Z",
      "side": 1,
      "message": "Sure.  Added one to vboot_api_kernel4_tests.c.",
      "parentUuid": "3de4e440_a87bcb8c",
      "revId": "0ff09d3507a29182b016a05447a5e69a330071a8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}