{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "968901ea_8575293f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-05-07T00:18:44Z",
      "side": 1,
      "message": "Note that as far as I\u0027m aware nothing is calling this script with the \"firmware\" type to begin with (I wouldn\u0027t have high confidence that that signing mode still works correctly at all). LOEM support is correctly implemented for the \"recovery\" type which is how all our firmware actually gets signed in practice. So I\u0027m not opposed to you fixing this if you want to, but it\u0027s not really relevant to what we\u0027re actually using.",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d1cd2fb2_bd5c1267",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T16:07:38Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "968901ea_8575293f",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae7f8b1b_7b2e9a2b",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-05-07T00:18:44Z",
      "side": 1,
      "message": "If using lsb-release to detect this quirk becomes too complicated, we can just find another solution rather than spilling this plumbing all over the place. I think just something like `[[ -e \"${firmware_dir}/models/guybrush\" ]]` or `grep Google_Guybrush \"${firmware_dir}/VERSION\"` should probably do the trick.",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "896b80c1_468f7b2c",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2024-05-07T12:22:11Z",
      "side": 1,
      "message": "missing `local`",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "781044ad_6fc95d92",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T16:07:38Z",
      "side": 1,
      "message": "I just unpacked a firmware tarball from a firmware builder and I don\u0027t see a `VERSION` file or a `models` directory. is it ok if I leave this for now?",
      "parentUuid": "ae7f8b1b_7b2e9a2b",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "46664b3e_bb174862",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T16:07:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "896b80c1_468f7b2c",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd116020_cfb7da69",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-05-07T18:38:01Z",
      "side": 1,
      "message": "No, we should find the right solution for the new state, not just blindly move code around. Are you sure that you looked at the right kind of archive? This script is designed to run on a `chromeos-firmwareupdate` shellball, not on the `ChromeOS-firmware-xxx.tbz` tarballs you can download from GoldenEye (the ones that contain all the `image-\u003cboard\u003e.bin` and `image-\u003cboard\u003e.serial.bin` files). (Of course please make sure you actually test any code you submit here.)",
      "parentUuid": "781044ad_6fc95d92",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74db0a08_23df4f3d",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2024-05-07T18:56:14Z",
      "side": 1,
      "message": "we specifically added support for running on files directly out of the firmware tarballs years ago.  that\u0027s what `TYPE\u003d\u003dfirmware` is.  what we didn\u0027t do was extend that to support unibuild when it didn\u0027t have a single .bin file to sign.  so that code should work now.  last time we used that functionality was link/spring timeframe, but the code hasn\u0027t really changed.",
      "parentUuid": "dd116020_cfb7da69",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d08bdf19_3728fef1",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T19:06:49Z",
      "side": 1,
      "message": "I tested this by:\n- downloading a firmware tarball that came out of a firmware builder (https://ci.chromium.org/ui/p/chromeos/builders/firmware/firmware-brya-14505.B-branch/779/infra, gs://chromeos-image-archive/firmware-brya-14505.B-branch-firmware/R100-14505.761.0/brya/firmware_from_source.tar.bz2) and unpacked into a directory\n- pulled a signer_config.csv from an existing signed firmware of the same board\n- modified that signer_config.csv to reference the loem names in http://cs/h/chromium/chromiumos/codesearch/+/main:src/platform/vboot_reference/tests/loemkeys/loem.ini\n- called the script with that directory as the input",
      "parentUuid": "74db0a08_23df4f3d",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "974772e2_a33cfad3",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-05-07T21:05:09Z",
      "side": 1,
      "message": "Sorry, I still don\u0027t get it. Okay, so type `firmware` was actually just meant to operate on a raw image, not a shellball. But now you\u0027re trying to make it do something completely different, which is to operate on a directory that looks exactly like an unpacked shellball?\n\nI don\u0027t see how you could just take a `signer_config.csv` from somewhere, throw it into an unpacked `firmware_from_source` directory and make that work â€” the file names are all completely different. When you say \"modified\" do you mean that you completely rewrote the CSV (e.g. update all names from something like `bios-brya.ro-14505-761-0.rw-14505-761-0.bin` to `image-brya.bin`)? Or how would you make that fit together?\n\nI still don\u0027t get the whole point of what you\u0027re trying to do here (I thought you just wanted it to be able to sign a raw shellball without surrounding recovery image, but apparently it\u0027s not that). You\u0027re basically saying \"what if someone wanted to bypass the entire firmware packer and somehow assemble a vaguely comparable directory by hand and then sign it\" and I really don\u0027t see where that use case comes from, nor why we should allow it (and risk things getting out of sync every time something in the normal packer-\u003esigner flow changes). If you really have a raw `firmware_from_source` tarball and want to get it to a state where it could run through this script, I think it would make more sense for you to run `pack_firmware.py` manually and then feed the output of that into here (and for that use case we could consider adding a mode that takes a raw shellball), not try to redo the same steps and hack together the whole CSV and directory structure by hand.",
      "parentUuid": "d08bdf19_3728fef1",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "13ccc7ca_50c82e55",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 485,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2024-05-08T05:07:47Z",
      "side": 1,
      "message": "we want to make the output of firmware builders directly signable again like they are in non-unibuild images, and not have to go through a full uprev in ToT/OS build just to get a shellball that\u0027s signed.  the exact details for making that work are up for discussion.",
      "parentUuid": "974772e2_a33cfad3",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a9f7713_59f79255",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 505,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2024-05-07T12:22:11Z",
      "side": 1,
      "message": "\u003e style: Prefer double quoting even when variables don\u0027t contain special characters.\n\u003e \n\u003e https://github.com/koalaman/shellcheck/wiki/SC2248\n\nPlease fix.",
      "parentUuid": "24c63818_e0c251c0",
      "range": {
        "startLine": 505,
        "startChar": 47,
        "endLine": 505,
        "endChar": 63
      },
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ead445b9_53b63f30",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 505,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T16:07:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3a9f7713_59f79255",
      "range": {
        "startLine": 505,
        "startChar": 47,
        "endLine": 505,
        "endChar": 63
      },
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "719b4e3c_129f07b7",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 507,
      "author": {
        "id": 1000768
      },
      "writtenOn": "2024-05-07T12:22:11Z",
      "side": 1,
      "message": "missing `local`",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f2639f9c_1e53915f",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 507,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T16:07:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "719b4e3c_129f07b7",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "28fb3512_2082ac2f",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 1432,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-05-07T00:18:44Z",
      "side": 1,
      "message": "I don\u0027t really understand what this operating mode has to do with LOEM support? I\u0027m not sure this is a particularly useful option to offer...",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7d7c8d9_993068c6",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 1432,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T16:07:38Z",
      "side": 1,
      "message": "to support LOEM keysets, we need to have the firmware images as well as the signer.csv file that indicates which key to use. The easiest way to support that was to package all that into a directory, and since the other path for firmware signing takes in a single file, this seemed like a good distinction",
      "parentUuid": "28fb3512_2082ac2f",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "887afd7c_8491bef4",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 1432,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-05-07T18:38:01Z",
      "side": 1,
      "message": "Sorry, I don\u0027t understand... `signer_config.csv` already exists in the shellball archive? Line 547 is already using it?",
      "parentUuid": "c7d7c8d9_993068c6",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0fa608b9_a87ee385",
        "filename": "scripts/image_signing/sign_official_build.sh",
        "patchSetId": 1
      },
      "lineNbr": 1432,
      "author": {
        "id": 1524007
      },
      "writtenOn": "2024-05-07T19:15:44Z",
      "side": 1,
      "message": "this approach is for signing firmware not part of a full chromeos image, and thus we don\u0027t have a shellball yet.",
      "parentUuid": "887afd7c_8491bef4",
      "revId": "be0b9f3ef0e32e8c323b2c5a69f7b9fa727dc3cd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}