{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1575e253_3e7951c4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1487622
      },
      "writtenOn": "2022-09-26T04:45:52Z",
      "side": 1,
      "message": "The outcome of the coreboot discussion was to replace the checksum with a hash: CB:67670. So we still need this. Also, the header checksum was replaced with a hash too, so we need to do something about the header checksum verification too.\n\nI still think it\u0027s best to just remove the checksum verification. My impression from b:35582652, especially comment #2 \"Check that the signature \"MRCD\" is present at the start of RECOVERY_MRC_CACHE. If required, checksum calculation can also be performed\", is that this was meant to be a simple sanity check that the MRC cache is repopulated after clearing it, and the checksum verification was added because why not, not because it\u0027s strictly necessary. We already have FAFT tests which test the checkusm/hash properly, e.g. corrupt the MRC cache and check memory is retrained. But let me know if I\u0027m missing something, because I\u0027m not that familiar with the factory process.\n\nIf we do want to verify the hash, we\u0027ll have to add xxhash to vboot. That\u0027s definitely possible, I just think we might as well avoid it if it\u0027s not necessary. Another option is to move this whole thing to one of the coreboot utils to reduce code duplication.\n\nLet me know what you think.",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "451ac44b_0f4db3e9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1136349
      },
      "writtenOn": "2022-09-26T05:02:09Z",
      "side": 1,
      "message": "I think in today\u0027s factory process, the main purpose of the MRC Cache test is to train and **cache** the result. So we can save time on the first boot.\n\nWhat might cause the hash to be incorrect? And, in this case, it will impact the boot time in OOBE, right?",
      "parentUuid": "1575e253_3e7951c4",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "94990c1a_79518c73",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1487622
      },
      "writtenOn": "2022-09-26T05:23:42Z",
      "side": 1,
      "message": "The result will still be cached, and the hash should be correct.\n\nIt\u0027s just that to verify the hash, we\u0027d need to add a new hash function to vboot, and I\u0027d prefer to avoid the code duplication.\n\nThe duplication seems unnecessary since coreboot already verifies the cache during boot. I think if we understand what the aim of the factory test is, we can find a better way to test things.\n\nFrom what you\u0027re saying it sounds like the aim is to check that cached data will be used on subsequent boots. Then how about doing a reboot and grepping the coreboot log to check that cached data is used?",
      "parentUuid": "451ac44b_0f4db3e9",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7c504b5_16b5346f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1487622
      },
      "writtenOn": "2022-09-26T05:33:32Z",
      "side": 1,
      "message": "Another thing - on most devices with a TPM we don\u0027t actually use the hash in the header to check if the cache is valid, rather we compute a SHA and compare it to a SHA stored in the TPM. So to do it properly, the factory test would need to verify against the SHA in the TPM too. This is another reason I think it makes more sense to test the coreboot logic directly, rather than trying to duplicate it here.",
      "parentUuid": "94990c1a_79518c73",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a3bda2f7_a881066a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1136349
      },
      "writtenOn": "2022-09-26T06:30:20Z",
      "side": 1,
      "message": "Is the following steps feasible?\n\n1. request to retrain MRC cache\n2. Reboot\n3. Check coreboot log, we should see that the cache is available and used",
      "parentUuid": "a7c504b5_16b5346f",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9e2d33a6_74c53906",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1487622
      },
      "writtenOn": "2022-09-27T11:55:49Z",
      "side": 1,
      "message": "Marking V-1 so we don\u0027t submit this until we figure out a new factory test.",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "98fb54ea_194e31fa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1487622
      },
      "writtenOn": "2022-09-27T11:55:49Z",
      "side": 1,
      "message": "Yeah, that\u0027s what I was thinking. This will work for RW_MRC_CACHE, I\u0027m just not sure about RECOVERY_MRC_CACHE, since we\u0027ll lose the logs from the first boot.\n\nPhoebe filed a bug for this, so let\u0027s discuss it there: b:249174725.",
      "parentUuid": "a3bda2f7_a881066a",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "46321bf0_338ad5ea",
        "filename": "futility/cmd_validate_rec_mrc.c",
        "patchSetId": 2
      },
      "lineNbr": 41,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2022-09-29T01:35:53Z",
      "side": 1,
      "message": "Can we just update these? Is that going to cause any issues if a newer version of futility is used on a board where the firmware branched before the coreboot change?\n\nShould be maybe have updated the signature in coreboot to be able to tell both headers apart?",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "517e9844_7672d4bf",
        "filename": "futility/cmd_validate_rec_mrc.c",
        "patchSetId": 2
      },
      "lineNbr": 41,
      "author": {
        "id": 1487622
      },
      "writtenOn": "2022-09-29T01:43:14Z",
      "side": 1,
      "message": "That\u0027s a very good point.\n\nBut after thinking about this some more and discussing with factory folks, I\u0027m actually hoping we can get rid of this command altogether and have the factory test check the coreboot logs / elog instead. We\u0027re discussing this in b:249174725 if you have any thoughts.",
      "parentUuid": "46321bf0_338ad5ea",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0433f0c1_d6399653",
        "filename": "futility/cmd_validate_rec_mrc.c",
        "patchSetId": 2
      },
      "lineNbr": 41,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2022-09-30T00:24:43Z",
      "side": 1,
      "message": "I still feel like it\u0027s probably a good idea to change the signature, just in case we have some future need for parsing this. Uploaded CB:68012.",
      "parentUuid": "517e9844_7672d4bf",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8b5d9511_ab8378cf",
        "filename": "futility/cmd_validate_rec_mrc.c",
        "patchSetId": 2
      },
      "lineNbr": 41,
      "author": {
        "id": 1487622
      },
      "writtenOn": "2022-09-30T00:30:25Z",
      "side": 1,
      "message": "Makes sense, thanks!",
      "parentUuid": "0433f0c1_d6399653",
      "revId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ],
  "submitRequirementResults": [
    {
      "submitRequirement": {
        "name": "Code-Owners",
        "description": {
          "value": "User with the code owner override approved the change"
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "has:enabled_code-owners"
          }
        },
        "submittabilityExpression": {
          "expressionString": "has:approval_code-owners"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Owners-Override\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"has:enabled_code-owners"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["has:enabled_code-owners"],"failingAtoms":[]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"has:approval_code-owners"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["has:approval_code-owners"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Owners-Override=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Owners-Override=+1"]}
      },
      "patchSetCommitId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Code-Review",
        "description": {
          "value": "Submit requirement for the \u0027Code-Review\u0027 label"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Code-Review\u003dMAX,user\u003dnon_uploader -label:Code-Review\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Code-Review=MAX,user=non_uploader -label:Code-Review=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Code-Review=MAX,user=non_uploader","label:Code-Review=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1"]}
      },
      "patchSetCommitId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Review-Enforcement",
        "description": {
          "value": "Two Google employees must approve the change. Uploading the change or voting positively on Code-Review count as approval."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "is:review-enforced_gerrit"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:review-enforcement-satisfied_gerrit"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforced_gerrit"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["is:review-enforced_gerrit"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforcement-satisfied_gerrit"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Verified",
        "description": {
          "value": "CI or human verified the change"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Verified\u003dMAX AND -label:Verified\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Verified=MAX AND -label:Verified=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":["label:Verified=MIN"],"failingAtoms":["label:Verified=MAX"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1"]}
      },
      "patchSetCommitId": "037bfa2632c7a59c0eece69ef0e63411e3ade7c1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    }
  ]
}