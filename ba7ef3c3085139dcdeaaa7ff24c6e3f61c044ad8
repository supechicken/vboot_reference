{
  "comments": [
    {
      "key": {
        "uuid": "9986bda7_929d9eb8",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-26T00:05:01Z",
      "side": 1,
      "message": "Ideally I\u0027d like something like assert(parent \u0026\u0026 offset) here. But I guess we don\u0027t have assert() in vboot yet? We should probably add that. Maybe put a /* TODO:... */ here?",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77163353_a10cca1c",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-07-26T02:34:58Z",
      "side": 1,
      "message": "Yeah, sure.  Should we make that a function, or a macro that lives alongside VB2_DEBUG?",
      "parentUuid": "9986bda7_929d9eb8",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4569d64b_17cfdb8c",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-26T03:58:46Z",
      "side": 1,
      "message": "I think a vb2ex_assert() would be best so the calling firmware can decide how to handle it. Should be implemented as a macro in the caller so they can choose to print file/line info or drop in in release builds and stuff.",
      "parentUuid": "77163353_a10cca1c",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "822334dd_5fd5cd16",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 108,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-07-29T03:47:44Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "4569d64b_17cfdb8c",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a4b1c26a_6f9e68e6",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-26T00:05:01Z",
      "side": 1,
      "message": "nit: All the casts not really necessary. (Depending on who you ask, pointer arithmetic on void * is either a terrible crime against humanity because a handful of  guys in 1989 didn\u0027t think far enough to see how useful it would be, or perfectly fine because the behavior is well-defined across all major compilers. Personally, I tend towards the second interpretation.)",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed61c7ea_e47512fe",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-07-26T02:34:58Z",
      "side": 1,
      "message": "OK.  But we still need one cast to get rid of const...",
      "parentUuid": "a4b1c26a_6f9e68e6",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0ab12d0e_c9ed0215",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-26T03:58:46Z",
      "side": 1,
      "message": "I think the argument just shouldn\u0027t be a const pointer then? Why do you need that?",
      "parentUuid": "ed61c7ea_e47512fe",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "448607ca_a6c7c8ee",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-07-29T03:47:44Z",
      "side": 1,
      "message": "Here, my understanding is that the const on `offset` is not so useful, since it\u0027s just preventing the function from modifying the copied value it gets.\n\nThe const on `parent` prevents vb2_member_of from modifying the value pointed to by parent.  This is arguably useful, since it guarantees the caller doesn\u0027t have to worry about the value getting changed?  And it seems like other functions in this file do the same.\n\nSo unless we want to s/const void */void */g, then seems like we still need one (void *) cast here.  Thoughts?",
      "parentUuid": "0ab12d0e_c9ed0215",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "780971f6_62433e8d",
        "filename": "firmware/2lib/2common.c",
        "patchSetId": 1
      },
      "lineNbr": 109,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-30T22:13:57Z",
      "side": 1,
      "message": "\u003e Here, my understanding is that the const on `offset` is not so useful, since it\u0027s just preventing the function from modifying the copied value it gets.\n\nYeah, that one is useless anyway, but I meant the other one.\n\n\u003e The const on `parent` prevents vb2_member_of from modifying the value pointed to by parent.  This is arguably useful, since it guarantees the caller doesn\u0027t have to worry about the value getting changed?  And it seems like other functions in this file do the same.\n\nBut it doesn\u0027t? Like you said it creates the *impression* that you cannot modify the stuff pointed to, but that\u0027s actually not true, because this function returns a void * that you totally *can* use to do exactly that. So it seems misleading. A const cast in general always means that you\u0027re doing something naughty that you probably shouldn\u0027t and should normally be avoided if at all possible. And hiding it in a helper function like this is almost always a bad idea in my opinion because of exactly this -- the whole point of forcing programmers to const cast explicitly is to make them aware that at this point they\u0027re (potentially) modifying something that someone else somewhere intended to be read-only. It\u0027s intended to be annoying and in your face (because it usually means you\u0027re doing something wrong).\n\nThe only time when you\u0027d really want to have a const cast in a helper like this is when it\u0027s the only way to avoid littering hundreds of const cast elsewhere in your code that you can\u0027t avoid otherwise. (This mostly happens with dumb POSIX functions that were defined to not take a const argument at some point in the 70s, even though they really should have.) But other than those exceptional cases, the normal correct solution for these kinds of problems is to add or remove the const qualifier elsewhere so that you don\u0027t get into the weird situation of having to cast in the first place. (In this case, I don\u0027t think the argument passed in here is ever already const(?), so just removing the const in the argument is the right fix.)",
      "parentUuid": "448607ca_a6c7c8ee",
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ee794adf_825e03ee",
        "filename": "firmware/lib20/api.c",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-26T00:05:01Z",
      "side": 1,
      "message": "nit: maybe get rid of all these unnecessary casts while we\u0027re here? (At least they seem pointless to me, idk if you think they add any readability?)",
      "range": {
        "startLine": 56,
        "startChar": 7,
        "endLine": 56,
        "endChar": 39
      },
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8d232f4_9cd6d56e",
        "filename": "firmware/lib20/api.c",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-07-26T02:34:58Z",
      "side": 1,
      "message": "Sure, why not.",
      "parentUuid": "ee794adf_825e03ee",
      "range": {
        "startLine": 56,
        "startChar": 7,
        "endLine": 56,
        "endChar": 39
      },
      "revId": "ba7ef3c3085139dcdeaaa7ff24c6e3f61c044ad8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}