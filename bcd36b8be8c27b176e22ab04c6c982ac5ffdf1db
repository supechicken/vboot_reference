{
  "comments": [
    {
      "key": {
        "uuid": "0fa7f9ef_eda45fb1",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-31T19:55:33Z",
      "side": 1,
      "message": "Also dead, I think.",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7e6471cf_2aaf7ccc",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "This is called below in SafeWrite()?",
      "parentUuid": "0fa7f9ef_eda45fb1",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c29197c_94bc1f33",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-08-06T22:49:46Z",
      "side": 1,
      "message": "Huh... funny. What is that even doing? TPMs are such weird creatures...",
      "parentUuid": "7e6471cf_2aaf7ccc",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "833d15f5_2ac8b579",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-07T08:12:21Z",
      "side": 1,
      "message": "s/weird/fickle/?",
      "parentUuid": "0c29197c_94bc1f33",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a3581493_0569dda8",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 65,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2019-07-31T17:24:30Z",
      "side": 1,
      "message": "nit: can we call it ReadAntirollbackSpace since it assumes a certain structure of data (crc field), so is only applicable to firmware and kernel spaces. it\u0027s not for a generic tpm nvram space.",
      "range": {
        "startLine": 65,
        "startChar": 16,
        "endLine": 65,
        "endChar": 25
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5b2689b1_855fe6c6",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 65,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "No longer need this function.",
      "parentUuid": "a3581493_0569dda8",
      "range": {
        "startLine": 65,
        "startChar": 16,
        "endLine": 65,
        "endChar": 25
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc19bbd6_a3138338",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-31T19:55:33Z",
      "side": 1,
      "message": "I know this is what the old code did, but it seems pretty pointless to me. If we think that the transport-layer communication to Cr50 is reliable, then there\u0027s no need to read multiple times in case of bad CRC. If we don\u0027t think it\u0027s reliable, then random bit flips could also cause all kinds of conditions that end up causing a failure up here (e.g. change the opcode to an invalid one or something). So either we retry the whole thing on any kind of error, or not at all.\n\nIn general we don\u0027t error check and retry SPI/I2C peripherals much, we usually assume they work reliably (e.g. if a read from the SPI flash got corrupted, we\u0027re usually just screwed, there\u0027s no CRC no nothing there). So I\u0027m not sure how much the retries here are worth.",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9eea6624_a2bd85af",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-01T08:51:50Z",
      "side": 1,
      "message": "If we want to go down that path, then please review this CL instead: CL:1729713",
      "parentUuid": "dc19bbd6_a3138338",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5985a39b_993e51dc",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 75,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "Restacked the CLs -- CL:1729713 is now underneath this one.",
      "parentUuid": "9eea6624_a2bd85af",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e83a5aa3_62b46468",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 80,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-31T19:55:33Z",
      "side": 1,
      "message": "Let\u0027s drop this ancient compatibility hack while we\u0027re here.",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f55e444d_8d9b5684",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 80,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "Done in a separate CL.",
      "parentUuid": "e83a5aa3_62b46468",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4a5ca220_45ad4ef0",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 119,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2019-07-31T17:24:30Z",
      "side": 1,
      "message": "why do we need to pass that in? because we have a variable |length| of data we need to write (and thus read back for checking crc)? can we just allocate max_length(all possible spaces we deal with) inside Read[Antirollback]Space? will be a better i/face since the caller of Write* doesn\u0027t need data2 back.",
      "range": {
        "startLine": 119,
        "startChar": 12,
        "endLine": 119,
        "endChar": 17
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d18826a7_7345ba56",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 119,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-31T19:55:33Z",
      "side": 1,
      "message": "Agreed... or decide to drop the readback check completely. Is there a point in doing this with Cr50? We are already trusting it implicitly on so many fronts, this seems like an odd place to start double-checking its work (and even then, getting the right response back doesn\u0027t necessarily guarantee it was committed to flash).",
      "parentUuid": "4a5ca220_45ad4ef0",
      "range": {
        "startLine": 119,
        "startChar": 12,
        "endLine": 119,
        "endChar": 17
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5689000d_4bd643e2",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 119,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "OK -- let\u0027s drop the readback check entirely.",
      "parentUuid": "d18826a7_7345ba56",
      "range": {
        "startLine": 119,
        "startChar": 12,
        "endLine": 119,
        "endChar": 17
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cb6f2ae8_d4d9b892",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 128,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2019-07-31T17:24:30Z",
      "side": 1,
      "message": "is it the same for firmware and kernel spaces? that may be completely coincidental, and after some update we may want ver2 for one and ver3 for the other, and the size and offset_crc may depend on the ver (while both versions are acceptable).\nI\u0027m not sure having a single version for dealing with both firmware and kernel spaces is a good thing, despite their current similarities. they don\u0027t have to stay similar in the future.",
      "range": {
        "startLine": 127,
        "startChar": 1,
        "endLine": 128,
        "endChar": 15
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "349cf8a5_423114bd",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 128,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-31T19:55:33Z",
      "side": 1,
      "message": "This hack has been in here since at least 2013 (meaning the legacy devices that needed it are even older). Nothing we\u0027re still using cares about this. Just drop it.",
      "parentUuid": "cb6f2ae8_d4d9b892",
      "range": {
        "startLine": 127,
        "startChar": 1,
        "endLine": 128,
        "endChar": 15
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "802db78d_ab64504e",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 128,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "Done, again in a separate CL.",
      "parentUuid": "349cf8a5_423114bd",
      "range": {
        "startLine": 127,
        "startChar": 1,
        "endLine": 128,
        "endChar": 15
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6e902fea_3fd4d627",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 153,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-07-31T19:55:33Z",
      "side": 1,
      "message": "Don\u0027t we just wanna drop this completely while we\u0027re at it? This is all done in 2secdata.c now AFAIK. The firmware space code in here is dead. (And also, as we refactor the kernel space stuff we should move it into 2secdatak.c and vb2-ify the conventions.)",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4b12b25e_295ff2e5",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 153,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-01T08:51:50Z",
      "side": 1,
      "message": "Unless I\u0027m mistaken -- we still need to read and write firmware space when in recovery mode, to enable developer mode.\n\nRe. moving to 2secdata.c: The read/write functions should still live in depthcharge eventually, right?  But yeah, we could move it to 2secdata.c for now.",
      "parentUuid": "6e902fea_3fd4d627",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1780ce68_1d48b6af",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 153,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-08-06T06:28:14Z",
      "side": 1,
      "message": "Good point, forgot that.\n\nI think this should eventually work the way it does for the coreboot part, with depthcharge initializing context secdata before calling vboot (with persistent context that would already be there anyway), and then depthcharge writing the context secdata back out to the TPM after vboot is finished if the secdata_changed flag is set. Over what steps we get there is up to you.",
      "parentUuid": "4b12b25e_295ff2e5",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a21b304_4209dc10",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 153,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "Once we get the persistent vb2_context hooked up, we shouldn\u0027t even need to perform the initialization.  But yeah, I agree that this stuff should live in depthcharge eventually.  I think it\u0027s simpler to shuffle code around inside of vboot_reference initially.",
      "parentUuid": "1780ce68_1d48b6af",
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "131b32b2_0f7962f7",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 157,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2019-07-31T17:24:30Z",
      "side": 1,
      "message": "if we go this route, can we encapsulate {index, space_size, offset_ver, offset_crc, and possible expected attrs} in some AntirollbackSpaceDescr structure and just pass the index in the global const array of those structs to Read[Antirollback]Space and Write[Antirollback]Space to fully define what space we want and its characteristics.",
      "range": {
        "startLine": 155,
        "startChar": 18,
        "endLine": 157,
        "endChar": 41
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e3236519_067309dc",
        "filename": "firmware/lib/rollback_index.c",
        "patchSetId": 3
      },
      "lineNbr": 157,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-08-06T09:19:58Z",
      "side": 1,
      "message": "After removing the retry code, the read/write functions become small enough that they don\u0027t really need a helper function anymore.",
      "parentUuid": "131b32b2_0f7962f7",
      "range": {
        "startLine": 155,
        "startChar": 18,
        "endLine": 157,
        "endChar": 41
      },
      "revId": "bcd36b8be8c27b176e22ab04c6c982ac5ffdf1db",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}