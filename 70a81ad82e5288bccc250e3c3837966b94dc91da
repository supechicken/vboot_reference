{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ca8b5632_e7dd13a2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1270601
      },
      "writtenOn": "2024-10-15T16:27:35Z",
      "side": 1,
      "message": "Nice find!",
      "revId": "70a81ad82e5288bccc250e3c3837966b94dc91da",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c95cded_c7a08cec",
        "filename": "scripts/image_signing/make_dev_ssd.sh",
        "patchSetId": 1
      },
      "lineNbr": 210,
      "author": {
        "id": 1192536
      },
      "writtenOn": "2024-10-15T16:18:39Z",
      "side": 1,
      "message": "This seems right as far as it goes, but should fflash and cros flash also do an fsync at the end of writing the partition to ensure all their blocks are on disk?  Otherwise the same sort of window could happen if they reboot immediately after writing the partition, right?",
      "revId": "70a81ad82e5288bccc250e3c3837966b94dc91da",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d94082a_90e79cb9",
        "filename": "scripts/image_signing/make_dev_ssd.sh",
        "patchSetId": 1
      },
      "lineNbr": 210,
      "author": {
        "id": 1270601
      },
      "writtenOn": "2024-10-15T16:27:35Z",
      "side": 1,
      "message": "Does this code get called when working on a `.bin`?",
      "range": {
        "startLine": 210,
        "startChar": 2,
        "endLine": 210,
        "endChar": 35
      },
      "revId": "70a81ad82e5288bccc250e3c3837966b94dc91da",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e50b51a1_3ab29cbd",
        "filename": "scripts/image_signing/make_dev_ssd.sh",
        "patchSetId": 1
      },
      "lineNbr": 210,
      "author": {
        "id": 1303279
      },
      "writtenOn": "2024-10-15T16:31:08Z",
      "side": 1,
      "message": "We can always add more sync or fsync calls without breaking anything, but I don\u0027t think we need to in this case because both tools just use the normal `reboot` command to reboot:\n\ncros flash: http://cs/h/chrome-internal/chromeos/superproject/+/main:chromite/lib/remote_access.py?l\u003d638\n\nfflash: http://cs/h/chrome-internal/chromeos/superproject/+/main:src/platform/dev/contrib/fflash/internal/reboot.go?l\u003d66\n\nand `reboot` does a sync unless you pass a --no-sync option:\n\nhttps://man.archlinux.org/man/core/systemd-sysvcompat/reboot.8.en",
      "parentUuid": "3c95cded_c7a08cec",
      "revId": "70a81ad82e5288bccc250e3c3837966b94dc91da",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e62696c4_83faf446",
        "filename": "scripts/image_signing/make_dev_ssd.sh",
        "patchSetId": 1
      },
      "lineNbr": 210,
      "author": {
        "id": 1303279
      },
      "writtenOn": "2024-10-15T16:46:36Z",
      "side": 1,
      "message": "It does get called when updating both a regular disk partition and a partition on a .bin file.\n\nThe existing \u0027sync \u0026\u0026 sync \u0026\u0026 sync\u0027 code gets called in the .bin case as well.\n\nWe could potentially test if we\u0027re updating a .bin and avoid the sync \u0026 cache flush in that case, but I\u0027m not sure if it\u0027s worth the extra complexity.  Those operations should never be harmful, and at worst case could cause a performance drop because we\u0027ve just caused a bunch of disk write operations and cleared out our page cache.  I personally think it\u0027s a rare enough occurrence and the performance implications are low enough that we\u0027re better off keeping the calls unconditional \u0026 saving complexity.",
      "parentUuid": "1d94082a_90e79cb9",
      "range": {
        "startLine": 210,
        "startChar": 2,
        "endLine": 210,
        "endChar": 35
      },
      "revId": "70a81ad82e5288bccc250e3c3837966b94dc91da",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "343b770a_c01f8f85",
        "filename": "scripts/image_signing/make_dev_ssd.sh",
        "patchSetId": 1
      },
      "lineNbr": 210,
      "author": {
        "id": 1270601
      },
      "writtenOn": "2024-10-15T16:55:16Z",
      "side": 1,
      "message": "Does `echo 1 \u003e /proc/sys/vm/drop_caches` require running as root? When working on a .bin we shouldn\u0027t require running as root.",
      "parentUuid": "e62696c4_83faf446",
      "range": {
        "startLine": 210,
        "startChar": 2,
        "endLine": 210,
        "endChar": 35
      },
      "revId": "70a81ad82e5288bccc250e3c3837966b94dc91da",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}