{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0d1d2018_5598b28e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 8,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "Could you explain why changing the return type of these functions (`find_firmware_section` in updater_utils.c, `update_ec_firmware` in updater.c and more) is better? For functions `*_exists`, `has_*` or `is_*`, I think it\u0027s clear from the function name that it returns a bool. However, for other functions I don\u0027t see the benefit of returning a bool.\n\nIf we want to prevent adding error code 1 to error code -1, we can always write `errorcnt +\u003d !!func()` instead of `errorcnt +\u003d func()` for `func` returning an int. Actually, I don\u0027t quite understand why we need to keep track of the number of errors in the first place. Can\u0027t we just return `!!errorcnt` for each function (such as `updater_setup_config`)?",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9a96bf8_1331d23d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 8,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T09:40:41Z",
      "side": 1,
      "message": "First of all, boolean type narrows returns value domain to two values, and (IMO) is more readable for programmer. true means success, false means failure. With integer you have to always look at function documentation to be sure that for function A() zero is success and for B() non zero is success. Moreover, functions can be written (and indirectly are) to return bool. `!!` operator basically casts int to bool anyway, so why use integer instead?\nRegarding errors count - I too think it\u0027s pointless most of the time, because of `return !!errorcnt`. Also, as per commit message - some functions were returning `1` as \"number of errors\", others were returning `-1` as failure, and adding them to `errorcnt` could lead to two errors equaling to success `1 + -1 \u003d\u003d 0`. That\u0027s the second argument for removing integers whenever possible.\n\n\u003e If we want to prevent adding error code 1 to error code -1, we can always write `errorcnt +\u003d !!func()` instead...\n\u003e Can\u0027t we just return `!!errorcnt` for each function (such as `updater_setup_config`)?\n\nThat\u0027s what I do not understand. Why to use `!!` everywhere if boolean does the trick automatically and is also universally accepted as success/failure indicator. It also removes need for adding errors. Just check return value and `goto` or `return`.\n\nMaybe there is a benefit in using integer which I do not see. Maybe it\u0027s just C programmer\u0027s habit. I think, there is more benefit in using `bool` instead of `int` these days, as it carries context information without need for looking for documentation so often. But that\u0027s my preference, and I\u0027m open to discussion :D",
      "parentUuid": "0d1d2018_5598b28e",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c513d630_082dda58",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 8,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-27T04:36:40Z",
      "side": 1,
      "message": "\u003e With integer you have to always look at function documentation to be sure that for function A() zero is success and for B() non zero is success.\n\nIn C convention the return value 0 (for int) should always mean success. Therefore I couldn\u0027t agree more to change the return type of functions violating that (such as `has_valid_update`) to bool. However this argument doesn\u0027t justify changing the return type of other functions such as `update_ec_firmware`.\n\nI think for functions other than `*_exists`/`has_*`/`is_*`, for example `write_firmware`, returning an int (or some equivalent enum such as cb_err in coreboot) is the standard in C. One benefit of having multiple possible return values is that different non-zero error codes could be used, which is sometimes useful.\n\n\u003e ... `1 + -1 \u003d\u003d 0`. That\u0027s the second argument for removing integers whenever possible.\n\nFor `errorcnt +\u003d !!func()`, the caller needs `!!` only because it wants to maintain the error count. If we all agree that the caller doesn\u0027t have to count the errors, then changing it to `if (func()) return/goto` should be sufficient in most cases. I still don\u0027t see why we need to change the return type of `func` in this case.\n\nIn other cases where the caller wants to continue the flow on function call failure:\n\n```\nerrorcnt +\u003d !!func1();\nerrorcnt +\u003d !!func2();\nerrorcnt +\u003d !!func3();\n```\n\nwriting `if (func1()) ret \u003d -1;` would be lengthy. One trick is to use `ret |\u003d func1();`. Then the problem of `1 + -1` could be elegantly solved.",
      "parentUuid": "a9a96bf8_1331d23d",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "685dd1f7_417e3a09",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 8,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-04-06T13:03:26Z",
      "side": 1,
      "message": "I partially agree with you. After more thinking I see that my changes are too radical and were not fully thought out. Explicitly binary functions like `*_exists`/`has_*`/`is_*` can use `bool`, other functions do not have or need to.\n\nI still however do not like convention with `-1` as return value. POSIX APIs use `-1` together with `errno`, and futility does not do this for obvious reasons. I changed functions to use `1` instead whenever possible as it can be then used as default error value and larger integer values can be used as more specific error code if necessary (futility code is not shared with any other project, so we do not have to care about it much though).",
      "parentUuid": "c513d630_082dda58",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2943f565_7f320b16",
        "filename": "futility/cmd_flash_util.c",
        "patchSetId": 5
      },
      "lineNbr": 218,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2023-03-21T16:39:51Z",
      "side": 1,
      "message": "There is no need to free servo_programmer which is done under out_free label",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4516def6_79ffe4c1",
        "filename": "futility/cmd_flash_util.c",
        "patchSetId": 5
      },
      "lineNbr": 218,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-22T14:12:57Z",
      "side": 1,
      "message": "I agree, but `free(NULL) \u003d\u003d if + return`, so there is almost no cost. All jumps to `out_free` however require call to `updater_delete_config(cfg)` to free configuration resources. I could move `out_free` one line down, and add another one to jump to after `updater_setup_config(...)` failure, but it would unnecessarily (IMO) clutter the code.",
      "parentUuid": "2943f565_7f320b16",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd61ad6a_2d5a6a91",
        "filename": "futility/cmd_flash_util.c",
        "patchSetId": 5
      },
      "lineNbr": 218,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "+1 free(NULL) is legit and I see no problem with that.",
      "parentUuid": "4516def6_79ffe4c1",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6822b8b0_40c3e9d9",
        "filename": "futility/cmd_flash_util.c",
        "patchSetId": 5
      },
      "lineNbr": 218,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-04-06T13:03:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bd61ad6a_2d5a6a91",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c8f2acf7_57a6e7c7",
        "filename": "futility/cmd_read.c",
        "patchSetId": 5
      },
      "lineNbr": 134,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "align",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a5091468_72b0b9f5",
        "filename": "futility/cmd_read.c",
        "patchSetId": 5
      },
      "lineNbr": 134,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T10:51:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c8f2acf7_57a6e7c7",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57010db3_9cfde16b",
        "filename": "futility/cmd_update.c",
        "patchSetId": 5
      },
      "lineNbr": 116,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "Can we have a separate CL for the help text change?",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3e4fd08e_d8e3f64a",
        "filename": "futility/cmd_update.c",
        "patchSetId": 5
      },
      "lineNbr": 116,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T10:51:14Z",
      "side": 1,
      "message": "Done in CL:4370239",
      "parentUuid": "57010db3_9cfde16b",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9be09906_ba2a142f",
        "filename": "futility/updater.c",
        "patchSetId": 5
      },
      "lineNbr": 1656,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "The archive is set up above, not here.",
      "range": {
        "startLine": 1656,
        "startChar": 4,
        "endLine": 1656,
        "endChar": 18
      },
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5d7d7501_c69d180d",
        "filename": "futility/updater.c",
        "patchSetId": 5
      },
      "lineNbr": 1656,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T10:51:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9be09906_ba2a142f",
      "range": {
        "startLine": 1656,
        "startChar": 4,
        "endLine": 1656,
        "endChar": 18
      },
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d550e55_84b33b58",
        "filename": "futility/updater.c",
        "patchSetId": 5
      },
      "lineNbr": 1658,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "Moving this here changes the behavior, because now the image will be loaded from the files within the archive. See the previous [change](https://chromium-review.googlesource.com/c/chromiumos/platform/vboot_reference/+/1278419/9/futility/updater.c#1784) which moves the function call.\n\nI don\u0027t quite understand the logic behind that change though. If you still want to move the function call like this, I\u0027d prefer a separate CL (and add hungte@ as a reviewer). If it turns out that we shouldn\u0027t move it, I think we either need a test case to cover that, or explicitly pass `archive\u003dNULL` to `updater_load_images`, so that people won\u0027t accidentally do the same mistake in the future.",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f611f83a_fdd62d3f",
        "filename": "futility/updater.c",
        "patchSetId": 5
      },
      "lineNbr": 1658,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T09:40:41Z",
      "side": 1,
      "message": "I\u0027m sorry. This revert-like change was not intentional. I must have moved it by accident. I will move it back in the next CL version.",
      "parentUuid": "3d550e55_84b33b58",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2aa4687f_31d90991",
        "filename": "futility/updater.c",
        "patchSetId": 5
      },
      "lineNbr": 1658,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T10:51:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f611f83a_fdd62d3f",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "33626f50_92dfb125",
        "filename": "futility/updater.h",
        "patchSetId": 5
      },
      "lineNbr": 114,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "Extra space.",
      "range": {
        "startLine": 114,
        "startChar": 6,
        "endLine": 114,
        "endChar": 7
      },
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fae5f7a3_3ec4e7c3",
        "filename": "futility/updater.h",
        "patchSetId": 5
      },
      "lineNbr": 114,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T10:51:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "33626f50_92dfb125",
      "range": {
        "startLine": 114,
        "startChar": 6,
        "endLine": 114,
        "endChar": 7
      },
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "67aac341_7da0bfa3",
        "filename": "futility/updater_utils.h",
        "patchSetId": 5
      },
      "lineNbr": 219,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-03-24T08:46:43Z",
      "side": 1,
      "message": "align. can be moved to the previous line.",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ec74e498_f1edfaa4",
        "filename": "futility/updater_utils.h",
        "patchSetId": 5
      },
      "lineNbr": 219,
      "author": {
        "id": 1512562
      },
      "writtenOn": "2023-03-24T10:51:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "67aac341_7da0bfa3",
      "revId": "c785fb9446d7242300145a9afa7b4025327cab67",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}