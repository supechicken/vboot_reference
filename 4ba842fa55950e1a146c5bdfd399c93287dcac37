{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "30fa2ecf_08fdc880",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 223,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-09-15T21:58:59Z",
      "side": 1,
      "message": "I think it\u0027s fine to return the actual amount of meaningful bytes (i.e. 4). The caller knows that we\u0027re filling up the rest with zeroes so it\u0027s still allowed to treat it as a larger value if it wants to.",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d700f27_e24a90d7",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 223,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-09-19T10:00:25Z",
      "side": 1,
      "message": "There is a little problem in the coreboot code:\n\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/third_party/coreboot/src/security/vboot/tpm_common.c;drc\u003dd972ca53015e67feaf3e54946098ccb33ba5d7bb;l\u003d32\n\nIt will check the output size is not smaller than 20 bytes, if we \"trim\" the digest size to 4 bytes, it will fail.\n\nShould we remove the check in the coreboot side?",
      "parentUuid": "30fa2ecf_08fdc880",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "69e4d4c3_d9722547",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 223,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-09-20T07:11:05Z",
      "side": 1,
      "message": "Yes I think we can remove the check in coreboot.",
      "parentUuid": "9d700f27_e24a90d7",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f2d4041b_b0accb4b",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 223,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-09-20T21:17:58Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "69e4d4c3_d9722547",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "01e5724e_28fbc09f",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 223,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-09-22T05:32:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f2d4041b_b0accb4b",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5db353da_9107b304",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 223,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-09-22T05:33:16Z",
      "side": 1,
      "message": "BTW, I sent out\nhttps://review.coreboot.org/c/coreboot/+/78084\nfor review.",
      "parentUuid": "01e5724e_28fbc09f",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6fc76462_84fba09a",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 243,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-09-15T21:58:59Z",
      "side": 1,
      "message": "So upon closer inspection, this is unfortunately more complicated.\n\nWe track two values for each version in vb2_shared_data: sd-\u003efw_version_secdata and sd-\u003ekernel_version_secdata are each the values that were stored in the TPM before we started booting. sd-\u003efw_version is the version of the currently booting firmware (which is also always the version we wrote back to the TPM as long as the previous boot was FW_RESULT_SUCCESS). So far, so good.\n\nsd-\u003ekernel_version is unfortunately more complicated. It is the version that we wrote back to the TPM at the end of this boot (if we are in secure mode). That version is sometimes, but not always, exactly the same version as the one from the kernel we are booting. In cases where it is limited by maxrollforward, and in cases where we are currently trying out a new kernel but still allowing potential rollback to an older kernel if the try counter runs out, it may be lower than that.\n\nThis is all pretty messy so it would probably be good to do a more comprehensive overhaul even if it will be a bit more effort. We should really store 3 separate values in vb2_shared_data for both firmware and kernel:\n\n1. The value stored in the TPM at the start of the boot\n2. The value stored in the TPM at the end of the boot\n3. The value of the currently booted firmware\n\nWe should ideally make all of them available in crossystem (on supporting boards), and also try to come up with clearer names for each of them (that we should consistently use both in crossystem and in vb2_shared_data, and then deprecate the old crossystem names).\n\nThere\u0027s currently an unused 8 byte reserved field in vb2_shared_data, so we could put the extra two values in there and call it a backwards-compatible minor version bump.",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1bbd181c_8b36638f",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 243,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-09-19T09:15:04Z",
      "side": 1,
      "message": "Also see b/269204332.",
      "parentUuid": "6fc76462_84fba09a",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5445da30_0a76bc82",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 243,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2023-09-20T07:11:05Z",
      "side": 1,
      "message": "\u003e then deprecate the old crossystem names\n\n`crossystem tpm_kernver` looks like a perfect name for the active TPM kernal version (the value stored in the TPM at the end of the boot), so maybe it\u0027s okay to reuse it? The bug (b/269204332) has been existing for a long time, and that doesn\u0027t seem to cause any issue. Therefore it should be fine to just \"fix\" that for new devices, I think. And then `crossystem kernver` can be the value of currently booted firmware.\n\nAlso, I can\u0027t think of any case where we need \"The value stored in the TPM at the start of the boot\".",
      "parentUuid": "1bbd181c_8b36638f",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4eff82e5_2bcc9f57",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 243,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-09-20T21:17:58Z",
      "side": 1,
      "message": "Names are open to discussion, I don\u0027t have a strong opinion, let\u0027s just make sure it\u0027s clear at first glance which one is which. Maybe `tpm_kernver`, `tpm_kernver_prev` and `act_kernver`?\n\nI don\u0027t know if anyone needs the start-of-boot one, but we already have it in vb2_shared_data anyway and we presumably don\u0027t want to change that. I guess we don\u0027t need to expose it through crossystem if there\u0027s no use case for that.",
      "parentUuid": "5445da30_0a76bc82",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81fade6c_764d82da",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 243,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-09-22T11:12:54Z",
      "side": 1,
      "message": "I tried to write a CL for that:\nhttps://chromium-review.googlesource.com/c/chromiumos/platform/vboot_reference/+/4877902\n\nBut I\u0027m not sure if I understand the vboot code correctly or not....",
      "parentUuid": "4eff82e5_2bcc9f57",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ab96aa18_4d48f95a",
        "filename": "firmware/2lib/2api.c",
        "patchSetId": 9
      },
      "lineNbr": 243,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-12-04T07:22:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "81fade6c_764d82da",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "227ad4ce_c19daa6d",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 9
      },
      "lineNbr": 112,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2023-09-15T21:58:59Z",
      "side": 1,
      "message": "It\u0027s not really a digest anymore.",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "19795383_f7a2a527",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 9
      },
      "lineNbr": 112,
      "author": {
        "id": 1293547
      },
      "writtenOn": "2023-09-19T10:00:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "227ad4ce_c19daa6d",
      "revId": "4ba842fa55950e1a146c5bdfd399c93287dcac37",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}