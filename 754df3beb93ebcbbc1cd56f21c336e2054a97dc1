{
  "comments": [
    {
      "key": {
        "uuid": "44034c29_0bcdc3bc",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-12-04T07:25:02Z",
      "side": 1,
      "message": "Are these changes also being implemented in coreboot EC sync?",
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22ea457e_3c4e50d5",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 5
      },
      "lineNbr": 8,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-12-04T07:25:02Z",
      "side": 1,
      "message": "New line after system includes.",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 8,
        "endChar": 20
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e8af5a7d_35180693",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 5
      },
      "lineNbr": 118,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-12-04T07:25:02Z",
      "side": 1,
      "message": "Probably choose one of \"is\" or \"in\"?",
      "range": {
        "startLine": 118,
        "startChar": 12,
        "endLine": 118,
        "endChar": 34
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87184ffd_f815c04f",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 5
      },
      "lineNbr": 210,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-12-04T07:25:02Z",
      "side": 1,
      "message": "Might be better to explain what is NO_BOOT (and perhaps even move the matrix to another location).",
      "range": {
        "startLine": 206,
        "startChar": 0,
        "endLine": 210,
        "endChar": 30
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fd749a81_55b4df56",
        "filename": "firmware/2lib/include/2secdata_struct.h",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1283719
      },
      "writtenOn": "2019-12-03T20:49:05Z",
      "side": 1,
      "message": "Like vb2_secdata_fwmp struct below, this struct should tell itself where the crc locates, I think. It would be simple for CR50 to check the crc with any version of this struct.",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a47a6644_dbddab70",
        "filename": "firmware/2lib/include/2secdata_struct.h",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-12-03T21:56:56Z",
      "side": 1,
      "message": "I think there are two reasonable ways we can move forward with this struct. One would be to add the ec_hash[] *behind* the CRC so that it would be fully backwards-compatible, which would make it easier for code that needs to support both versions. The other would be to rearrange everything, which allows us to fix some of the bad design choices in the original struct (e.g. misaligned members, and then we would probably also add a \u0027size\u0027 field and move the CRC closer to the top like for FWMP). Not quite sure which option is better.",
      "parentUuid": "fd749a81_55b4df56",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "302686e4_4ac519f0",
        "filename": "firmware/2lib/include/2secdata_struct.h",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-12-04T07:25:02Z",
      "side": 1,
      "message": "Do we read vb2_secdata_kernel in userspace anywhere?",
      "parentUuid": "a47a6644_dbddab70",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7fde03ae_82ce8133",
        "filename": "firmware/2lib/include/2secdata_struct.h",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-12-05T00:23:02Z",
      "side": 1,
      "message": "See crbug.com/1020578",
      "parentUuid": "302686e4_4ac519f0",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6317ca9_89f232f7",
        "filename": "firmware/2lib/include/2secdata_struct.h",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1106949
      },
      "writtenOn": "2019-12-05T00:56:04Z",
      "side": 1,
      "message": "At ToT, can\u0027t we deprecate the current structure (since Hatch branched)?\n\nCr50 firmware needs to support both but it\u0027s just a blob for the current version. The parsing is needed only for the new version.\n\nShall we do the rearrange (and get ec_hash also check-sum\u0027ed)?",
      "parentUuid": "7fde03ae_82ce8133",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7aef4990_1eaf3840",
        "filename": "firmware/2lib/include/2secdata_struct.h",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2019-12-05T01:31:55Z",
      "side": 1,
      "message": "No, we like to keep ToT support for older devices around for some time. We\u0027ll need some form of backwards-compatibility here.\n\n\u003e One would be to add the ec_hash[] *behind* the CRC so that it would be fully backwards-compatible\n\nOn second thought this doesn\u0027t really work, because then either the CRC also covers the EC hash (meaning it\u0027s not fully backwards-compatible) or the EC hash is not CRC-checked, neither of which is really acceptable. So I think the best course is to just rewrite the whole structure from scratch and support two structure layouts.\n\nI\u0027d suggest something like\n\n struct vb2_secdata_kernel_v2 {\n   uint8_t struct_version;\n   uint8_t struct_size;\n   uint8_t crc;\n   uint8_t reserved0;\n   uint32_t kernel_versions;\n   uint8_t ec_hash[VB2_SHA256_DIGEST_SIZE];\n }\n\nThe UID thing isn\u0027t necessary for TPM 2.0 anymore and can be dropped. We should treat the struct_version as 4 bits major / 4 bits minor like FWMP, so the new struct version here should be 0x10 (1.0 which makes the current one 0.2).",
      "parentUuid": "e6317ca9_89f232f7",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2dfb75e9_c5768b73",
        "filename": "firmware/2lib/include/2secdata_struct.h",
        "patchSetId": 5
      },
      "lineNbr": 60,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-12-05T08:55:12Z",
      "side": 1,
      "message": "Sounds like if we want to keep backwards-compatibility, the only option would be to add *another* CRC field, which would cover everything from the new ec_hash field onwards.  This feels complex enough to warrant just rewriting the struct, as Julius has suggested.\n\nWe wouldn\u0027t need to bother keeping support for the v1 struct in firmware code.  And if we only have three other locations that need to read vb2_secdata_kernel, then seems not so terrible to add support for both versions there.",
      "parentUuid": "7aef4990_1eaf3840",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59bba57f_40f36a7c",
        "filename": "firmware/lib/vboot_api_kernel.c",
        "patchSetId": 5
      },
      "lineNbr": 450,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2019-12-04T07:25:02Z",
      "side": 1,
      "message": "Could we create a new error for this?",
      "range": {
        "startLine": 450,
        "startChar": 7,
        "endLine": 450,
        "endChar": 24
      },
      "revId": "754df3beb93ebcbbc1cd56f21c336e2054a97dc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}