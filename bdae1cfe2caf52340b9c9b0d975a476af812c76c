{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "05806096_6a613696",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1314845
      },
      "writtenOn": "2020-12-02T22:25:47Z",
      "side": 1,
      "message": "Friendly ping",
      "revId": "bdae1cfe2caf52340b9c9b0d975a476af812c76c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "77ac2128_68402104",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-12-02T23:56:58Z",
      "side": 1,
      "message": "Actually I\u0027m surprised that we\u0027re setting this manually at all. I would\u0027ve thought portage decides somewhere globally whether it builds stuff PIE/PIC and passes respective flags through CFLAGS. Does it not do that, or are we just not letting that option come through correctly in the vboot ebuild? I think +vapier would know...\n\nI\u0027m also not sure why we\u0027re only providing the hostlib as a static library anyway. If it was shared, we wouldn\u0027t have this problem (or rather we\u0027d probably already have had this problem for existing use cases), right? Shouldn\u0027t libraries always be dynamic unless there\u0027s a good reason not to?\n\nI guess this seems like a step in the right direction but vboot is still a huge mess that I just wish someone would untangle one day... ^^",
      "revId": "bdae1cfe2caf52340b9c9b0d975a476af812c76c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c4bdb984_e0e87dc5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1314845
      },
      "writtenOn": "2020-12-03T01:06:14Z",
      "side": 1,
      "message": "\u003e  would\u0027ve thought portage decides somewhere globally whether it builds stuff PIE/PIC and passes respective flags through CFLAGS. \n\nYep, that\u0027s generally what is done, but the Makefile explicitly ignores flags from outside: https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay/+/d3dba5d427f72b49fdde71aca720a8fdae9e7377/chromeos-base/vboot_reference/vboot_reference-9999.ebuild#31\n\n\u003e I\u0027m also not sure why we\u0027re only providing the hostlib as a static library anyway. If it was shared, we wouldn\u0027t have this problem (or rather we\u0027d probably already have had this problem for existing use cases), right? Shouldn\u0027t libraries always be dynamic unless there\u0027s a good reason not to?\n\nYes, we should definitely be building a dynamic library.",
      "parentUuid": "77ac2128_68402104",
      "revId": "bdae1cfe2caf52340b9c9b0d975a476af812c76c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dec169d7_f012a9ba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-12-03T01:49:37Z",
      "side": 1,
      "message": "\u003e Yep, that\u0027s generally what is done, but the Makefile explicitly ignores flags from outside: \n\nWell, the Makefile actually doesn\u0027t, the Makefile would take those flags. It\u0027s the ebuild that calls `unset CFLAGS` before running make. That line seems to be one of the oldest lines in that file (2011) and the original justification seems to have been that it can\u0027t link with U-Boot when using different flags (https://code.google.com/archive/p/chromium-os/issues/16808). Nowadays all our firmware code builds their own version of vboot directly and doesn\u0027t use the vboot_reference ebuild anymore, so that justification is definitely gone.\n\nIn general, I don\u0027t really see a reason why the userspace parts of vboot (which is all that ebuild does) shouldn\u0027t be using host CFLAGS. Maybe we should just try it and see if it works?",
      "parentUuid": "c4bdb984_e0e87dc5",
      "revId": "bdae1cfe2caf52340b9c9b0d975a476af812c76c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17c72ea1_0dc4db8b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1314845
      },
      "writtenOn": "2020-12-03T16:26:12Z",
      "side": 1,
      "message": "\u003e In general, I don\u0027t really see a reason why the userspace parts of vboot (which is all that ebuild does) shouldn\u0027t be using host CFLAGS. Maybe we should just try it and see if it works?\n\nAh, ok, it wasn\u0027t clear to me whether this ebuild was userspace only. If that\u0027s the case, then we probably should be using flags from the ebuild. It\u0027s easy enough to test.\n\nHow do the firmware builds use vboot_reference? I see references to FIRMWARE_ARCH determining if it\u0027s a firmware build. Looks like maybe the ebuild is pulling in the source here: https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay/+/d3dba5d427f72b49fdde71aca720a8fdae9e7377/sys-boot/coreboot/coreboot-9999.ebuild#12.",
      "parentUuid": "dec169d7_f012a9ba",
      "revId": "bdae1cfe2caf52340b9c9b0d975a476af812c76c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0470baa6_3438c11e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-12-04T22:34:33Z",
      "side": 1,
      "message": "Yes, they\u0027re using CROS_WORKON_PROJECT to pull the vboot sources directly into their work tree and build their own specific version in there. The respective Makefile rules doing that are here: https://review.coreboot.org/plugins/gitiles/coreboot/+/refs/heads/master/src/security/vboot/Makefile.inc (depthcharge has something similar)",
      "parentUuid": "17c72ea1_0dc4db8b",
      "revId": "bdae1cfe2caf52340b9c9b0d975a476af812c76c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}