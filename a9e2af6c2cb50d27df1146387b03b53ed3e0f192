{
  "comments": [
    {
      "key": {
        "uuid": "b7d4c4c0_c2305576",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 2
      },
      "lineNbr": 193,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "Hmm.. it\u0027d be really nice if we could do something here like:\n\n  if (vb2_reboot_needed(rv))\n    return rv;\n\nOr maybe even merge that into our VB2_TRY logic...\n\n  /* Doesn\u0027t call vb2api_fail when VB2_ERROR_REBOOT_* returned. */\n  VB2_TRY(vb2ex_ec_update_image(select), ctx, VB2_RECOVERY_EC_UPDATE);\n\nWhat do you think?\n\nAt the same time, we could move VBERROR_*_REBOOT_*_REQUIRED over to vboot2 namespace, ensuring they\u0027re all contiguous.",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 193,
        "endChar": 45
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c7f0954_0f0715ff",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 2
      },
      "lineNbr": 193,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2020-04-01T23:48:52Z",
      "side": 1,
      "message": "Hmm... maaaybe. I can see the appeal of that idea. But it\u0027s also putting a lot of implicit magic into VB2_TRY(), I\u0027m not sure if that might make it too hard for people to follow. (Then again, the risk is basically just that we would forget to set a recovery reason in some cases and we really never should need to set one for any of those error codes...)\n\nHave you checked how many places in vboot could make use of that special case? If it would save us a lot of boilerplate I would be more inclined to do it than if it would just trigger in this one spot and nowhere else.\n\nAlso, if we do go that route we definitely need to create a separate return code namespace there... i.e. those values should no longer be called VB2_ERROR_xxx then, they should be something else that makes it more obvious that they are not errors (maybe VB2_RESULT_xxx or something like that, or maybe just VB2_REBOOT_REQUESTED). And also put them numerically far away from the real error codes.",
      "parentUuid": "b7d4c4c0_c2305576",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 193,
        "endChar": 45
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e5b2587_97f6c907",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 2
      },
      "lineNbr": 193,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-04-08T11:16:25Z",
      "side": 1,
      "message": "The only places it would be useful:\n\n  protect_ec()\n  update_ec()\n  sync_ec()\n  update_auxfw()\n\nSo it\u0027s probably not terribly important to introduce directly into VB2_TRY.  Might still be useful to have a vb2_reboot_requested(rv) helper function so we don\u0027t need to check against specific REBOOT_REQUIRED values in these few cases.\n\nBut we still want to convert VBERROR_*_REBOOT stuff over to vboot2 namespace.  I\u0027m not to concerned on the naming -- if we want to use VB2_RESULT_ or VB2_ERROR_.  But yes, they can definitely live numerically far away from the other error codes.  Yu-Ping, would you be able to look at this?\n\nThere is also a lot of code which calls request_recovery() and then returns VBERROR_EC_REBOOT_TO_RO_REQUIRED.  If the goal is to get into the BROKEN screen, I don\u0027t think it makes sense to return REBOOT_TO_RO_REQUIRED... we should probably fix that while we convert everything to use vb2api_fail() instead.",
      "parentUuid": "0c7f0954_0f0715ff",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 193,
        "endChar": 45
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "771bd781_9e6b301d",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 2
      },
      "lineNbr": 193,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "- 3 reboot-related errors moved to vboot namespace.\n- Function reboot_needed() added.",
      "parentUuid": "1e5b2587_97f6c907",
      "range": {
        "startLine": 192,
        "startChar": 0,
        "endLine": 193,
        "endChar": 45
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "27caff45_1a4a52a9",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 2
      },
      "lineNbr": 194,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "Can we just call vb2api_fail here instead, and get rid of the helper function?",
      "range": {
        "startLine": 194,
        "startChar": 3,
        "endLine": 194,
        "endChar": 19
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2acc55b6_448380a4",
        "filename": "firmware/2lib/2ec_sync.c",
        "patchSetId": 2
      },
      "lineNbr": 194,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "27caff45_1a4a52a9",
      "range": {
        "startLine": 194,
        "startChar": 3,
        "endLine": 194,
        "endChar": 19
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "951a544c_7a2227d0",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 2
      },
      "lineNbr": 459,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "Maybe we should start calling this locale_id... or locale_index.",
      "range": {
        "startLine": 459,
        "startChar": 9,
        "endLine": 459,
        "endChar": 26
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e505e3ac_5b2006a1",
        "filename": "firmware/2lib/2misc.c",
        "patchSetId": 2
      },
      "lineNbr": 459,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "951a544c_7a2227d0",
      "range": {
        "startLine": 459,
        "startChar": 9,
        "endLine": 459,
        "endChar": 26
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5f842212_e329e9fd",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 2
      },
      "lineNbr": 805,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "the current locale",
      "range": {
        "startLine": 805,
        "startChar": 7,
        "endLine": 805,
        "endChar": 13
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "baeeefeb_6e07a2b7",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 2
      },
      "lineNbr": 805,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5f842212_e329e9fd",
      "range": {
        "startLine": 805,
        "startChar": 7,
        "endLine": 805,
        "endChar": 13
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "976a28bb_7d45eabb",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 2
      },
      "lineNbr": 808,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "@return?",
      "range": {
        "startLine": 808,
        "startChar": 2,
        "endLine": 808,
        "endChar": 3
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0a04b9a_9109c2cc",
        "filename": "firmware/2lib/include/2api.h",
        "patchSetId": 2
      },
      "lineNbr": 808,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "976a28bb_7d45eabb",
      "range": {
        "startLine": 808,
        "startChar": 2,
        "endLine": 808,
        "endChar": 3
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "58099719_b0071fbd",
        "filename": "tests/vb2_auxfw_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "Probably better to use a separate mock variable to make it clear that this has nothing to do with the vboot internal state.",
      "range": {
        "startLine": 71,
        "startChar": 0,
        "endLine": 72,
        "endChar": 34
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "82c14ed7_6d982434",
        "filename": "tests/vb2_auxfw_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "58099719_b0071fbd",
      "range": {
        "startLine": 71,
        "startChar": 0,
        "endLine": 72,
        "endChar": 34
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "450f07d2_3d208f5a",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 181,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "Probably better to use a separate mock variable to make it clear that this has nothing to do with the vboot internal state.",
      "range": {
        "startLine": 179,
        "startChar": 0,
        "endLine": 181,
        "endChar": 0
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9e072053_c0877742",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 181,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "450f07d2_3d208f5a",
      "range": {
        "startLine": 179,
        "startChar": 0,
        "endLine": 181,
        "endChar": 0
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "def6652e_3f075ca4",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 471,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "Might want to repeat this comment for both test cases (or add \" - RW\" and \" - RO\" to it).",
      "range": {
        "startLine": 471,
        "startChar": 0,
        "endLine": 471,
        "endChar": 28
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f537d67_8019f59f",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 471,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "def6652e_3f075ca4",
      "range": {
        "startLine": 471,
        "startChar": 0,
        "endLine": 471,
        "endChar": 28
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ba98521f_4e27b673",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 493,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-03-24T10:24:01Z",
      "side": 1,
      "message": "I think this should be 0 (RO) instead, but I\u0027m not sure how to correct it from this patch.\n\nThe original logic in sync_ec() is:\n 1. update_ec(RW) if needed\n 2. vb2ex_ec_jump_to_rw() if needed\n 3. update_ec(RO) if needed\n\nConsider the case where only steps #2 and #3 will be performed. Then, with this patchset, when display is not avaiable, VBERROR_REBOOT_REQUIRED will be returned in #3 (from vb2ex_ec_update_image()), but EC will have jumped to RW in #2 before warn reboot.",
      "range": {
        "startLine": 493,
        "startChar": 23,
        "endLine": 493,
        "endChar": 24
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0e33774a_bab1349f",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 493,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-03-25T09:23:28Z",
      "side": 1,
      "message": "If the logic is to jump to RW before updating RO, then ec_run_image will be set to 1?  Unless you\u0027re proposing to change the logic to check for potential RO updates before jumping to RW?",
      "parentUuid": "ba98521f_4e27b673",
      "range": {
        "startLine": 493,
        "startChar": 23,
        "endLine": 493,
        "endChar": 24
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8df723d7_c6b0dd65",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 493,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-03-26T02:37:32Z",
      "side": 1,
      "message": "\u003e Unless you\u0027re proposing to change the logic to check for potential RO updates before jumping to RW?\nI\u0027m saying that this patch is changing the logic. In situations where only RO needs to be updated but display is unavailable,\n\n- Before this CL, ec_will_update_slowly() will be 1 and vb2api_ec_sync() will return VBERROR_REBOOT_REQUIRED, so EC will NOT jump to RW.\n- After this CL, since we delay the check until vb2ex_ec_update_image(), sync_ec() will be called and EC will jump to RW.",
      "parentUuid": "0e33774a_bab1349f",
      "range": {
        "startLine": 493,
        "startChar": 23,
        "endLine": 493,
        "endChar": 24
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "072f195e_d4979469",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 493,
      "author": {
        "id": 1126709
      },
      "writtenOn": "2020-04-08T11:16:25Z",
      "side": 1,
      "message": "I see what you mean.  Since this is an edge case (only for dogfooders), I don\u0027t think we should be too concerned about slightly changing the logic here (\"when RO update is required, reboot for display init is triggered after jumping to RW rather than before\").  The end-result is the same (maybe slightly slower).",
      "parentUuid": "8df723d7_c6b0dd65",
      "range": {
        "startLine": 493,
        "startChar": 23,
        "endLine": 493,
        "endChar": 24
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e5bf101e_5f77d1f5",
        "filename": "tests/vb2_ec_sync_tests.c",
        "patchSetId": 2
      },
      "lineNbr": 493,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2020-04-09T08:37:47Z",
      "side": 1,
      "message": "Ack. If the logic is not that important, should we remove the check of ec_run_image here?",
      "parentUuid": "072f195e_d4979469",
      "range": {
        "startLine": 493,
        "startChar": 23,
        "endLine": 493,
        "endChar": 24
      },
      "revId": "a9e2af6c2cb50d27df1146387b03b53ed3e0f192",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}