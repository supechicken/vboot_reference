{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "78f8c33e_caa0ba03",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1267126
      },
      "writtenOn": "2022-10-18T22:24:02Z",
      "side": 1,
      "message": "The deprecated sysfs ABI doesn\u0027t have this problem, right? It looks like we need a \u0027gpiod\u0027 daemon that we send dbus messages to to ask for the state of a gpio, so that only one userspace process owns the pin.",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 15,
        "endChar": 10
      },
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "649322a7_f3c7d27f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 15,
      "author": {
        "id": 1000107
      },
      "writtenOn": "2022-10-18T22:47:37Z",
      "side": 1,
      "message": "We\u0027re using the deprecated ABI, though! See b/254329477. Oh, you mean the ABI that was deprecated before that (https://docs.kernel.org/admin-guide/gpio/sysfs.html). Right, I don\u0027t think it was a problem there because there was no locking. Userspace could freely step on each other.\n\nYes, we could make a daemon just for this. If you really think we should do this, feel free to file a bug. It feels like that would be a longer term effort, though?\n\nHonestly, though, if we\u0027re gonna make big changes I\u0027d rather see us actually export this as a bona-fide \"switch\" using gpio-keys. Then userspace could query the switch. They could also listen for changes to this switch... Did we think about doing that before and decided on exporting it as a GPIO, or did we not think about it before?",
      "parentUuid": "78f8c33e_caa0ba03",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 15,
        "endChar": 10
      },
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b7e02c7_f5a6d958",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2022-10-18T21:35:53Z",
      "side": 1,
      "message": "Lgtm with a question (see CIL)",
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aa9ef4a2_6f607872",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2022-10-18T22:23:48Z",
      "side": 1,
      "message": "fun fact: libgpiod doesn\u0027t handle EBUSY either. so score one (or is it a tie?) for rolling our own non-library",
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "718339eb_e336b5db",
        "filename": "host/arch/arm/lib/crossystem_arch.c",
        "patchSetId": 1
      },
      "lineNbr": 216,
      "author": {
        "id": 1152319
      },
      "writtenOn": "2022-10-18T21:35:53Z",
      "side": 1,
      "message": "so, the total wait in \"constant busy\" case before we give up is 50*(0+49)/2 ms \u003d 1.225 seconds. sounds probably ok, but double-checking.",
      "range": {
        "startLine": 216,
        "startChar": 2,
        "endLine": 216,
        "endChar": 24
      },
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0abfcb75_403a9aa1",
        "filename": "host/arch/arm/lib/crossystem_arch.c",
        "patchSetId": 1
      },
      "lineNbr": 216,
      "author": {
        "id": 1000107
      },
      "writtenOn": "2022-10-18T22:19:29Z",
      "side": 1,
      "message": "Yeah. I could lower it if desired (I don\u0027t think I ever saw even more than a single retry needed). To some extent I kinda like it being long but not too long. If somehow things got busted and this failed constantly (timing out every time) then running \"crossystem\" would take a second to fail. Hopefully it would mean that a user\u0027s system wasn\u0027t terribly blocked but also that someone would notice and dig out the root cause.\n\nDefinitely having _some_ type of obvious failure is good because (right now) we default to doing completely the wrong thing (returning the unpopulated \"boot wp\" value).",
      "parentUuid": "718339eb_e336b5db",
      "range": {
        "startLine": 216,
        "startChar": 2,
        "endLine": 216,
        "endChar": 24
      },
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12a899f7_328f8b29",
        "filename": "host/arch/arm/lib/crossystem_arch.c",
        "patchSetId": 1
      },
      "lineNbr": 220,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2022-10-18T22:23:48Z",
      "side": 1,
      "message": "this is no longer going to get the errno from ioctl() in the EBUSY error case; it\u0027ll report the (non)error from usleep().\n\nMaybe move this into the loop, splitting the success vs. error cases?",
      "range": {
        "startLine": 220,
        "startChar": 2,
        "endLine": 220,
        "endChar": 8
      },
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8169484_883dc0b8",
        "filename": "host/arch/arm/lib/crossystem_arch.c",
        "patchSetId": 1
      },
      "lineNbr": 220,
      "author": {
        "id": 1000107
      },
      "writtenOn": "2022-10-18T22:47:37Z",
      "side": 1,
      "message": "Ah, good point. I don\u0027t think moving the print in the loop helps. I think we need to move all the loop end conditions into the loop so we can do them before the sleep.\n\nOK, see how this looks.",
      "parentUuid": "12a899f7_328f8b29",
      "range": {
        "startLine": 220,
        "startChar": 2,
        "endLine": 220,
        "endChar": 8
      },
      "revId": "10e314a21990294081051d3e6a0216a7c5fb6ac3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}