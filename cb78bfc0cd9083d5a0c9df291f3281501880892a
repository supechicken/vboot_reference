{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "43ff8736_86b19478",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-12-30T17:55:07Z",
      "side": 1,
      "message": "Can you please link the patch that would actually use this flag to give an idea what kinds of output you want to guard with it?\n\nIn general, I would caution not to hide a ton of super verbose debugging output behind a runtime flag, because even if the output is disabled the compiler is still adding all of those strings to the binary. You\u0027re basically still eating all of the cost of adding extra debugging output so there is little reason to not have it enabled and logged to CBMEM console all the time. I would normally suggest to just add as much debugging output with normal printk as you feel might be needed on production builds (and if that feels too spammy you can mark it as BIOS_SPEW and people can reduce the loglevel if it annoys them, that\u0027s what that\u0027s for), and any extra output that adds a large amount of new strings which we don\u0027t want to burden the production build with should be hidden behind a hard Kconfig. I don\u0027t think there\u0027s really a good use case for output that\u0027s compiled in but never active by default.\n\nIn essence, I think you\u0027re basically just reinventing the loglevel here, and we should just use the actual loglevel for that instead (and maybe adjust the way we use it if it doesn\u0027t suit your needs right now).",
      "revId": "cb78bfc0cd9083d5a0c9df291f3281501880892a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "715cbfe1_d3c687e7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2024-12-31T02:05:16Z",
      "side": 1,
      "message": "\u003e Can you please link the patch that would actually use this flag to give an idea what kinds of output you want to guard with it?\n\u003e \n\u003e In general, I would caution not to hide a ton of super verbose debugging output behind a runtime flag, because even if the output is disabled the compiler is still adding all of those strings to the binary. You\u0027re basically still eating all of the cost of adding extra debugging output so there is little reason to not have it enabled and logged to CBMEM console all the time. I would normally suggest to just add as much debugging output with normal printk as you feel might be needed on production builds (and if that feels too spammy you can mark it as BIOS_SPEW and people can reduce the loglevel if it annoys them, that\u0027s what that\u0027s for), and any extra output that adds a large amount of new strings which we don\u0027t want to burden the production build with should be hidden behind a hard Kconfig. I don\u0027t think there\u0027s really a good use case for output that\u0027s compiled in but never active by default.\n\u003e \n\u003e In essence, I think you\u0027re basically just reinventing the loglevel here, and we should just use the actual loglevel for that instead (and maybe adjust the way we use it if it doesn\u0027t suit your needs right now).\n\n\nCould you please hold off on reviewing this until I\u0027ve had a chance to update the design doc? If you\u0027re still keen to understand what this CL is aiming for, please take a look at https://chromium-review.googlesource.com/q/topic:%22unified_ap_debug%22\n\nHere is high level summary and I will share the design doc later\n\n\n# Problem Statement\n\nGoogle non-firmware team, SoC Partners and/or OxMs encounter three main problems when debugging silicon firmware:\n - Need for custom images: Partners must create special debug builds to enable verbose logging, requiring source code access and build expertise.\n - Replication challenges: Debugging and replicating issues becomes difficult as the custom debug build may not accurately represent the original failing firmware version.\n - Limited accessibility: Hardware and integration teams without firmware development expertise are hindered from debugging silicon-related issues.\n\n# Proposed Solution\nTo address these problems, we propose a new approach to AP firmware image creation and debug logging:\n- Dual Image Approach: Continue providing two AP firmware images:\n   * image-$BOARD.bin: Production image with release builds of both coreboot and silicon firmware (optimized for performance).\n   * image-$BOARD.serial.bin: Enhanced image containing:\n      - Debug build of coreboot.\n      - Debug build of silicon firmware.\n\n- Dynamic Debug Control: Introduce a mechanism to dynamically control the verbosity of silicon firmware debug logs. This will be achieved through a flag in the Google Binary Block (GBB).\n\n- coreboot Integration: Leverage coreboot\u0027s capability to handle and route silicon firmware debug messages. coreboot will:\n    * Read the GBB flag during initialization.\n    * Based on the flag\u0027s value, either enable or suppress the output of debug messages from the silicon firmware.",
      "parentUuid": "43ff8736_86b19478",
      "revId": "cb78bfc0cd9083d5a0c9df291f3281501880892a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "78c80d1c_193df4d2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-01-03T16:25:25Z",
      "side": 1,
      "message": "Sure, I can wait. I do feel like my concerns may still apply to what you sketched there, though. \"Dynamic Debug Control\" is basically the point of having a log level already, we don\u0027t need to reinvent it. The `cbmem` utility already has a `--loglevel` option to filter the output, and we\u0027ve had plans for adding a serial-console-specific loglevel control as a CBFS file before that could be revived (CB:45208). You might want to look into those options when writing your design.\n\n(Also, the problem about debug print strings increasing binary size remains, so for the really spammy stuff I\u0027d recommend to still keep them behind a Kconfig that\u0027s only enabled for the .serial.bin build.)",
      "parentUuid": "715cbfe1_d3c687e7",
      "revId": "cb78bfc0cd9083d5a0c9df291f3281501880892a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6bd99ba_226811e4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2025-01-04T01:41:35Z",
      "side": 1,
      "message": "\u003e Sure, I can wait. I do feel like my concerns may still apply to what you sketched there, though. \"Dynamic Debug Control\" is basically the point of having a log level already, we don\u0027t need to reinvent it. The `cbmem` utility already has a `--loglevel` option to filter the output, and we\u0027ve had plans for adding a serial-console-specific loglevel control as a CBFS file before that could be revived (CB:45208). You might want to look into those options when writing your design.\n\u003e \n\u003e (Also, the problem about debug print strings increasing binary size remains, so for the really spammy stuff I\u0027d recommend to still keep them behind a Kconfig that\u0027s only enabled for the .serial.bin build.)\n\n\nNot sure if we are in same page here. Let me share the design doc with you first to start with go/dynamic_ap_firmware\n\nThe idea is to keep debug build if FSP/silicon FW in all serial bin image and then use GBB to control the flow.",
      "parentUuid": "78c80d1c_193df4d2",
      "revId": "cb78bfc0cd9083d5a0c9df291f3281501880892a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}