{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "7294cd34_06de3971",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 29,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "Does this need to be an extra field? Why not just check `if (avbctx-\u003epreloaded[0].size)`?",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8549b42b_eb38ed59",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 29,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "I like extra fiels, it is much more readable",
      "parentUuid": "7294cd34_06de3971",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "40b96048_95b5183d",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 29,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-13T00:00:04Z",
      "side": 1,
      "message": "Well, you\u0027re introducing data redundancies where there don\u0027t really need to be any. It just introduces the chance that something might go out of sync.",
      "parentUuid": "8549b42b_eb38ed59",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "33dc1764_9bc9d6be",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 29,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-13T12:44:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "40b96048_95b5183d",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3697a99d_285e51ef",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 56,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-03-09T23:54:47Z",
      "side": 1,
      "message": "Now this is always non-null.",
      "range": {
        "startLine": 56,
        "startChar": 5,
        "endLine": 56,
        "endChar": 17
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "59342bb1_3b2b616c",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 56,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "But might be null in future calls when fastboot/pvmfw changes are done. I dont think that extra check is something bad.",
      "parentUuid": "3697a99d_285e51ef",
      "range": {
        "startLine": 56,
        "startChar": 5,
        "endLine": 56,
        "endChar": 17
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3906245c_a8728337",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 167,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-03-09T23:54:47Z",
      "side": 1,
      "message": "align",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d069346e_66593069",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 167,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "This doesn\u0027t really reflect the \"has\" amount, it should be `kernel_buffer_end - buffer`.",
      "range": {
        "startLine": 167,
        "startChar": 20,
        "endLine": 167,
        "endChar": 46
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "69ca6cc4_7c75c409",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 167,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3906245c_a8728337",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b4426674_20661fec",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 167,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d069346e_66593069",
      "range": {
        "startLine": 167,
        "startChar": 20,
        "endLine": 167,
        "endChar": 46
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0e9f4b7_9da22d04",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 205,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "If you do keep this, `reserve_buffers()` should set it to true. (But as mentioned above I don\u0027t think you need it at all.)",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b3076c0_ceee0134",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 205,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c0e9f4b7_9da22d04",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "55cf74d1_81a73485",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 208,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "I think we should also set `*out_num_bytes_preloaded \u003d 0` before the first point where we\u0027re potentially returning OK without loading anything, just in case.",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3260864e_c9dd6f93",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 208,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "55cf74d1_81a73485",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bff3d89b_e34a9297",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 212,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "This check should come before `reserve_buffers()`.",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09d1f9d7_dcd3ecc1",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 212,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "We would like to reserve buffer anyway, right?",
      "parentUuid": "bff3d89b_e34a9297",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37ea375e_e18d58d0",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 212,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-13T00:00:04Z",
      "side": 1,
      "message": "I mean, if we\u0027re going with lazy initialization then it just seems consequential to really make it as lazy as it can be, not initialize those partitions when the caller is asking for something completely different.",
      "parentUuid": "09d1f9d7_dcd3ecc1",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d11f6343_5227deac",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 212,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-13T12:44:47Z",
      "side": 1,
      "message": "It was not about lazy initialization, TBH I wanted to call it as soon as possible. We moved it here just to keep all buffer loading function together in one file.",
      "parentUuid": "37ea375e_e18d58d0",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "839a3a8f_1b85a50e",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 212,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-13T22:01:29Z",
      "side": 1,
      "message": "Sure, it doesn\u0027t make much of a difference.",
      "parentUuid": "d11f6343_5227deac",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3679ce49_e78efd62",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 221,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "This comment would make more sense at the first point where you\u0027re potentially returning OK.",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e0afa0f4_c5139933",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 221,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3679ce49_e78efd62",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d10ade7_0026b7b2",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 236,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "I don\u0027t think this is correct? `part-\u003esize` will always be the exact size of the partition. My understanding of the way `out_num_bytes_preloaded` works is that if you request more `num_bytes` than the partition has, we should just return OK with the amount we have in `*out_num_bytes_preloaded`. But that case wouldn\u0027t work with this code because you would already be returning an error here. (It would be great to have unit tests for all these edge cases, btw.)",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "44a66fc6_e2a18108",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 236,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "I think that if we request more data than partition size, then something is wrong. Description says: \"The preloaded partition is expected to be |num_bytes|, where the actual preloaded byte count is returned in |out_num_bytes_preloaded|.\" So I dont think that return error is incorrect.",
      "parentUuid": "8d10ade7_0026b7b2",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d7158119_7551bf51",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 236,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-13T00:00:04Z",
      "side": 1,
      "message": "What would be the point of having the `out_num_bytes_preloaded` parameter at all if success always meant that we return exactly the amount of bytes requested? I think the fact that it exists proves that short reads are an intended case. It also says `|out_num_bytes_preloaded| must be no larger than |num_bytes|`, which kinda implies that it can be smaller (otherwise they would\u0027ve written \"equal\").\n\nIt would also be consistent with how we implemented `read_from_partition()`.",
      "parentUuid": "44a66fc6_e2a18108",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff1c0114_cef3b98e",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 236,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-13T12:44:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d7158119_7551bf51",
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5b40b026_ec5a9362",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 239,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "I think we should always load `part-\u003esize`, even if `num_bytes` is smaller. Otherwise we risk having a half-loaded partition, and you don\u0027t have the code to remedy that if we later get a call for a larger size. Rather than implement extra logic for that edge case (which shouldn\u0027t happen in practice with the current AVB code anyway), let\u0027s just always load the full thing no matter how many bytes we were asked for.",
      "range": {
        "startLine": 239,
        "startChar": 54,
        "endLine": 239,
        "endChar": 63
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31f15432_271cf7bb",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 239,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-03-12T07:22:27Z",
      "side": 1,
      "message": "Note that in normal mode `num_bytes` will actually be smaller than `part-\u003esize` (at least for pvmfw, see b/393987899#comment3). Do we really want to waste time reading hundreds of KB of unused data?\n\nWith the current implementation (PS16), when there\u0027s another call with a larger requested size (`num_bytes \u003e\u003d part-\u003edata_size`), then `load_partition` will be called again with the larger size, so nothing will go wrong functionally. The only problem is the duplicate read, but as you said, that won\u0027t happen in practice. Therefore I see no problem with that.",
      "parentUuid": "5b40b026_ec5a9362",
      "range": {
        "startLine": 239,
        "startChar": 54,
        "endLine": 239,
        "endChar": 63
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9baea07_669b9f60",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 239,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "31f15432_271cf7bb",
      "range": {
        "startLine": 239,
        "startChar": 54,
        "endLine": 239,
        "endChar": 63
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "72cc8bb4_ff59aa45",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 239,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-13T00:00:04Z",
      "side": 1,
      "message": "Right, good point, and I didn\u0027t realize that the current implementation already handles that. I guess it\u0027s good as it is then.",
      "parentUuid": "f9baea07_669b9f60",
      "range": {
        "startLine": 239,
        "startChar": 54,
        "endLine": 239,
        "endChar": 63
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b904d802_cdc064f8",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 246,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2025-03-11T22:00:10Z",
      "side": 1,
      "message": "This should be `data_size`.",
      "range": {
        "startLine": 246,
        "startChar": 19,
        "endLine": 246,
        "endChar": 28
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cac966dd_1d8a3d21",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 246,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2025-03-12T07:22:27Z",
      "side": 1,
      "message": "Yeah... not sure how I missed that.",
      "parentUuid": "b904d802_cdc064f8",
      "range": {
        "startLine": 246,
        "startChar": 19,
        "endLine": 246,
        "endChar": 28
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "48961775_c4a45f01",
        "filename": "firmware/avb/vboot_avb_ops.c",
        "patchSetId": 16
      },
      "lineNbr": 246,
      "author": {
        "id": 1562687
      },
      "writtenOn": "2025-03-12T12:45:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cac966dd_1d8a3d21",
      "range": {
        "startLine": 246,
        "startChar": 19,
        "endLine": 246,
        "endChar": 28
      },
      "revId": "0a5d3ff4ab9bfbf7297255db7f9b58ed53650725",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}