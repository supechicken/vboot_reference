{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "06680b76_fe645a40",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2022-07-13T23:47:35Z",
      "side": 1,
      "message": "I don\u0027t think this should be moved into the header. For the very small functions with 2-4 cases inlining the lookup table is no big deal, and maybe outweighs the cost of a separate function call. But the table with many dozens of recovery reasons definitely seems too large for inlining. It should stay in a .c file.\n\nI\u0027m also not sure about the naming, tbh. I don\u0027t think it\u0027s a hard rule that every exported function in vboot must start with vb2api_ -- we have all the vb2_hash stuff and vb2_digest_size() and that sort of thing, after all. I think the idea about these was vaguely that the big core functions that actually interact with vboot\u0027s state are \"APIs\", and the small helper utility stuff like calculating a SHA is something else. But the water is definitely a bit muddled there and I\u0027m not sure if we have a clear rule (I feel like we discussed this before already, maybe while Joel was still here(?), but as usual I\u0027ve forgotten the details). Maybe the rule was \"if it operates on a vb2_context, it\u0027s a vb2api, otherwise it isn\u0027t\"? That would seem consistent with the current usage, I think (and would support my gut feeling that it sounds odd to call functions like these \"APIs\").\n\n(Also, the \u003c2api.h\u003e header is getting awfully cluttered enough as it is, it might be nice to find a different spot for all these small translation functions, especially the inline ones. Maybe make a new \u003c2info.h\u003e or something?)",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c34f9307_5c6db68f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2022-07-14T07:45:06Z",
      "side": 1,
      "message": "\u003e I don\u0027t think this should be moved into the header. For the very small functions with 2-4 cases inlining the lookup table is no big deal, and maybe outweighs the cost of a separate function call. But the table with many dozens of recovery reasons definitely seems too large for inlining. It should stay in a .c file.\n\u003e \n\u003e I\u0027m also not sure about the naming, tbh. I don\u0027t think it\u0027s a hard rule that every exported function in vboot must start with vb2api_ -- we have all the vb2_hash stuff and vb2_digest_size() and that sort of thing, after all. I think the idea about these was vaguely that the big core functions that actually interact with vboot\u0027s state are \"APIs\", and the small helper utility stuff like calculating a SHA is something else. But the water is definitely a bit muddled there and I\u0027m not sure if we have a clear rule (I feel like we discussed this before already, maybe while Joel was still here(?), but as usual I\u0027ve forgotten the details). Maybe the rule was \"if it operates on a vb2_context, it\u0027s a vb2api, otherwise it isn\u0027t\"? That would seem consistent with the current usage, I think (and would support my gut feeling that it sounds odd to call functions like these \"APIs\").\n\u003e \n\u003e (Also, the \u003c2api.h\u003e header is getting awfully cluttered enough as it is, it might be nice to find a different spot for all these small translation functions, especially the inline ones. Maybe make a new \u003c2info.h\u003e or something?)\n\nif you think we don\u0027t need to convert the recovery_reason to a string in context of  elogtool (util/cbfstool/eventlog.c) then we can get rid of this CL completely.",
      "parentUuid": "06680b76_fe645a40",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ee0e9543_d3930876",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2022-07-15T01:16:52Z",
      "side": 1,
      "message": "\u003e if you think we don\u0027t need to convert the recovery_reason to a string in context of  elogtool (util/cbfstool/eventlog.c) then we can get rid of this CL completely.\n\nUhh... no, we do? Sorry, not sure how you got that impression from my comments (here or elsewhere). elogtool absolutely should be displaying the recovery reason as a string, like it always has (maybe you confused that with my other comment saying that _coreboot ramstage_ shouldn\u0027t do that, for space reasons?). And we should absolutely deduplicate the separate recovery reason string table in elogtool by making it call vb2_get_recovery_reason_string() in vboot instead. I\u0027m just saying that that function shouldn\u0027t be inlined.",
      "parentUuid": "c34f9307_5c6db68f",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f63f415d_51ddf39e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2022-07-17T12:05:31Z",
      "side": 1,
      "message": "\u003e \u003e if you think we don\u0027t need to convert the recovery_reason to a string in context of  elogtool (util/cbfstool/eventlog.c) then we can get rid of this CL completely.\n\u003e \n\u003e Uhh... no, we do? Sorry, not sure how you got that impression from my comments (here or elsewhere). elogtool absolutely should be displaying the recovery reason as a string, like it always has (maybe you confused that with my other comment saying that _coreboot ramstage_ shouldn\u0027t do that, for space reasons?). And we should absolutely deduplicate the separate recovery reason string table in elogtool by making it call vb2_get_recovery_reason_string() in vboot instead. I\u0027m just saying that that function shouldn\u0027t be inlined.\n\neventlog.c is unable to include any function from `.c` file which belongs to vboot repository. The build infrastructure for eventlog.c results into below error in term to do so.\n\nld.lld: error: undefined symbol: vb2_get_recovery_reason_string\n\u003e\u003e\u003e referenced by eventlog.c\n\u003e\u003e\u003e               ../cbfstool/eventlog.o:(eventlog_print_event)\nclang-14: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [Makefile.inc:241: ../cbfstool/elogtool] Error 1",
      "parentUuid": "ee0e9543_d3930876",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "35c2a5fd_2a5d0067",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2022-07-18T08:49:18Z",
      "side": 1,
      "message": "You\u0027ll need to link `$(objutil)/cbfstool/elogtool` with `$(VBOOT_HOSTLIB)` in coreboot/util/cbfstool/Makefile.inc:239.",
      "parentUuid": "f63f415d_51ddf39e",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93b781fe_302a375d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2022-07-18T08:57:51Z",
      "side": 1,
      "message": "\u003e You\u0027ll need to link `$(objutil)/cbfstool/elogtool` with `$(VBOOT_HOSTLIB)` in coreboot/util/cbfstool/Makefile.inc:239.\n\nI have tired that and it results into https://paste.googleplex.com/4782943894503424\n\nclang-14: error: no such file or directory: \u0027/build/brya/tmp/portage/sys-apps/coreboot-utils-9999/work/coreboot-utils-9999/util/vboot_lib/libvboot_host.a\u0027\nmake: *** [Makefile.inc:241: ../cbfstool/elogtool] Error 1",
      "parentUuid": "35c2a5fd_2a5d0067",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dcbea701_2cb91a13",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2022-07-18T09:05:42Z",
      "side": 1,
      "message": "\u003e \u003e You\u0027ll need to link `$(objutil)/cbfstool/elogtool` with `$(VBOOT_HOSTLIB)` in coreboot/util/cbfstool/Makefile.inc:239.\n\u003e \n\u003e I have tired that and it results into https://paste.googleplex.com/4782943894503424\n\u003e \n\u003e clang-14: error: no such file or directory: \u0027/build/brya/tmp/portage/sys-apps/coreboot-utils-9999/work/coreboot-utils-9999/util/vboot_lib/libvboot_host.a\u0027\n\u003e make: *** [Makefile.inc:241: ../cbfstool/elogtool] Error 1\n\nBelow changes is helping me to pass the compilation error. Will submit a CL for this.\n\ndiff --git a/util/cbfstool/Makefile.inc b/util/cbfstool/Makefile.inc\nindex 3dbae5f121..52abf15b72 100644\n--- a/util/cbfstool/Makefile.inc\n+++ b/util/cbfstool/Makefile.inc\n@@ -236,9 +236,9 @@ $(objutil)/cbfstool/amdcompress: $(addprefix $(objutil)/cbfstool/,$(amdcompobj))\n        printf \"    HOSTCC     $(subst $(objutil)/,,$(@)) (link)\\n\"\n        $(HOSTCC) $(TOOLLDFLAGS) -o $@ $(addprefix $(objutil)/cbfstool/,$(amdcompobj)) -lz\n \n-$(objutil)/cbfstool/elogtool: | check-flashrom-presence $(addprefix $(objutil)/cbfstool/,$(elogobj))\n+$(objutil)/cbfstool/elogtool: | check-flashrom-presence $(addprefix $(objutil)/cbfstool/,$(elogobj)) $(VBOOT_HOSTLIB)\n        printf \"    HOSTCC     $(subst $(objutil)/,,$(@)) (link)\\n\"\n-       $(HOSTCC) $(TOOLLDFLAGS) -o $@ $(addprefix $(objutil)/cbfstool/,$(elogobj)) $(FLASHROM)\n+       $(HOSTCC) $(TOOLLDFLAGS) -o $@ $(addprefix $(objutil)/cbfstool/,$(elogobj)) $(FLASHROM) $(VBOOT_HOSTLIB)\n \n $(objutil)/cbfstool/cse_fpt: $(addprefix $(objutil)/cbfstool/,$(cse_fpt_obj))\n        printf \"    HOSTCC     $(subst $(objutil)/,,$(@)) (link)\\n\"",
      "parentUuid": "93b781fe_302a375d",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7936b5a6_832bc349",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2022-07-18T09:12:31Z",
      "side": 1,
      "message": "I think the line should be\n\n`$(objutil)/cbfstool/elogtool: $(VBOOT_HOSTLIB) | check-flashrom-presence $(addprefix $(objutil)/cbfstool/,$(elogobj))`\n\nSee https://www.gnu.org/software/make/manual/html_node/Prerequisite-Types.html.",
      "parentUuid": "dcbea701_2cb91a13",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "764e7030_881d5020",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2022-07-18T09:30:23Z",
      "side": 1,
      "message": "\u003e I think the line should be\n\u003e \n\u003e `$(objutil)/cbfstool/elogtool: $(VBOOT_HOSTLIB) | check-flashrom-presence $(addprefix $(objutil)/cbfstool/,$(elogobj))`\n\u003e \n\u003e See https://www.gnu.org/software/make/manual/html_node/Prerequisite-Types.html.\n\nLooks like there is a difference between upstream coreboot vs chromium related to the elogtool static library inclusion.\nhttps://github.com/coreboot/coreboot/blob/master/util/cbfstool/Makefile.inc#L231\n\nWe might need to land this upstream coreboot change into chromium as is ?",
      "parentUuid": "7936b5a6_832bc349",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f4a6a9ba_656ee577",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1532003
      },
      "writtenOn": "2022-07-18T10:35:58Z",
      "side": 1,
      "message": "\u003e \u003e I think the line should be\n\u003e \u003e \n\u003e \u003e `$(objutil)/cbfstool/elogtool: $(VBOOT_HOSTLIB) | check-flashrom-presence $(addprefix $(objutil)/cbfstool/,$(elogobj))`\n\u003e \u003e \n\u003e \u003e See https://www.gnu.org/software/make/manual/html_node/Prerequisite-Types.html.\n\u003e \n\u003e Looks like there is a difference between upstream coreboot vs chromium related to the elogtool static library inclusion.\n\u003e https://github.com/coreboot/coreboot/blob/master/util/cbfstool/Makefile.inc#L231\n\u003e \n\u003e We might need to land this upstream coreboot change into chromium as is ?\n\nhttps://chromium-review.googlesource.com/c/chromiumos/third_party/coreboot/+/3769420",
      "parentUuid": "764e7030_881d5020",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "03204209_bf2995dd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1353551
      },
      "writtenOn": "2022-07-18T13:36:10Z",
      "side": 1,
      "message": "The inconsistency problem should be fixed by CL:3492055.",
      "parentUuid": "f4a6a9ba_656ee577",
      "revId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ],
  "submitRequirementResults": [
    {
      "submitRequirement": {
        "name": "Code-Owners",
        "description": {
          "value": "User with the code owner override approved the change"
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "has:enabled_code-owners"
          }
        },
        "submittabilityExpression": {
          "expressionString": "has:approval_code-owners"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Owners-Override\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"has:enabled_code-owners"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["has:enabled_code-owners"],"failingAtoms":[]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"has:approval_code-owners"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["has:approval_code-owners"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Owners-Override=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Owners-Override=+1"]}
      },
      "patchSetCommitId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Code-Review",
        "description": {
          "value": "Submit requirement for the \u0027Code-Review\u0027 label"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Code-Review\u003dMAX,user\u003dnon_uploader -label:Code-Review\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Code-Review=MAX,user=non_uploader -label:Code-Review=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Code-Review=MAX,user=non_uploader","label:Code-Review=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1"]}
      },
      "patchSetCommitId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Review-Enforcement",
        "description": {
          "value": "Two Google employees must approve the change. Uploading the change or voting positively on Code-Review count as approval."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "is:review-enforced_gerrit"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:review-enforcement-satisfied_gerrit"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforced_gerrit"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["is:review-enforced_gerrit"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforcement-satisfied_gerrit"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Verified",
        "description": {
          "value": "CI or human verified the change"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Verified\u003dMAX AND -label:Verified\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Verified=MAX AND -label:Verified=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Verified=MAX","label:Verified=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1"]}
      },
      "patchSetCommitId": "3442b3c3e738bb71c5e52bcde9e656d46799bca1",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    }
  ]
}