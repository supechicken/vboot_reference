{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "f83ca082_2d088e3f",
        "filename": "firmware/2lib/2modpow_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 93,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-03-20T23:13:08Z",
      "side": 1,
      "message": "Adding this to every `asm` statement doesn\u0027t feel right. Can\u0027t we do this through CFLAGS (e.g. `-march\u003darmv8-a+fp`) instead? coreboot passes its CFLAGS through to vboot so if you just set it in xcompile it should work here.",
      "revId": "086b924f410cf4761f24ae41b2efcffbbe2506a6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0eae297c_03084a79",
        "filename": "firmware/2lib/2modpow_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 93,
      "author": {
        "id": 1500642
      },
      "writtenOn": "2024-03-21T07:18:19Z",
      "side": 1,
      "message": "\u003e Adding this to every `asm` statement doesn\u0027t feel right. Can\u0027t we do this through CFLAGS (e.g. `-march\u003darmv8-a+fp`) instead? coreboot passes its CFLAGS through to vboot so if you just set it in xcompile it should work here.\n\nThat does not work with clang. It\u0027s also a necessary on assembly files btw. You see this patern quite a few times in the Linux kernel.",
      "parentUuid": "f83ca082_2d088e3f",
      "revId": "086b924f410cf4761f24ae41b2efcffbbe2506a6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5019b37b_bf7aa5fc",
        "filename": "firmware/2lib/2modpow_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 93,
      "author": {
        "id": 1002133
      },
      "writtenOn": "2024-03-22T23:34:49Z",
      "side": 1,
      "message": "Hmm... okay, this seems to be an issue with clang incorrectly implementing `-mgeneral-regs-only`. I found https://bugs.llvm.org/show_bug.cgi?id\u003d30792 and https://reviews.llvm.org/D38479 which seems to indicate that they\u0027ve been aware of this for close to a decade but haven\u0027t really managed to do anything about it yet. -.-\n\nIt sounds like the clang-specific option `-mno-implicit-float` does basically the same as `-mgeneral-regs-only`, except that it will still allow instructions with floating point (including NEON) registers if the code explicitly asks for them. This means it would also allow C code that uses float types (which is something we\u0027d want to avoid and get warnings for in coreboot), but since we\u0027re running the CI on GCC anyway we would still avoid checking in any code that does that, even if clang couldn\u0027t detect it.\n\nSo how about we solve this by making coreboot set `-mgeneral-regs-only` in AArch64 only for GCC, and make it set `-mno-implicit-float` for clang instead? I think I\u0027d prefer that to having to work around a broken compiler in every single `asm ()` block.",
      "parentUuid": "0eae297c_03084a79",
      "revId": "086b924f410cf4761f24ae41b2efcffbbe2506a6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c54507c2_240e3735",
        "filename": "firmware/2lib/2modpow_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 93,
      "author": {
        "id": 1500642
      },
      "writtenOn": "2024-04-04T10:02:26Z",
      "side": 1,
      "message": "\u003e Hmm... okay, this seems to be an issue with clang incorrectly implementing `-mgeneral-regs-only`. I found https://bugs.llvm.org/show_bug.cgi?id\u003d30792 and https://reviews.llvm.org/D38479 which seems to indicate that they\u0027ve been aware of this for close to a decade but haven\u0027t really managed to do anything about it yet. -.-\n\u003e \n\u003e It sounds like the clang-specific option `-mno-implicit-float` does basically the same as `-mgeneral-regs-only`, except that it will still allow instructions with floating point (including NEON) registers if the code explicitly asks for them. This means it would also allow C code that uses float types (which is something we\u0027d want to avoid and get warnings for in coreboot), but since we\u0027re running the CI on GCC anyway we would still avoid checking in any code that does that, even if clang couldn\u0027t detect it.\n\u003e \n\u003e So how about we solve this by making coreboot set `-mgeneral-regs-only` in AArch64 only for GCC, and make it set `-mno-implicit-float` for clang instead? I think I\u0027d prefer that to having to work around a broken compiler in every single `asm ()` block.\n\nThat seems to work. Thanks!",
      "parentUuid": "5019b37b_bf7aa5fc",
      "revId": "086b924f410cf4761f24ae41b2efcffbbe2506a6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ],
  "submitRequirementResults": [
    {
      "submitRequirement": {
        "name": "Code-Review",
        "description": {
          "value": "Submit requirement for the \u0027Code-Review\u0027 label"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Code-Review\u003dMAX,user\u003dnon_uploader -label:Code-Review\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1 AND -label:Code-Review\u003dMIN"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Code-Review=MAX,user=non_uploader -label:Code-Review=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Code-Review=MAX,user=non_uploader","label:Code-Review=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1 AND -label:Code-Review=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1","label:Code-Review=MIN"]}
      },
      "patchSetCommitId": "086b924f410cf4761f24ae41b2efcffbbe2506a6",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Review-Enforcement",
        "description": {
          "value": "Two Google employees must approve the change. Uploading the change or voting positively on Code-Review count as approval."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "is:review-enforced_gerrit"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:review-enforcement-satisfied_gerrit"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforced_gerrit"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["is:review-enforced_gerrit"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforcement-satisfied_gerrit"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "086b924f410cf4761f24ae41b2efcffbbe2506a6",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Verified",
        "description": {
          "value": "CI or human verified the change"
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "-branch:refs/meta/config"
          }
        },
        "submittabilityExpression": {
          "expressionString": "label:Verified\u003dMAX AND -label:Verified\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"-branch:refs/meta/config"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["branch:refs/meta/config"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Verified=MAX AND -label:Verified=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Verified=MAX","label:Verified=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1"]}
      },
      "patchSetCommitId": "086b924f410cf4761f24ae41b2efcffbbe2506a6",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    }
  ]
}